{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"Desktop-First Observability Platform for Local Development"},{"location":"#introducing-ollyscale","title":"Introducing ollyScale","text":"<p>ollyScale is an OpenTelemetry-native observability platform evolved from the excellent TinyOlly project.</p> <p>Repository: https://github.com/ryanfaircloth/ollyscale</p> <pre><code>git clone https://github.com/ryanfaircloth/ollyscale\n</code></pre>"},{"location":"#why-ollyscale","title":"Why ollyScale?","text":"<p>Why send telemetry to a cloud observability platform while coding? Why not have one on your desktop?</p> <p>ollyScale is a lightweight OpenTelemetry-native observability platform built to visualize and correlate logs, metrics, and traces. No 3rd party observability tools - just Python (FastAPI), Redis, OpenAPI, and JavaScript.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Development-focused - Perfect your app's telemetry locally before production</li> <li>Full OpenTelemetry support - Native OTLP ingestion (gRPC &amp; HTTP)</li> <li>Pre-built Docker images - Deploy in ~30 seconds from Docker Hub</li> <li>Multi-architecture - Supports linux/amd64 and linux/arm64 (Apple Silicon)</li> <li>Trace correlation - Link logs, metrics, and traces automatically</li> <li>Metrics Explorer - Analyze cardinality, labels, and raw series data</li> <li>Service catalog - RED metrics (Rate, Errors, Duration) for all services</li> <li>Interactive service map - Visualize dependencies and call graphs</li> <li>OpenTelemetry Collector management - Remote configuration management via OpAMP protocol</li> <li>REST API - Programmatic access with OpenAPI documentation</li> <li>Zero vendor lock-in - Works with any OTel Collector distribution</li> </ul> <p>Local Development Only</p> <p>ollyScale is not designed to compete with production observability platforms! It's for local development only and is not focused on infrastructure monitoring at this time.</p>"},{"location":"#platform-support","title":"Platform Support","text":"<p>Tested on:</p> <ul> <li>Docker Desktop (macOS Apple Silicon)</li> <li>Minikube Kubernetes (macOS Apple Silicon)</li> <li>May work on other platforms</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Ready to try ollyScale? Check out the Quick Start Guide to get running in under 5 minutes!</p>"},{"location":"#screenshots","title":"Screenshots","text":"Trace Waterfall with Correlated Logs Real-time Logs with Filtering Metrics with Chart Visualization Service Catalog with RED Metrics Interactive Service Dependency Map OTel Collector Configuration (OpAMP) <p>Built for the OpenTelemetry community</p> <p> GitHub \u2022     Issues </p>"},{"location":"ai-agent-deployment/","title":"ollyScale AI Agent Demo - Deployment Guide","text":""},{"location":"ai-agent-deployment/#overview","title":"Overview","text":"<p>The ollyScale AI Agent demo has been refactored to use Helm charts with OTel operator auto-instrumentation. This provides a cleaner, more maintainable deployment approach compared to the previous manual Kubernetes manifests.</p>"},{"location":"ai-agent-deployment/#what-changed","title":"What Changed","text":""},{"location":"ai-agent-deployment/#before-old-approach","title":"Before (Old Approach)","text":"<ul> <li>Manual Kubernetes YAML files in <code>scripts/k8s/ai-agent-demo/</code></li> <li>Manual OTLP configuration via environment variables</li> <li>Separate deployment and cleanup scripts</li> <li>No GitOps integration</li> </ul>"},{"location":"ai-agent-deployment/#after-new-approach","title":"After (New Approach)","text":"<ul> <li>Helm chart in <code>charts/ollyscale-ai-agent/</code></li> <li>OTel operator auto-instrumentation (zero-code)</li> <li>ArgoCD GitOps deployment</li> <li>Integrated with local registry and build scripts</li> </ul>"},{"location":"ai-agent-deployment/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           ollyscale-ai-agent                 \u2502\n\u2502                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  AI Agent    \u2502\u2500\u2500\u2500\u2500\u2500\u25b6\u2502    Ollama      \u2502  \u2502\n\u2502  \u2502              \u2502      \u2502   (tinyllama)  \u2502  \u2502\n\u2502  \u2502 OTel Auto-   \u2502      \u2502                \u2502  \u2502\n\u2502  \u2502 Instrumented \u2502      \u2502  Persistent    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502  Storage       \u2502  \u2502\n\u2502         \u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502         \u2502                                   \u2502\n\u2502         \u2502 OTLP (auto-configured)            \u2502\n\u2502         \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502  \u2502 Agent Collector  \u2502                      \u2502\n\u2502  \u2502   (in ollyscale)  \u2502                      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ai-agent-deployment/#deployment","title":"Deployment","text":""},{"location":"ai-agent-deployment/#automated-recommended","title":"Automated (Recommended)","text":"<p>The AI agent demo is automatically deployed via ArgoCD when you run:</p> <pre><code>make up\n</code></pre> <p>This will:</p> <ol> <li>Create the KIND cluster</li> <li>Install ArgoCD</li> <li>Deploy infrastructure (including OTel operator)</li> <li>Deploy ollyScale platform</li> <li>Deploy AI agent demo</li> </ol>"},{"location":"ai-agent-deployment/#manual-build-and-deploy","title":"Manual Build and Deploy","text":"<p>If you make changes to the AI agent code:</p> <pre><code># Build all images including AI agent\ncd charts\n./build-and-push-local.sh v2.2.0-my-changes\n\n# ArgoCD will automatically sync the new version\n# Or force sync:\ncd ../.kind\nterraform apply -auto-approve\n</code></pre>"},{"location":"ai-agent-deployment/#chart-only-update","title":"Chart-only Update","text":"<p>If you only changed the Helm chart (no code changes):</p> <pre><code>cd charts\nhelm package ollyscale-ai-agent\nhelm push ollyscale-ai-agent-0.1.0.tgz oci://registry.ollyscale.test:49443/ollyscale/charts --insecure-skip-tls-verify\n\n# Update ArgoCD\ncd ../.kind\nterraform apply -auto-approve\n</code></pre>"},{"location":"ai-agent-deployment/#configuration","title":"Configuration","text":""},{"location":"ai-agent-deployment/#default-values","title":"Default Values","text":"<p>See <code>charts/ollyscale-ai-agent/values.yaml</code> for all configuration options.</p> <p>Key defaults:</p> <ul> <li>Namespace: <code>ollyscale-ai-agent</code></li> <li>Ollama model: <code>tinyllama</code></li> <li>Ollama storage: 10Gi persistent volume</li> <li>Ollama resources: 2 CPU / 4Gi RAM (limit)</li> <li>Agent resources: 500m CPU / 512Mi RAM (limit)</li> <li>HTTPRoute: Disabled (no external access by default)</li> </ul>"},{"location":"ai-agent-deployment/#customization","title":"Customization","text":"<p>To override values, edit <code>.kind/modules/ollyscale/argocd-applications/observability/ollyscale-ai-agent.yaml</code>:</p> <pre><code>spec:\n  source:\n    helm:\n      valuesObject:\n        ollama:\n          model: llama2 # Use different model\n          resources:\n            limits:\n              cpu: \"4000m\"\n              memory: \"8Gi\"\n\n        agent:\n          httpRoute:\n            enabled: true # Enable external access\n</code></pre>"},{"location":"ai-agent-deployment/#verification","title":"Verification","text":""},{"location":"ai-agent-deployment/#check-deployment-status","title":"Check Deployment Status","text":"<pre><code># Check ArgoCD application\nkubectl get application -n argocd ollyscale-ai-agent\n\n# Check pods\nkubectl get pods -n ollyscale-ai-agent\n\n# Check services\nkubectl get svc -n ollyscale-ai-agent\n</code></pre>"},{"location":"ai-agent-deployment/#view-logs","title":"View Logs","text":"<pre><code># Agent logs (should show successful LLM calls)\nkubectl logs -n ollyscale-ai-agent deployment/ai-agent -f\n\n# Ollama logs (should show model downloads)\nkubectl logs -n ollyscale-ai-agent deployment/ollama -f\n</code></pre>"},{"location":"ai-agent-deployment/#verify-auto-instrumentation","title":"Verify Auto-Instrumentation","text":"<pre><code># Check if init container was injected\nkubectl get pod -n ollyscale-ai-agent -l app=ai-agent \\\n  -o jsonpath='{.items[0].spec.initContainers[*].name}'\n# Should output: opentelemetry-auto-instrumentation-python\n\n# Check OTLP endpoint configuration\nkubectl get pod -n ollyscale-ai-agent -l app=ai-agent \\\n  -o jsonpath='{.items[0].spec.containers[0].env[?(@.name==\"OTEL_EXPORTER_OTLP_ENDPOINT\")].value}'\n# Should output: http://agent-collector.ollyscale.svc.cluster.local:4318\n</code></pre>"},{"location":"ai-agent-deployment/#check-traces-in-ollyscale-ui","title":"Check Traces in ollyScale UI","text":"<ol> <li>Port-forward to ollyScale UI:</li> </ol> <pre><code>kubectl port-forward -n ollyscale svc/ollyscale-ui 5002:5002\n</code></pre> <ol> <li> <p>Open browser: http://localhost:5002</p> </li> <li> <p>Filter for service: <code>ai-agent</code></p> </li> <li> <p>Look for GenAI spans with attributes:</p> </li> <li><code>gen_ai.system</code>: \"ollama\"</li> <li><code>gen_ai.request.model</code>: \"tinyllama\"</li> <li><code>gen_ai.prompt</code>: User prompt text</li> <li><code>gen_ai.completion</code>: LLM response</li> </ol>"},{"location":"ai-agent-deployment/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ai-agent-deployment/#ollama-not-ready","title":"Ollama Not Ready","text":"<p>If Ollama pod stays in \"NotReady\":</p> <pre><code># Check if model is downloading\nkubectl logs -n ollyscale-ai-agent deployment/ollama\n\n# Verify model is pulled\nkubectl exec -n ollyscale-ai-agent deployment/ollama -- ollama list\n</code></pre> <p>Model download can take several minutes depending on network speed.</p>"},{"location":"ai-agent-deployment/#agent-cant-connect-to-ollama","title":"Agent Can't Connect to Ollama","text":"<p>If agent logs show connection errors:</p> <pre><code># Verify Ollama service\nkubectl get svc -n ollyscale-ai-agent ollama\n\n# Check Ollama pod is ready\nkubectl get pods -n ollyscale-ai-agent -l app=ollama\n</code></pre>"},{"location":"ai-agent-deployment/#no-traces-appearing","title":"No Traces Appearing","text":"<p>If traces aren't showing in ollyScale:</p> <pre><code># Verify instrumentation annotation\nkubectl get deployment -n ollyscale-ai-agent ai-agent -o yaml | grep instrumentation\n\n# Check OTel operator logs\nkubectl logs -n opentelemetry-operator-system deployment/opentelemetry-operator\n\n# Verify Python instrumentation resource exists\nkubectl get instrumentation -n ollyscale python-instrumentation\n</code></pre>"},{"location":"ai-agent-deployment/#cleanup","title":"Cleanup","text":""},{"location":"ai-agent-deployment/#remove-ai-agent-demo","title":"Remove AI Agent Demo","text":"<pre><code># Delete via ArgoCD\nkubectl delete application -n argocd ollyscale-ai-agent\n\n# Or delete namespace directly\nkubectl delete namespace ollyscale-ai-agent\n</code></pre>"},{"location":"ai-agent-deployment/#full-cluster-teardown","title":"Full Cluster Teardown","text":"<pre><code>make down\n</code></pre>"},{"location":"ai-agent-deployment/#migration-notes","title":"Migration Notes","text":"<p>If you were using the old K8s deployment method:</p> <ol> <li>The old files in <code>scripts/k8s/ai-agent-demo/</code> have been removed</li> <li>Old deployment scripts no longer work</li> <li>Use <code>make up</code> to deploy the new Helm-based version</li> <li>Configuration is now in the Helm chart values</li> <li>Deployment is managed by ArgoCD</li> </ol>"},{"location":"ai-agent-deployment/#files-reference","title":"Files Reference","text":"<ul> <li>Helm Chart: <code>charts/ollyscale-ai-agent/</code></li> <li>ArgoCD App: <code>.kind/modules/ollyscale/argocd-applications/observability/ollyscale-ai-agent.yaml</code></li> <li>Terraform Config: <code>.kind/modules/ollyscale/variables.tf</code> (ai_agent_image, ai_agent_tag)</li> <li>Build Script: <code>charts/build-and-push-local.sh</code></li> <li>Application Code: <code>apps/ai-agent-demo/</code></li> </ul>"},{"location":"ai-agent/","title":"AI Agent Demo","text":"<p>This demo showcases GenAI observability with OpenTelemetry - automatic instrumentation of LLM calls using the <code>opentelemetry-instrumentation-ollama</code> package.</p>"},{"location":"ai-agent/#what-is-genai-observability","title":"What is GenAI Observability?","text":"<p>GenAI observability captures telemetry from LLM interactions including:</p> <ul> <li>Prompts and responses - Full text of user prompts and model outputs</li> <li>Token usage - Input and output token counts</li> <li>Latency - Response time for each LLM call</li> <li>Model information - Which model was used</li> </ul>"},{"location":"ai-agent/#quick-start","title":"Quick Start","text":""},{"location":"ai-agent/#docker","title":"Docker","text":"<pre><code># Start ollyScale core first\ncd docker\n./01-start-core.sh\n\n# Deploy AI agent demo (pulls pre-built images from Docker Hub)\ncd ../docker-ai-agent-demo\n./01-deploy-ai-demo.sh\n</code></pre> <p>This starts:</p> <ul> <li>Ollama with TinyLlama model for local LLM inference</li> <li>AI Agent with automatic GenAI span instrumentation</li> </ul> <p>Access the UI at <code>http://localhost:5005</code> and navigate to the AI Agents tab.</p> <p>For local development: Use <code>./01-deploy-ai-demo-local.sh</code> to build locally</p> <p>Stop: <code>./02-stop-ai-demo.sh</code></p> <p>Cleanup (remove volumes): <code>./03-cleanup-ai-demo.sh</code></p>"},{"location":"ai-agent/#how-it-works","title":"How It Works","text":"<p>The demo uses zero-code auto-instrumentation - no OpenTelemetry imports in the application code:</p> <pre><code># agent.py - NO OpenTelemetry imports needed!\nfrom ollama import Client\n\nclient = Client(host=\"http://ollama:11434\")\n\n# This call is AUTO-INSTRUMENTED\nresponse = client.chat(\n    model=\"tinyllama\",\n    messages=[{\"role\": \"user\", \"content\": \"What is OpenTelemetry?\"}]\n)\n</code></pre> <p>The magic happens in the Dockerfile:</p> <pre><code># Install auto-instrumentation packages\nRUN pip install opentelemetry-distro opentelemetry-instrumentation-ollama\n\n# Run with auto-instrumentation wrapper\nCMD [\"opentelemetry-instrument\", \"python\", \"-u\", \"agent.py\"]\n</code></pre>"},{"location":"ai-agent/#what-youll-see","title":"What You'll See","text":"<p>In the AI Agents tab:</p> Field Description Prompt The user's input to the LLM Response The model's output Tokens In Number of input tokens Tokens Out Number of output tokens Latency Response time in milliseconds Model Model name (e.g., <code>tinyllama</code>) <p>Click any row to expand the full span details in JSON format.</p>"},{"location":"ai-agent/#supported-llms","title":"Supported LLMs","text":"<p>The OpenTelemetry GenAI semantic conventions work with any instrumented LLM provider:</p> <ul> <li>Ollama - Local LLM inference (this demo)</li> <li>OpenAI - GPT models via <code>opentelemetry-instrumentation-openai</code></li> <li>Anthropic - Claude models</li> <li>Other providers - Any with OpenTelemetry instrumentation</li> </ul>"},{"location":"ai-agent/#configuration","title":"Configuration","text":"<p>The demo is configured via environment variables in <code>docker-compose.yml</code>:</p> <pre><code>ai-agent:\n  environment:\n    - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317\n    - OTEL_SERVICE_NAME=ai-agent-demo\n    - OLLAMA_HOST=http://ollama:11434\n</code></pre>"},{"location":"ai-agent/#troubleshooting","title":"Troubleshooting","text":"<p>No AI traces appearing?</p> <ul> <li>Ensure ollyScale core is running</li> <li>Check agent logs: <code>docker logs ai-agent-demo</code></li> <li>Verify Ollama is ready: <code>docker logs ollama</code></li> </ul> <p>Model download taking long?</p> <ul> <li>TinyLlama is ~600MB, first download may take a few minutes</li> <li>Check Ollama logs for download progress</li> </ul> <p>Agent errors?</p> <ul> <li>Ollama needs time to load the model after container starts</li> <li>The agent waits 10 seconds before first call</li> </ul>"},{"location":"api/","title":"REST API &amp; OpenAPI","text":"<p>OpenAPI documentation with interactive Swagger UI</p> <p>ollyScale provides a comprehensive REST API for programmatic access to all telemetry data in OpenTelemetry-native format.</p>"},{"location":"api/#interactive-api-documentation","title":"Interactive API Documentation","text":"<p>Access the auto-generated OpenAPI documentation:</p> <ul> <li>Swagger UI: <code>http://localhost:5005/docs</code> - Interactive API explorer</li> <li>ReDoc: <code>http://localhost:5005/redoc</code> - Alternative documentation</li> <li>OpenAPI Spec: <code>http://localhost:5005/openapi.json</code> - Machine-readable schema</li> </ul> <p>All APIs return OpenTelemetry-native JSON with:</p> <ul> <li>Resources: <code>service.name</code>, <code>host.name</code>, etc.</li> <li>Attributes: Metric labels and span attributes</li> <li>Full Context: Trace/span IDs, timestamps, status codes</li> </ul>"},{"location":"api/#api-endpoints-overview","title":"API Endpoints Overview","text":"<p>The REST API provides endpoints for:</p> Endpoint Method Description <code>/api/traces</code> GET List recent traces with filtering <code>/api/traces/{trace_id}</code> GET Get detailed trace with all spans <code>/api/spans</code> GET List recent spans with filtering <code>/api/logs</code> GET Retrieve logs with trace correlation <code>/api/metrics</code> GET Query time-series metrics <code>/api/service-map</code> GET Get service dependency graph <code>/api/service-catalog</code> GET List services with RED metrics <code>/api/stats</code> GET System stats and cardinality info <code>/admin/stats</code> GET Detailed admin statistics <code>/health</code> GET Health check endpoint <p>All endpoints return data in standard OpenTelemetry format, ensuring compatibility with OpenTelemetry tooling and standards.</p>"},{"location":"api/#common-api-workflows","title":"Common API Workflows","text":""},{"location":"api/#1-get-all-recent-traces","title":"1. Get All Recent Traces","text":"<p>Retrieve the last 50 traces:</p> cURL <p><code>bash     curl http://localhost:5005/api/traces?limit=50</code></p> Python <pre><code>import requests\n\n    response = requests.get('http://localhost:5005/api/traces', params={'limit': 50})\n    traces = response.json()\n\n    for trace in traces:\n        print(f\"Trace {trace['trace_id']}: {trace['service_name']} - {trace['name']}\")\n    ```\n\n=== \"JavaScript\"\n``javascript\n    fetch('http://localhost:5005/api/traces?limit=50')\n      .then(response =&gt; response.json())\n      .then(traces =&gt; {\n        traces.forEach(trace =&gt; {\n          console.log(`Trace ${trace.trace_id}: ${trace.service_name} - ${trace.name}`);\n        });\n      });\n    ``\n\n**Response Format:**\n\n```json\n[\n  {\n    \"trace_id\": \"a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\",\n    \"service_name\": \"demo-frontend\",\n    \"name\": \"GET /products\",\n    \"start_time\": 1701234567890000000,\n    \"duration_ms\": 125.4,\n    \"status_code\": 200,\n    \"method\": \"GET\",\n    \"route\": \"/products\",\n    \"span_count\": 5\n  }\n]\n</code></pre>"},{"location":"api/#2-get-detailed-trace-with-waterfall","title":"2. Get Detailed Trace with Waterfall","text":"<p>Retrieve a complete trace with all spans for waterfall visualization:</p> cURL <p><code>bash     curl http://localhost:5005/api/traces/a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6</code></p> Python <pre><code>import requests\n\n    trace_id = \"a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\"\n    response = requests.get(f'http://localhost:5005/api/traces/{trace_id}')\n    trace = response.json()\n\n    print(f\"Trace: {trace['name']}\")\n    print(f\"Total spans: {len(trace['spans'])}\")\n    print(f\"Duration: {trace['duration_ms']}ms\")\n\n    for span in trace['spans']:\n        indent = \"  \" * span.get('level', 0)\n        print(f\"{indent}{span['name']} ({span['duration_ms']}ms)\")\n    ```\n\n**Response Format:**\n\n```json\n{\n  \"trace_id\": \"a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\",\n  \"name\": \"GET /products\",\n  \"service_name\": \"demo-frontend\",\n  \"start_time\": 1701234567890000000,\n  \"duration_ms\": 125.4,\n  \"span_count\": 5,\n  \"spans\": [\n    {\n      \"span_id\": \"1234567890abcdef\",\n      \"parent_span_id\": null,\n      \"name\": \"GET /products\",\n      \"service_name\": \"demo-frontend\",\n      \"start_time\": 1701234567890000000,\n      \"duration_ms\": 125.4,\n      \"status\": { \"code\": 1 },\n      \"attributes\": {\n        \"http.method\": \"GET\",\n        \"http.route\": \"/products\",\n        \"http.status_code\": 200\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#3-find-logs-for-a-specific-trace","title":"3. Find Logs for a Specific Trace","text":"<p>Correlate logs with a trace using trace_id:</p> cURL <p><code>bash     curl \"http://localhost:5005/api/logs?trace_id=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\"</code></p> Python <pre><code>import requests\n\n    trace_id = \"a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\"\n    response = requests.get('http://localhost:5005/api/logs',\n                           params={'trace_id': trace_id})\n    logs = response.json()\n\n    for log in logs:\n        print(f\"[{log['severity']}] {log['body']}\")\n    ```\n\n**Response Format:**\n\n```json\n[\n  {\n    \"timestamp\": 1701234567890000000,\n    \"trace_id\": \"a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\",\n    \"span_id\": \"1234567890abcdef\",\n    \"severity\": \"INFO\",\n    \"body\": \"Processing product request\",\n    \"service_name\": \"demo-frontend\",\n    \"attributes\": {\n      \"user_id\": \"12345\"\n    }\n  }\n]\n</code></pre>"},{"location":"api/#4-query-metrics","title":"4. Query Metrics","text":"<p>Retrieve metrics data:</p> cURL <p><code>bash     curl http://localhost:5005/api/metrics</code></p> Python <pre><code>import requests\n\n    response = requests.get('http://localhost:5005/api/metrics')\n    metrics = response.json()\n\n    for metric in metrics:\n        print(f\"{metric['name']} ({metric['type']})\")\n        for series in metric.get('series', []):\n            labels = ', '.join(f\"{k}={v}\" for k, v in series.get('attributes', {}).items())\n            print(f\"  [{labels}] = {series.get('value', 'N/A')}\")\n    ```\n\n**Response Format:**\n\n```json\n[\n  {\n    \"name\": \"http.server.duration\",\n    \"type\": \"histogram\",\n    \"description\": \"HTTP request duration\",\n    \"unit\": \"ms\",\n    \"series\": [\n      {\n        \"attributes\": {\n          \"http.method\": \"GET\",\n          \"http.route\": \"/products\",\n          \"service.name\": \"demo-frontend\"\n        },\n        \"data_points\": [\n          {\n            \"timestamp\": 1701234567890000000,\n            \"count\": 42,\n            \"sum\": 5250.5,\n            \"bucket_counts\": [10, 20, 10, 2]\n          }\n        ]\n      }\n    ]\n  }\n]\n</code></pre>"},{"location":"api/#5-get-service-catalog-with-red-metrics","title":"5. Get Service Catalog with RED Metrics","text":"<p>List all services with Rate, Errors, and Duration metrics:</p> cURL <p><code>bash     curl http://localhost:5005/api/service-catalog</code></p> Python <pre><code>import requests\n\n    response = requests.get('http://localhost:5005/api/service-catalog')\n    services = response.json()\n\n    for service in services:\n        print(f\"\\n{service['service_name']}\")\n        print(f\"  Request Rate: {service.get('request_rate', 0):.2f} req/s\")\n        print(f\"  Error Rate: {service.get('error_rate', 0):.2f}%\")\n        print(f\"  P50 Latency: {service.get('p50_latency', 0):.2f}ms\")\n        print(f\"  P95 Latency: {service.get('p95_latency', 0):.2f}ms\")\n    ```\n\n**Response Format:**\n\n```json\n[\n  {\n    \"service_name\": \"demo-frontend\",\n    \"span_count\": 1523,\n    \"request_rate\": 12.5,\n    \"error_rate\": 2.3,\n    \"p50_latency\": 45.2,\n    \"p95_latency\": 125.7,\n    \"p99_latency\": 250.3,\n    \"first_seen\": 1701234567890000000,\n    \"last_seen\": 1701238167890000000\n  }\n]\n</code></pre>"},{"location":"api/#6-get-service-dependency-map","title":"6. Get Service Dependency Map","text":"<p>Retrieve the service dependency graph:</p> cURL <p><code>bash     curl http://localhost:5005/api/service-map</code></p> Python <pre><code>import requests\n\n    response = requests.get('http://localhost:5005/api/service-map')\n    graph = response.json()\n\n    print(\"Services:\", len(graph['nodes']))\n    for node in graph['nodes']:\n        print(f\"  - {node['service_name']} ({node['type']})\")\n\n    print(\"\\nConnections:\", len(graph['edges']))\n    for edge in graph['edges']:\n        print(f\"  {edge['source']} \u2192 {edge['target']} ({edge['call_count']} calls)\")\n    ```\n\n**Response Format:**\n\n```json\n{\n  \"nodes\": [\n    {\n      \"service_name\": \"demo-frontend\",\n      \"type\": \"server\",\n      \"span_count\": 1523\n    },\n    {\n      \"service_name\": \"demo-backend\",\n      \"type\": \"server\",\n      \"span_count\": 3046\n    }\n  ],\n  \"edges\": [\n    {\n      \"source\": \"demo-frontend\",\n      \"target\": \"demo-backend\",\n      \"call_count\": 1523\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#7-check-system-statistics","title":"7. Check System Statistics","text":"<p>Get Redis memory usage and cardinality metrics:</p> cURL <p><code>bash     curl http://localhost:5005/api/stats</code></p> Python <pre><code>import requests\n\n    response = requests.get('http://localhost:5005/api/stats')\n    stats = response.json()\n\n    print(f\"Total Traces: {stats.get('total_traces', 0)}\")\n    print(f\"Total Spans: {stats.get('total_spans', 0)}\")\n    print(f\"Total Logs: {stats.get('total_logs', 0)}\")\n    print(f\"Total Metrics: {stats.get('total_metrics', 0)}\")\n    print(f\"Unique Metric Names: {stats.get('unique_metric_names', 0)}\")\n    print(f\"Redis Memory: {stats.get('redis_memory_mb', 0):.2f} MB\")\n    ```\n\n**Response Format:**\n\n```json\n{\n  \"total_traces\": 1523,\n  \"total_spans\": 7615,\n  \"total_logs\": 15230,\n  \"total_metrics\": 45,\n  \"unique_metric_names\": 12,\n  \"redis_memory_mb\": 45.7,\n  \"cardinality_limit\": 1000,\n  \"cardinality_usage_pct\": 1.2,\n  \"uptime_seconds\": 3600\n}\n</code></pre>"},{"location":"api/#advanced-filtering","title":"Advanced Filtering","text":""},{"location":"api/#filter-spans-by-service","title":"Filter Spans by Service","text":"<pre><code>curl \"http://localhost:5005/api/spans?service=demo-frontend&amp;limit=100\"\n</code></pre>"},{"location":"api/#filter-logs-by-severity","title":"Filter Logs by Severity","text":"<pre><code>curl \"http://localhost:5005/api/logs?severity=ERROR&amp;limit=50\"\n</code></pre>"},{"location":"api/#time-based-queries","title":"Time-based Queries","text":"<p>All endpoints support <code>start_time</code> and <code>end_time</code> parameters (Unix nanoseconds):</p> <pre><code># Get traces from the last hour\nSTART=$(date -u -d '1 hour ago' +%s)000000000\nEND=$(date -u +%s)000000000\ncurl \"http://localhost:5005/api/traces?start_time=$START&amp;end_time=$END\"\n</code></pre>"},{"location":"api/#client-generation","title":"Client Generation","text":"<p>Generate API clients in any language using the OpenAPI spec:</p> <pre><code># Download OpenAPI spec\ncurl http://localhost:5005/openapi.json &gt; ollyscale-openapi.json\n\n# Generate Python client\nopenapi-generator-cli generate \\\n  -i ollyscale-openapi.json \\\n  -g python \\\n  -o ./ollyscale-python-client\n\n# Generate Go client\nopenapi-generator-cli generate \\\n  -i ollyscale-openapi.json \\\n  -g go \\\n  -o ./ollyscale-go-client\n\n# Generate TypeScript client\nopenapi-generator-cli generate \\\n  -i ollyscale-openapi.json \\\n  -g typescript-fetch \\\n  -o ./ollyscale-ts-client\n</code></pre>"},{"location":"api/#rate-limits","title":"Rate Limits","text":"<p>ollyScale is designed for local development and has no rate limits. However:</p> <ul> <li>Memory limits apply based on Redis configuration (default: 256MB)</li> <li>Cardinality protection limits unique metric names to 1000 (configurable)</li> <li>TTL: All data expires after 30 minutes</li> </ul>"},{"location":"api/#authentication","title":"Authentication","text":"<p>ollyScale is designed for local development and does not include authentication. Do not expose ollyScale to the internet without adding authentication via a reverse proxy.</p>"},{"location":"api/#need-help","title":"Need Help?","text":"<ul> <li>View interactive examples in Swagger UI</li> <li>Open an issue on GitHub</li> <li>Read the technical architecture</li> </ul>"},{"location":"database-connection-pooling/","title":"Database Connection Pooling and Star Schema ETL Pattern","text":""},{"location":"database-connection-pooling/#overview","title":"Overview","text":"<p>ollyScale uses SQLAlchemy with asyncpg for high-performance async PostgreSQL access with a star schema dimensional model. This document covers connection pooling, transaction management, and the ETL pattern used to avoid deadlocks in multi-process environments.</p>"},{"location":"database-connection-pooling/#star-schema-architecture","title":"Star Schema Architecture","text":"<p>ollyScale implements a dimensional model with:</p> <ul> <li>Dimension tables: <code>namespace_dim</code>, <code>service_dim</code>, <code>operation_dim</code>, <code>resource_dim</code></li> <li>Fact tables: <code>spans_fact</code>, <code>logs_fact</code>, <code>metrics_fact</code></li> </ul>"},{"location":"database-connection-pooling/#multi-process-transaction-strategy","title":"Multi-Process Transaction Strategy","text":"<p>In multi-process/multi-threaded environments, traditional single-transaction upserts cause deadlocks when multiple processes try to insert the same dimensions simultaneously.</p> <p>Solution - Two-Phase ETL Pattern:</p> <p>Phase 1 - Dimension Upserts (Independent, Auto-Commit):</p> <ul> <li>Each dimension upsert commits immediately after INSERT</li> <li>Idempotent operations (<code>INSERT ON CONFLICT DO UPDATE</code>)</li> <li>No locks held between dimension operations</li> <li>If batch fails and retries, dimensions already exist (safe)</li> <li>Works from outer edge inward: namespace \u2192 service \u2192 operation</li> </ul> <p>Phase 2 - Fact Inserts (Single Transaction):</p> <ul> <li>After ALL dimensions committed, insert facts in one transaction</li> <li>Facts reference dimensions via foreign keys</li> <li>Dimensions guaranteed to exist from Phase 1</li> </ul> <p>Benefits:</p> <ul> <li>No deadlocks from concurrent dimension upserts</li> <li>Idempotent retries (dimensions survive batch failures)</li> <li>Better concurrency (no long-held locks)</li> <li>Connection pool efficiency maintained</li> </ul>"},{"location":"database-connection-pooling/#testing-implications","title":"Testing Implications","text":"<p>Important: Dimension auto-commits affect test isolation.</p> <p>Problem: Standard test patterns using transaction rollback don't work:</p> <ul> <li>Dimensions commit immediately (not rolled back)</li> <li>Test data leaks between tests</li> <li>Non-deterministic dimension IDs</li> </ul> <p>Solution: <code>clean_database</code> fixture must truncate dimensions AND facts:</p> <pre><code>@pytest_asyncio.fixture\nasync def clean_database(postgres_session):\n    \"\"\"Clean dimensions AND facts for test isolation.\"\"\"\n    await postgres_session.execute(\n        \"TRUNCATE TABLE spans_fact, logs_fact, metrics_fact, \"\n        \"namespace_dim, service_dim, operation_dim, resource_dim \"\n        \"CASCADE\"\n    )\n    await postgres_session.commit()\n</code></pre> <p>See <code>tests/conftest.py</code> for complete fixture implementation.</p>"},{"location":"database-connection-pooling/#connection-pool-configuration","title":"Connection Pool Configuration","text":"<p>Connection pool settings in <code>app/db/session.py</code>:</p> <pre><code>self.engine = create_async_engine(\n    url,\n    pool_size=10,              # Base pool size (concurrent connections)\n    max_overflow=20,           # Additional connections beyond pool_size\n    pool_pre_ping=True,        # Verify connections before use\n    pool_recycle=3600,         # Recycle connections after 1 hour\n)\n</code></pre> <p>Environment variables:</p> <ul> <li><code>DATABASE_POOL_SIZE</code> - Base pool size (default: 10)</li> <li><code>DATABASE_MAX_OVERFLOW</code> - Additional overflow connections (default: 20)</li> </ul>"},{"location":"database-connection-pooling/#session-management-pattern","title":"Session Management Pattern","text":""},{"location":"database-connection-pooling/#correct-star-schema-two-phase-pattern","title":"\u2705 CORRECT: Star Schema Two-Phase Pattern","text":"<pre><code>async def store_traces(self, resource_spans: list[dict]) -&gt; int:\n    \"\"\"Store OTLP traces - star schema ETL pattern.\"\"\"\n    async with AsyncSession(self.engine) as session:\n        # Phase 1: Dimension upserts (each commits immediately)\n        namespace_id = await self._upsert_namespace(session, namespace)  # COMMITS\n        service_id = await self._upsert_service(session, name, namespace_id)  # COMMITS\n        operation_id = await self._upsert_operation(session, service_id, op_name, kind)  # COMMITS\n\n        # Phase 2: Fact inserts (single transaction after dimensions exist)\n        session.add_all(spans_to_insert)\n        await session.commit()  # Final commit for facts\n</code></pre> <p>Benefits:</p> <ul> <li>\u2705 No deadlocks in multi-process environments</li> <li>\u2705 Idempotent dimension upserts survive retries</li> <li>\u2705 Clean traces with minimal transaction control spans</li> <li>\u2705 Better performance (fewer round-trips)</li> </ul>"},{"location":"database-connection-pooling/#incorrect-multiple-commits-per-request","title":"\u274c INCORRECT: Multiple Commits Per Request","text":"<pre><code>async def _upsert_service(self, session: AsyncSession, name: str) -&gt; int:\n    \"\"\"BAD: Committing inside helper method.\"\"\"\n    stmt = insert(ServiceDim).values(name=name)\n    await session.execute(stmt)\n    await session.commit()  # \u274c WRONG - breaks connection reuse\n    return service_id\n</code></pre> <p>Problems:</p> <ul> <li>\u274c Connection returned to pool after each commit</li> <li>\u274c Next operation may get different connection</li> <li>\u274c Multiple BEGIN/COMMIT/ROLLBACK cycles</li> <li>\u274c Auto-instrumentation creates span for each transaction control</li> <li>\u274c Trace noise: 20+ BEGIN/COMMIT/ROLLBACK spans instead of 1-2</li> </ul>"},{"location":"database-connection-pooling/#trace-impact","title":"Trace Impact","text":""},{"location":"database-connection-pooling/#before-fix-multiple-commits","title":"Before Fix (Multiple Commits)","text":"<pre><code>gRPC Export (215ms)\n\u251c\u2500 connect #1 (5ms)\n\u2502  \u251c\u2500 BEGIN\n\u2502  \u251c\u2500 SELECT tenant_dim\n\u2502  \u2514\u2500 COMMIT\n\u251c\u2500 connect #2 (5ms)\n\u2502  \u251c\u2500 BEGIN\n\u2502  \u251c\u2500 INSERT namespace_dim\n\u2502  \u251c\u2500 COMMIT\n\u2502  \u251c\u2500 BEGIN\n\u2502  \u251c\u2500 SELECT namespace_dim\n\u2502  \u2514\u2500 ROLLBACK\n\u251c\u2500 connect #3 (5ms)\n\u2502  \u251c\u2500 BEGIN\n\u2502  \u251c\u2500 INSERT service_dim\n\u2502  \u251c\u2500 COMMIT\n\u2502  \u251c\u2500 BEGIN\n\u2502  \u2514\u2500 ROLLBACK\n... (8 total connections) ...\n\u2514\u2500 connect #8 (5ms)\n   \u251c\u2500 BEGIN\n   \u251c\u2500 INSERT logs_fact (24 records)\n   \u2514\u2500 COMMIT\n</code></pre> <p>Issues:</p> <ul> <li>8 separate connections in single request</li> <li>20+ transaction control spans (BEGIN, COMMIT, ROLLBACK)</li> <li>Connection pool thrashing</li> <li>Excessive trace noise</li> </ul>"},{"location":"database-connection-pooling/#after-fix-single-transaction","title":"After Fix (Single Transaction)","text":"<pre><code>gRPC Export (180ms) - 35ms faster!\n\u2514\u2500 connect (5ms)\n   \u251c\u2500 BEGIN\n   \u251c\u2500 SELECT tenant_dim\n   \u251c\u2500 INSERT namespace_dim\n   \u251c\u2500 SELECT namespace_dim\n   \u251c\u2500 INSERT service_dim\n   \u251c\u2500 SELECT service_dim\n   \u251c\u2500 INSERT operation_dim\n   \u251c\u2500 SELECT operation_dim\n   \u251c\u2500 INSERT logs_fact (24 records)\n   \u2514\u2500 COMMIT\n</code></pre> <p>Benefits:</p> <ul> <li>\u2705 1 connection per request</li> <li>\u2705 2 transaction control spans (BEGIN, COMMIT)</li> <li>\u2705 Clean, readable trace</li> <li>\u2705 17% performance improvement</li> </ul>"},{"location":"database-connection-pooling/#opentelemetry-auto-instrumentation","title":"OpenTelemetry Auto-Instrumentation","text":""},{"location":"database-connection-pooling/#sqlalchemy-instrumentation-configuration","title":"SQLAlchemy Instrumentation Configuration","text":"<p>In <code>charts/ollyscale/values.yaml</code>:</p> <pre><code>instrumentation:\n  python:\n    env:\n      # Disable SQL comment injection (reduces overhead)\n      - name: OTEL_INSTRUMENTATION_SQLALCHEMY_ENABLE_COMMENTER\n        value: 'false'\n\n      # Instrument all engines automatically\n      - name: OTEL_PYTHON_SQLALCHEMY_INSTRUMENT_ALL_ENGINES\n        value: 'true'\n</code></pre>"},{"location":"database-connection-pooling/#trace-span-reduction-strategies","title":"Trace Span Reduction Strategies","text":"<ol> <li>Remove intermediate commits - Covered above \u2705</li> <li>Use batch inserts - <code>session.add_all()</code> instead of loops</li> <li>Disable SQL commenter - Reduces per-query overhead</li> <li>Connection pooling - Reuse connections across requests</li> </ol>"},{"location":"database-connection-pooling/#troubleshooting","title":"Troubleshooting","text":""},{"location":"database-connection-pooling/#symptom-many-connect-spans-per-request","title":"Symptom: Many \"connect\" spans per request","text":"<p>Diagnosis: Check for intermediate <code>session.commit()</code> calls in helper methods.</p> <p>Fix: Remove commits from <code>_upsert_*</code> methods, let caller handle single commit.</p>"},{"location":"database-connection-pooling/#symptom-begincommitrollback-span-noise","title":"Symptom: BEGIN/COMMIT/ROLLBACK span noise","text":"<p>Diagnosis: Multiple transactions per request due to intermediate commits.</p> <p>Fix: Same as above - one transaction per request.</p>"},{"location":"database-connection-pooling/#symptom-connection-already-being-used-errors","title":"Symptom: \"connection already being used\" errors","text":"<p>Diagnosis: Session being used from multiple coroutines (not thread-safe).</p> <p>Fix: Each async task needs its own session. Don't share sessions across <code>asyncio.create_task()</code> calls.</p>"},{"location":"database-connection-pooling/#symptom-connection-pool-exhausted-warnings","title":"Symptom: \"connection pool exhausted\" warnings","text":"<p>Diagnosis: Connection leaks or insufficient pool size.</p> <p>Fix:</p> <ol> <li>Verify all sessions use <code>async with</code> context manager</li> <li>Increase <code>DATABASE_POOL_SIZE</code> or <code>DATABASE_MAX_OVERFLOW</code></li> <li>Check for long-running transactions blocking pool</li> </ol>"},{"location":"database-connection-pooling/#references","title":"References","text":"<ul> <li>SQLAlchemy Async Documentation</li> <li>asyncpg Pool Configuration</li> <li>OpenTelemetry SQLAlchemy Instrumentation</li> </ul>"},{"location":"database-connection-pooling/#related","title":"Related","text":"<ul> <li>Technical Architecture</li> <li>PostgreSQL Infrastructure</li> <li>Pre-commit Configuration</li> </ul>"},{"location":"ebpf/","title":"eBPF Zero-Code Tracing Demo","text":"<p>This demo showcases OpenTelemetry eBPF Instrumentation (OBI) - automatic trace capture at the kernel level without any code changes to your application.</p>"},{"location":"ebpf/#platform-requirements","title":"\u26a0\ufe0f Platform Requirements","text":"<p>Important: eBPF instrumentation requires a real Linux kernel and will NOT work in virtualized or emulated environments:</p> <p>\u2705 Supported Platforms:</p> <ul> <li>Native Linux Kubernetes clusters (GKE, EKS, AKS, bare-metal)</li> <li>Linux kernel 5.11 or newer</li> <li>Real hardware or KVM-based VMs</li> </ul> <p>\u274c Unsupported Platforms (will fail with memlock errors):</p> <ul> <li>KIND clusters on macOS/Windows</li> <li>Docker Desktop on macOS/Windows</li> <li>Podman on macOS</li> <li>Minikube with Docker driver on macOS/Windows</li> <li>Any Docker-in-Docker or VM-based Kubernetes</li> </ul> <p>For Local Development: Use the OpenTelemetry Operator auto-instrumentation feature instead, which works on all platforms by injecting SDK instrumentation at runtime.</p>"},{"location":"ebpf/#what-is-obi","title":"What is OBI?","text":"<p>OpenTelemetry eBPF Instrumentation (formerly Grafana Beyla) uses eBPF to automatically capture HTTP/gRPC traces by inspecting system calls and network traffic at the Linux kernel level.</p> <p>Key Benefits:</p> <ul> <li>Zero code changes - no SDK, no agent, no restarts</li> <li>Language agnostic - works with Python, Go, Java, Node.js, Rust, C, PHP, and more</li> <li>Protocol-level instrumentation - captures any HTTP/gRPC traffic</li> </ul>"},{"location":"ebpf/#quick-start","title":"Quick Start","text":""},{"location":"ebpf/#docker","title":"Docker","text":"<pre><code># Start ollyScale core first\ncd docker\n./01-start-core.sh\n\n# Deploy eBPF demo (pulls pre-built images from Docker Hub)\ncd ../apps/demo-ebpf\n./01-deploy-ebpf-demo.sh\n</code></pre> <p>Access the UI at <code>http://localhost:5005</code></p>"},{"location":"ebpf/#kubernetes","title":"Kubernetes","text":"<pre><code># Start ollyScale core first\nminikube start\ncd charts\n./install.sh\n\n# Deploy eBPF demo (pulls pre-built images from Docker Hub)\ncd ../k8s-demo-ebpf\n./02-deploy.sh\n</code></pre> <p>Run <code>minikube tunnel</code> in a separate terminal, then access the UI at <code>http://localhost:5002</code></p>"},{"location":"ebpf/#docker-hub-images","title":"Docker Hub Images","text":"<p>The eBPF demo uses pre-built images from Docker Hub:</p> <ul> <li><code>ghcr.io/ryanfaircloth/ebpf-frontend:latest</code> - Frontend with OTel SDK for metrics/logs</li> <li><code>ghcr.io/ryanfaircloth/ebpf-backend:latest</code> - Pure Flask backend (no OTel SDK)</li> </ul> <p>For local development, use the build scripts in each demo folder.</p>"},{"location":"ebpf/#whats-different-from-sdk-instrumentation","title":"What's Different from SDK Instrumentation?","text":""},{"location":"ebpf/#traces","title":"Traces","text":"Aspect SDK Instrumentation eBPF Instrumentation Span names Route names (<code>GET /hello</code>, <code>POST /api/users</code>) Generic (<code>in queue</code>, <code>CONNECT</code>, <code>HTTP</code>) Span attributes Rich application context (user IDs, request params) Network-level only (host, port, method) Distributed tracing Full trace propagation via headers Limited - eBPF sees connections, not header context Setup Code changes or auto-instrumentation wrapper Deploy eBPF agent alongside app <p>Example - SDK trace:</p> <pre><code>{\n  \"trace_id\": \"abc123...\",\n  \"span_name\": \"GET /process-order\",\n  \"attributes\": {\n    \"http.method\": \"GET\",\n    \"http.route\": \"/process-order\",\n    \"http.status_code\": 200,\n    \"order.id\": \"12345\",\n    \"customer.id\": \"678\"\n  }\n}\n</code></pre> <p>Example - eBPF trace:</p> <pre><code>{\n  \"trace_id\": \"def456...\",\n  \"span_name\": \"in queue\",\n  \"attributes\": {\n    \"net.host.name\": \"ebpf-frontend\",\n    \"net.host.port\": 5000\n  }\n}\n</code></pre>"},{"location":"ebpf/#logs","title":"Logs","text":"<p>With SDK instrumentation, logs include trace context (<code>trace_id</code>, <code>span_id</code>) for correlation:</p> <pre><code>{\n  \"message\": \"Processing order 12345\",\n  \"trace_id\": \"abc123...\",\n  \"span_id\": \"xyz789...\"\n}\n</code></pre> <p>With eBPF instrumentation, logs have no trace context because there's no tracing SDK to inject it:</p> <pre><code>{\n  \"message\": \"Processing order 12345\",\n  \"trace_id\": \"\",\n  \"span_id\": \"\"\n}\n</code></pre> <p>This is expected behavior - eBPF operates at the kernel level and cannot inject context into application logs.</p>"},{"location":"ebpf/#metrics","title":"Metrics","text":"<p>Metrics work the same way in both approaches - they're exported via the OTel SDK regardless of how traces are captured.</p>"},{"location":"ebpf/#components","title":"Components","text":""},{"location":"ebpf/#frontend-ebpf-frontend","title":"Frontend (<code>ebpf-frontend</code>)","text":"<ul> <li>Flask application with auto-traffic generation</li> <li>Metrics: Exported via OTel SDK (<code>OTLPMetricExporter</code>)</li> <li>Logs: Exported via OTel SDK (<code>OTLPLogExporter</code>)</li> <li>Traces: None from SDK - captured by eBPF agent</li> </ul>"},{"location":"ebpf/#backend-ebpf-backend","title":"Backend (<code>ebpf-backend</code>)","text":"<ul> <li>Pure Flask application - no OTel SDK at all</li> <li>Demonstrates that eBPF can trace completely uninstrumented apps</li> <li>Logs go to stdout only (not exported to OTel)</li> </ul>"},{"location":"ebpf/#ebpf-agent-otel-ebpf-agent","title":"eBPF Agent (<code>otel-ebpf-agent</code>)","text":"<ul> <li>Runs with <code>privileged: true</code> and <code>pid: host</code></li> <li>Monitors port 5000 for HTTP traffic</li> <li>Sends traces to OTel Collector</li> </ul>"},{"location":"ebpf/#when-to-use-ebpf-vs-sdk","title":"When to Use eBPF vs SDK","text":"<p>Use eBPF when:</p> <ul> <li>You can't modify application code (legacy apps, third-party binaries)</li> <li>You want basic HTTP observability with zero effort</li> <li>You're instrumenting many polyglot services quickly</li> </ul> <p>Use SDK when:</p> <ul> <li>You need rich application-level context in traces</li> <li>You need log-trace correlation</li> <li>You need custom spans for business logic</li> <li>You need full distributed tracing with context propagation</li> </ul> <p>Hybrid approach (this demo):</p> <ul> <li>Use eBPF for traces (zero-code)</li> <li>Use SDK for metrics and logs (richer data)</li> </ul>"},{"location":"ebpf/#configuration","title":"Configuration","text":""},{"location":"ebpf/#docker_1","title":"Docker","text":"<p>The eBPF agent is configured via environment variables in <code>docker-compose.yml</code>:</p> <pre><code>otel-ebpf-agent:\n  image: docker.io/otel/ebpf-instrument:main\n  privileged: true\n  pid: host\n  environment:\n    - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317\n    - OTEL_EBPF_OPEN_PORT=5000\n  volumes:\n    - /sys/kernel/debug:/sys/kernel/debug:rw\n</code></pre>"},{"location":"ebpf/#kubernetes_1","title":"Kubernetes","text":""},{"location":"ebpf/#using-the-ollyscale-helm-chart-recommended","title":"Using the ollyScale Helm Chart (Recommended)","text":"<p>The easiest way to deploy the eBPF agent in Kubernetes is using the ollyScale Helm chart:</p> <pre><code># Install ollyScale with eBPF agent enabled\nhelm install ollyscale ./charts/ollyscale \\\n  --namespace ollyscale \\\n  --create-namespace \\\n  --set ebpfAgent.enabled=true \\\n  --set ebpfAgent.config.openPorts=\"5000,8080,3000\"\n</code></pre> <p>Or create a custom <code>values.yaml</code>:</p> <pre><code># values-with-ebpf.yaml\nebpfAgent:\n  enabled: true\n  config:\n    # Ports to instrument (comma-separated)\n    openPorts: \"5000,8080,3000\"\n    # Service name prefix\n    serviceName: \"my-app\"\n    # Collector endpoint\n    otlpEndpoint: \"http://gateway-collector.ollyscale.svc.cluster.local:4317\"\n  resources:\n    limits:\n      memory: 512Mi\n    requests:\n      cpu: 100m\n      memory: 256Mi\n</code></pre> <p>Then install:</p> <pre><code>helm install ollyscale ./charts/ollyscale \\\n  --namespace ollyscale \\\n  --create-namespace \\\n  --values values-with-ebpf.yaml\n</code></pre> <p>The Helm chart automatically creates:</p> <ul> <li>DaemonSet for eBPF agent (one pod per node)</li> <li>ServiceAccount with proper permissions</li> <li>ClusterRole/ClusterRoleBinding for node and pod access</li> <li>Integration with ollyScale's gateway collector</li> </ul>"},{"location":"ebpf/#manual-kubernetes-deployment","title":"Manual Kubernetes Deployment","text":"<p>In Kubernetes, the eBPF agent runs as a DaemonSet to instrument all pods on each node:</p> <pre><code>apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: otel-ebpf-agent\nspec:\n  template:\n    spec:\n      hostPID: true\n      containers:\n        - name: ebpf-agent\n          image: docker.io/otel/ebpf-instrument:main\n          securityContext:\n            privileged: true\n          env:\n            - name: OTEL_EXPORTER_OTLP_ENDPOINT\n              value: \"http://otel-collector:4317\"\n            - name: OTEL_EBPF_OPEN_PORT\n              value: \"5000\"\n          volumeMounts:\n            - name: sys-kernel-debug\n              mountPath: /sys/kernel/debug\n      volumes:\n        - name: sys-kernel-debug\n          hostPath:\n            path: /sys/kernel/debug\n</code></pre>"},{"location":"ebpf/#key-settings","title":"Key Settings","text":"<ul> <li><code>OTEL_EBPF_OPEN_PORT</code>: Which port to monitor (5000 = Flask default)</li> <li><code>privileged: true</code>: Required for eBPF kernel access</li> <li><code>hostPID: true</code> / <code>pid: host</code>: Required to see processes in other containers/pods</li> </ul>"},{"location":"ebpf/#troubleshooting","title":"Troubleshooting","text":"<p>No traces appearing?</p> <ul> <li>Ensure ollyScale core is running (<code>docker ps | grep otel-collector</code>)</li> <li>Check eBPF agent logs: <code>docker logs otel-ebpf-instrumentation</code></li> <li>Verify the agent can access <code>/sys/kernel/debug</code></li> </ul> <p>Traces have wrong service name?</p> <ul> <li>OBI discovers service names from process info</li> <li>Set <code>OTEL_EBPF_SERVICE_NAME</code> for explicit naming</li> </ul> <p>eBPF agent won't start?</p> <ul> <li>Requires Linux kernel 4.4+ with eBPF support</li> <li>On macOS, runs inside Docker's Linux VM (should work)</li> <li>Check Docker has sufficient privileges</li> </ul>"},{"location":"ebpf/#learn-more","title":"Learn More","text":"<ul> <li>OpenTelemetry eBPF Instrumentation Docs</li> <li>OBI GitHub Repository</li> <li>OBI Docker Setup Guide</li> </ul>"},{"location":"kubernetes/","title":"Kubernetes Deployment","text":"<p>Deploy ollyScale on Kubernetes (Minikube) for local development!</p> <p>Service map showing microservices running on Kubernetes</p> <p>All examples are launched from the repo - clone it first or download the current GitHub release archive:</p> <pre><code>git clone https://github.com/ryanfaircloth/ollyscale\n</code></pre>"},{"location":"kubernetes/#prerequisites","title":"Prerequisites","text":"<ul> <li>Minikube</li> <li>kubectl</li> </ul>"},{"location":"kubernetes/#1-deploy-ollyscale-core","title":"1. Deploy ollyScale Core","text":"<ol> <li> <p>Start Minikube:</p> <pre><code>minikube start\n</code></pre> </li> <li> <p>Deploy ollyScale:</p> <pre><code>Deploy using Helm (images will be pulled from Docker Hub automatically):\n\n```bash\ncd charts\n./install.sh\n```\n\n!!! note \"Local Development Build (Optional)\"\nTo build and deploy custom images for local development:\n`bash\n</code></pre> <p>cd charts ./build-and-push-local.sh  ` <li> <p>Access the UI:</p> <p>To access the ollyScale UI (Service Type: LoadBalancer) on macOS with Minikube, you need to use <code>minikube tunnel</code>.</p> <p>Open a new terminal window and run:</p> <pre><code>minikube tunnel\n</code></pre> <p>You may be asked for your password. Keep this terminal open.</p> <p>Now you can access the ollyScale UI at: http://localhost:5002</p> <p>OpenTelemetry Collector + OpAMP Config Page: Navigate to the \"OpenTelemetry Collector + OpAMP Config\" tab in the UI to view and manage collector configurations remotely. See the OpAMP Configuration section below for setup instructions.</p> </li> <li> <p>Send Telemetry from Host Apps:</p> <p>To send telemetry from applications running on your host machine (outside Kubernetes), use <code>kubectl port-forward</code> to expose the OTel Collector ports:</p> <p>Open a new terminal window and run:</p> <pre><code>kubectl port-forward service/otel-collector 4317:4317 4318:4318\n</code></pre> <p>Keep this terminal open. Now point your application's OpenTelemetry exporter to: - gRPC: <code>http://localhost:4317</code> - HTTP: <code>http://localhost:4318</code></p> <p>Example environment variables:</p> <pre><code>export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318\n</code></pre> <p>For apps running inside the Kubernetes cluster: Use the Kubernetes service name: - gRPC: <code>http://otel-collector:4317</code> - HTTP: <code>http://otel-collector:4318</code></p> </li> <li> <p>Clean Up:</p> <p>Uninstall ollyScale using Helm:</p> <pre><code>helm uninstall ollyscale -n ollyscale\nkubectl delete namespace ollyscale\n</code></pre> <p>Shut down Minikube:</p> <pre><code>minikube stop\n</code></pre> <p>Minikube may be more stable if you delete it:</p> <pre><code>minikube delete\n</code></pre> </li>"},{"location":"kubernetes/#2-demo-applications-optional","title":"2. Demo Applications (Optional)","text":"<p>To see ollyScale in action with instrumented microservices:</p> <pre><code>cd k8s-demo\n./02-deploy.sh\n</code></pre> <p>The deploy script pulls demo images from Docker Hub by default. For local development, you can build images locally when prompted.</p> <p>To clean up the demo:</p> <pre><code>./03-cleanup.sh\n</code></pre> <p>The demo includes two microservices that automatically generate traffic, showcasing distributed tracing across service boundaries.</p>"},{"location":"kubernetes/#3-opentelemetry-demo-20-services-optional","title":"3. OpenTelemetry Demo (~20 Services - Optional)","text":"<p>To deploy the full OpenTelemetry Demo with ~20 microservices:</p> <p>Prerequisites:</p> <ul> <li>ollyScale must be deployed first (see Setup above)</li> <li>Helm installed</li> <li>Sufficient cluster resources (demo is resource-intensive)</li> </ul> <p>Deploy:</p> <pre><code>cd k8s-otel-demo\n./01-deploy-otel-demo-helm.sh\n</code></pre> <p>This deploys all OpenTelemetry Demo services configured to send telemetry to ollyScale's collector via HTTP on port 4318. Built-in observability tools (Jaeger, Grafana, Prometheus) are disabled.</p> <p>Cleanup:</p> <pre><code>cd k8s-otel-demo\n./02-cleanup-otel-demo-helm.sh\n</code></pre> <p>This removes the OpenTelemetry Demo but leaves ollyScale running.</p>"},{"location":"kubernetes/#4-ollyscale-core-only-deployment-use-your-own-kubernetes-opentelemetry-collector","title":"4. ollyScale Core-Only Deployment: Use Your Own Kubernetes OpenTelemetry Collector","text":"<p>To deploy ollyScale without the bundled OTel Collector (e.g., if you have an existing collector daemonset). Includes OpAMP server for optional remote collector configuration management:</p> <ol> <li>Deploy Core:</li> </ol> <pre><code>cd k8s-core-only\n./01-deploy.sh\n</code></pre> <ol> <li> <p>Access UI:    Run <code>minikube tunnel</code> and access <code>http://localhost:5002</code>.</p> </li> <li> <p>Cleanup:</p> </li> </ol> <pre><code>./02-cleanup.sh\n</code></pre>"},{"location":"kubernetes/#use-ollyscale-with-any-opentelemetry-collector","title":"Use ollyScale with Any OpenTelemetry Collector","text":"<p>Swap out the included Otel Collector for any distro of Otel Collector.</p> <p>Point your OpenTelemetry exporters to ollyscale-otlp-receiver:4343: i.e.</p> <pre><code>exporters:\n  debug:\n    verbosity: detailed\n\n  otlp:\n    endpoint: \"ollyscale-otlp-receiver:4343\"\n    tls:\n      insecure: true\n\nservice:\n  pipelines:\n    traces:\n      receivers: [otlp]\n      processors: [batch]\n      exporters: [debug, otlp, spanmetrics]\n\n    metrics:\n      receivers: [otlp, spanmetrics]\n      processors: [batch]\n      exporters: [debug, otlp]\n\n    logs:\n      receivers: [otlp]\n      processors: [batch]\n      exporters: [debug, otlp]\n</code></pre> <p>The Otel Collector will forward everything to ollyScale's OTLP receiver, which process telemetry and stores it in Redis in OTEL format for the backend and UI to access.</p>"},{"location":"kubernetes/#opamp-configuration-optional","title":"OpAMP Configuration (Optional)","text":"<p>The OpenTelemetry Collector + OpAMP Config page in the ollyScale UI allows you to view and manage collector configurations remotely. To enable this feature, add the OpAMP extension to your collector config:</p> <pre><code>extensions:\n  opamp:\n    server:\n      ws:\n        endpoint: ws://ollyscale-opamp-server:4320/v1/opamp\n\nservice:\n  extensions: [opamp]\n</code></pre> <p>The default configuration template (included as a ConfigMap in <code>k8s-core-only/ollyscale-opamp-server.yaml</code>) shows a complete example with OTLP receivers, OpAMP extension, batch processing, and spanmetrics connector. Your collector will connect to the OpAMP server and receive configuration updates through the ollyScale UI.</p>"},{"location":"kubernetes/#building-images","title":"Building Images","text":"<p>By default, deployment scripts pull pre-built images from GitHub Container Registry (GHCR). For building images locally (Minikube) or publishing to GHCR, see build/README.md.</p>"},{"location":"licensing/","title":"Licensing","text":"<p>ollyScale is released under the BSD 3-Clause License. The full license text is available in the LICENSE file. This license permits free use, modification, and redistribution for individuals, researchers, and small organizations.</p> <p>This project is forked from the BSD 3-Clause license and maintained by Ryan Faircloth. Eventually I will update the logo and naming to avoid confusion with the original project.</p>"},{"location":"metrics/","title":"Metrics &amp; Cardinality explorer","text":"<p>ollyScale provides a powerful interface for analyzing OpenTelemetry metrics, with specific tools designed to help you understand the shape and cardinality of your telemetry data.</p>"},{"location":"metrics/#metrics-table","title":"Metrics Table","text":"<p>The metrics table offers a dense, high-information view of all ingested metrics.</p> <p></p> <p>Click the Chart button to visualize metric data over time:</p> <p></p>"},{"location":"metrics/#key-columns","title":"Key Columns","text":"<ul> <li>Name: The full OTel metric name (e.g., <code>http.server.response.size</code>).</li> <li>Unit: The unit of measurement (e.g., <code>By</code>, <code>ms</code>).</li> <li>Type: The metric type (Histogram, Sum, Gauge, etc.).</li> <li>Resources: Click to view the unique resource combinations associated with this metric.</li> <li>Cardinality: Shows the number of label dimensions vs the total number of unique time series (e.g., <code>8 labels / 185 series</code>).</li> </ul>"},{"location":"metrics/#cardinality-explorer","title":"Cardinality Explorer","text":"<p>Clicking on the blue Cardinality link for any metric opens the Cardinality Explorer. This tool is essential for understanding \"high cardinality\" issues and exploring your data's dimensions.</p>"},{"location":"metrics/#1-header-stats","title":"1. Header Stats","text":"<ul> <li>Total Series (Historic): The total number of unique time series seen for this metric since startup (persisted in Redis).</li> <li>Active Series (1h): The count of series seen in the last hour.</li> <li>Label Dimensions: The number of unique label keys (e.g., <code>http.method</code>, <code>http.status_code</code>).</li> </ul>"},{"location":"metrics/#2-label-analysis-table","title":"2. Label Analysis Table","text":"<p>This table helps you identify which labels are contributing most to your cardinality.</p> <ul> <li>Label Name: The key of the label.</li> <li>Cardinality: The number of unique values for this label.</li> <li>Values (Top 5): A preview of the most common values.</li> <li>If there are more than 5 values, a clickable <code>...</code> link expands the list to show all values inline.</li> </ul>"},{"location":"metrics/#3-raw-active-series","title":"3. Raw Active Series","text":"<p>A scrollable view of all active series in a PromQL-like syntax:</p> <pre><code>{container.id=\"...\", http.method=\"GET\", http.route=\"/api/traces\", http.status_code=\"200\", service.name=\"ollyscale-ui\"}\n{container.id=\"...\", http.method=\"GET\", http.route=\"/health\", http.status_code=\"200\", service.name=\"ollyscale-ui\"}\n</code></pre>"},{"location":"metrics/#export-actions","title":"Export Actions","text":"<p>Use the buttons in the \"Raw Active Series\" section to export data for offline analysis:</p> <ul> <li>Copy PromQL: Copies the visible series list to your clipboard.</li> <li>Download JSON: Downloads the full series object as a JSON file.</li> </ul>"},{"location":"metrics/#cardinality-protection","title":"Cardinality Protection","text":"<p>ollyScale includes built-in protection against cardinality explosions to prevent memory exhaustion during local development.</p> <ul> <li>Hard Limit: 1000 unique metric names (configurable).</li> <li>Visual Warnings:</li> <li>\u26a0\ufe0f Yellow: &gt; 70% capacity</li> <li>\ud83d\udd34 Red: &gt; 90% capacity</li> <li>Behavior: Metrics exceeding the limit are dropped, and a system alert is triggered.</li> </ul> <p>See Cardinality Protection for more details.</p>"},{"location":"otel-collector/","title":"OpenTelemetry Collector","text":"<p>OpenTelemetry Collector configuration management via OpAMP</p> <p>ollyScale uses the OpenTelemetry Collector as the telemetry ingestion and shipping layer. The collector receives telemetry from your applications and forwards it to ollyScale's OTLP receiver.</p>"},{"location":"otel-collector/#opentelemetry-collector-opamp-config-page","title":"OpenTelemetry Collector + OpAMP Config Page","text":"<p>ollyScale includes a web interface for managing OpenTelemetry Collector configurations via the OpAMP (Open Agent Management Protocol). Access this page through the \"OpenTelemetry Collector + OpAMP Config\" tab in the ollyScale UI.</p> <p>Features:</p> <ul> <li>View current configuration from connected collectors</li> <li>Apply configuration changes with real-time validation</li> <li>Browse configuration templates for common use cases</li> <li>Monitor OpAMP server status and connected agents</li> <li>Preview configuration diffs before applying</li> </ul> <p>Requirements:</p> <ul> <li>Your collector must be configured with the OpAMP extension (see OpAMP Configuration below)</li> <li>Collector must be connected to the OpAMP server</li> </ul>"},{"location":"otel-collector/#configuration","title":"Configuration","text":"<p>ollyScale includes a sample collector configuration that you can customize for your needs. The configuration files are located at:</p> <ul> <li>Docker: <code>docker/otelcol-configs/config.yaml</code></li> <li>Kubernetes (Helm): Configured via Helm values - see <code>charts/ollyscale/values.yaml</code> for OTel Collector settings</li> </ul>"},{"location":"otel-collector/#default-configuration","title":"Default Configuration","text":"<p>The default configuration includes:</p> <ul> <li>OTLP Receivers: Accepts telemetry on ports 4317 (gRPC) and 4318 (HTTP)</li> <li>OpAMP Extension: Enables remote configuration management via ollyScale UI</li> <li>Span Metrics Connector: Automatically generates RED metrics from traces</li> <li>Batch Processor: Batches telemetry for efficient processing</li> <li>OTLP Exporter: Forwards all telemetry to ollyScale's OTLP receiver</li> </ul>"},{"location":"otel-collector/#customization-examples","title":"Customization Examples","text":"<p>You can extend the collector configuration to add additional capabilities. The collector uses the <code>otel/opentelemetry-collector-contrib</code> image which includes:</p> <ul> <li>Receivers: OTLP, Prometheus, Jaeger, Zipkin, and many more</li> <li>Processors: Batch, Memory Limiter, Resource Detection, Tail Sampling, Filtering</li> <li>Connectors: Span Metrics, Service Graph</li> <li>Exporters: OTLP, Prometheus, Logging, and many more</li> </ul> <p>For a complete list of available components, see the OpenTelemetry Collector Contrib documentation.</p>"},{"location":"otel-collector/#applying-changes","title":"Applying Changes","text":""},{"location":"otel-collector/#docker","title":"Docker","text":"<p>After modifying <code>docker/otelcol-configs/config.yaml</code> rebuild/restart using:</p> <pre><code>cd docker\n./01-start-core.sh\n</code></pre>"},{"location":"otel-collector/#kubernetes","title":"Kubernetes","text":"<p>When deployed via Helm, the OTel Collector is managed by the OpenTelemetry Operator. To customize the configuration:</p> <ol> <li>Edit <code>charts/ollyscale/values.yaml</code> under the <code>otelCollector</code> section</li> <li>Apply changes:</li> </ol> <pre><code>cd charts\nhelm upgrade ollyscale ./ollyscale -n ollyscale\n</code></pre> <p>Alternatively, patch the OpenTelemetryCollector custom resource directly:</p> <pre><code>kubectl edit opentelemetrycollector ollyscale-otel-collector -n ollyscale\n</code></pre>"},{"location":"otel-collector/#using-your-own-collector","title":"Using Your Own Collector","text":"<p>You can use your own OpenTelemetry Collector instance instead of the one bundled with ollyScale. This is useful if you have an existing collector setup or want to test specific collector configurations.</p> <p>To do this, deploy the Core-Only version of ollyScale (see Docker Deployment or Kubernetes Deployment).</p> <p>Then, configure your collector's OTLP exporter to send data to the ollyScale Receiver:</p> <ul> <li>Endpoint: <code>ollyscale-otlp-receiver:4343</code> (or <code>localhost:4343</code> from host)</li> <li>Protocol: gRPC</li> <li>TLS: Insecure (or configured as needed)</li> </ul> <p>Example Exporter Configuration:</p> <pre><code>exporters:\n  otlp:\n    endpoint: \"ollyscale-otlp-receiver:4343\"\n    tls:\n      insecure: true\n</code></pre>"},{"location":"otel-collector/#opamp-configuration-optional","title":"OpAMP Configuration (Optional)","text":"<p>The OpenTelemetry Collector + OpAMP Config page in the ollyScale UI allows you to view and manage collector configurations remotely. To enable this feature, add the OpAMP extension to your collector config:</p> <pre><code>extensions:\n  opamp:\n    server:\n      ws:\n        endpoint: ws://localhost:4320/v1/opamp\n\nservice:\n  extensions: [opamp]\n</code></pre> <p>The default configuration template (located at <code>docker/otelcol-configs/config.yaml</code>) shows a complete example with OTLP receivers, OpAMP extension, batch processing, and spanmetrics connector. Your collector will connect to the OpAMP server and receive configuration updates through the ollyScale UI.</p>"},{"location":"partition-management/","title":"Partition Management","text":""},{"location":"partition-management/#overview","title":"Overview","text":"<p>The ollyScale v2 backend uses PostgreSQL native table partitioning to efficiently manage time-series observability data. This document describes the automated partition management system.</p>"},{"location":"partition-management/#why-partitioning","title":"Why Partitioning?","text":"<p>Time-series data (traces, logs, metrics) accumulates rapidly and has a natural time-based access pattern:</p> <ul> <li>Recent data is hot - Most queries target last few hours/days</li> <li>Old data is cold - Rarely accessed after retention period</li> <li>Predictable lifecycle - Data expires based on retention policy</li> </ul> <p>Partitioning provides:</p> <ul> <li>Query performance - Partition pruning skips irrelevant data</li> <li>Efficient deletion - Drop entire partitions instead of DELETE (much faster)</li> <li>Storage optimization - Old partitions can be compressed or moved to cold storage</li> <li>Maintenance windows - Operations on individual partitions don't lock entire table</li> </ul>"},{"location":"partition-management/#partitioning-strategy","title":"Partitioning Strategy","text":""},{"location":"partition-management/#tables","title":"Tables","text":"<p>All fact tables use range partitioning on their timestamp column:</p> Table Partition Key Retention (default) <code>spans_fact</code> <code>start_time_ns</code> 7 days <code>logs_fact</code> <code>timestamp_ns</code> 3 days <code>metrics_fact</code> <code>timestamp_ns</code> 30 days"},{"location":"partition-management/#partition-naming-convention","title":"Partition Naming Convention","text":"<p>Partitions are named: <code>{table_name}_y{YYYY}_m{MM}_d{DD}</code></p> <p>Examples:</p> <ul> <li><code>spans_fact_y2026_m01_d21</code> - Spans for January 21, 2026</li> <li><code>logs_fact_y2026_m01_d20</code> - Logs for January 20, 2026</li> <li><code>metrics_fact_y2026_m02_d05</code> - Metrics for February 5, 2026</li> </ul>"},{"location":"partition-management/#partition-granularity","title":"Partition Granularity","text":"<ul> <li>Daily partitions (24-hour intervals)</li> <li>Aligned to UTC day boundaries</li> <li>One partition per table per day</li> </ul>"},{"location":"partition-management/#automated-management","title":"Automated Management","text":""},{"location":"partition-management/#cronjob","title":"CronJob","text":"<p>The <code>partition-maintenance</code> CronJob runs daily at 2 AM UTC:</p> <pre><code>partitionMaintenance:\n  enabled: true\n  schedule: \"0 2 * * *\"  # Daily at 2 AM UTC\n  daysAhead: 7            # Create partitions 7 days ahead\n</code></pre> <p>Actions performed:</p> <ol> <li>Create future partitions - Ensures partitions exist for upcoming data</li> <li>Drop old partitions - Removes partitions older than retention policy</li> </ol>"},{"location":"partition-management/#functions","title":"Functions","text":""},{"location":"partition-management/#create_partitions_for_range","title":"<code>create_partitions_for_range()</code>","text":"<p>Creates partitions for a time range.</p> <p>Signature:</p> <pre><code>create_partitions_for_range(\n    table_name TEXT,\n    start_time BIGINT,\n    end_time BIGINT,\n    interval_hours INTEGER DEFAULT 24\n) RETURNS INTEGER\n</code></pre> <p>Parameters:</p> <ul> <li><code>table_name</code> - Target fact table (<code>spans_fact</code>, <code>logs_fact</code>, <code>metrics_fact</code>)</li> <li><code>start_time</code> - Start time in nanoseconds (Unix epoch)</li> <li><code>end_time</code> - End time in nanoseconds</li> <li><code>interval_hours</code> - Partition size in hours (default: 24)</li> </ul> <p>Returns: Number of partitions created</p> <p>Example:</p> <pre><code>-- Create daily partitions for spans_fact for next 7 days\nSELECT create_partitions_for_range(\n    'spans_fact',\n    EXTRACT(EPOCH FROM NOW())::BIGINT * 1000000000,\n    EXTRACT(EPOCH FROM NOW() + INTERVAL '7 days')::BIGINT * 1000000000,\n    24\n);\n</code></pre>"},{"location":"partition-management/#drop_old_partitions","title":"<code>drop_old_partitions()</code>","text":"<p>Drops partitions older than retention policy.</p> <p>Signature:</p> <pre><code>drop_old_partitions(\n    table_name TEXT,\n    signal_type TEXT,\n    tenant_id_param TEXT DEFAULT 'default'\n) RETURNS INTEGER\n</code></pre> <p>Parameters:</p> <ul> <li><code>table_name</code> - Target fact table</li> <li><code>signal_type</code> - Signal type (<code>traces</code>, <code>logs</code>, <code>metrics</code>)</li> <li><code>tenant_id_param</code> - Tenant ID (default: <code>'default'</code>)</li> </ul> <p>Returns: Number of partitions dropped</p> <p>Example:</p> <pre><code>-- Drop old trace partitions\nSELECT drop_old_partitions('spans_fact', 'traces', 'default');\n</code></pre>"},{"location":"partition-management/#maintenance_create_partitions","title":"<code>maintenance_create_partitions()</code>","text":"<p>Wrapper that creates future partitions for all fact tables.</p> <p>Signature:</p> <pre><code>maintenance_create_partitions(\n    days_ahead INTEGER DEFAULT 7\n) RETURNS TABLE(table_name TEXT, partitions_created INTEGER)\n</code></pre> <p>Parameters:</p> <ul> <li><code>days_ahead</code> - Number of days ahead to create partitions (default: 7)</li> </ul> <p>Returns: Table with results per fact table</p> <p>Example:</p> <pre><code>-- Create partitions 14 days ahead\nSELECT * FROM maintenance_create_partitions(14);\n</code></pre> <p>Output:</p> <pre><code>  table_name   | partitions_created\n---------------+-------------------\n spans_fact    |                 7\n logs_fact     |                 7\n metrics_fact  |                 7\n</code></pre>"},{"location":"partition-management/#maintenance_drop_partitions","title":"<code>maintenance_drop_partitions()</code>","text":"<p>Wrapper that drops old partitions for all fact tables.</p> <p>Signature:</p> <pre><code>maintenance_drop_partitions()\nRETURNS TABLE(table_name TEXT, signal_type TEXT, partitions_dropped INTEGER)\n</code></pre> <p>Returns: Table with results per fact table</p> <p>Example:</p> <pre><code>SELECT * FROM maintenance_drop_partitions();\n</code></pre> <p>Output:</p> <pre><code>  table_name   | signal_type | partitions_dropped\n---------------+-------------+-------------------\n spans_fact    | traces      |                 2\n logs_fact     | logs        |                 5\n metrics_fact  | metrics     |                 0\n</code></pre>"},{"location":"partition-management/#monitoring","title":"Monitoring","text":""},{"location":"partition-management/#view-all-partitions","title":"View All Partitions","text":"<pre><code>SELECT\n    parent.relname AS table_name,\n    child.relname AS partition_name,\n    pg_size_pretty(pg_total_relation_size(child.oid)) AS partition_size,\n    pg_get_expr(child.relpartbound, child.oid) AS partition_range\nFROM pg_class parent\nJOIN pg_inherits i ON i.inhparent = parent.oid\nJOIN pg_class child ON child.oid = i.inhrelid\nWHERE parent.relname IN ('spans_fact', 'logs_fact', 'metrics_fact')\nORDER BY parent.relname, child.relname;\n</code></pre>"},{"location":"partition-management/#check-partition-coverage","title":"Check Partition Coverage","text":"<pre><code>-- Check if partitions exist for today and tomorrow\nWITH dates AS (\n    SELECT\n        t.table_name,\n        CURRENT_DATE + i AS check_date\n    FROM generate_series(0, 1) AS i\n    CROSS JOIN (VALUES ('spans_fact'), ('logs_fact'), ('metrics_fact')) AS t(table_name)\n)\nSELECT\n    d.table_name,\n    d.check_date,\n    CASE\n        WHEN c.relname IS NOT NULL THEN 'EXISTS'\n        ELSE 'MISSING'\n    END AS status\nFROM dates d\nLEFT JOIN pg_class c ON c.relname = d.table_name || '_y' ||\n    TO_CHAR(d.check_date, 'YYYY') || '_m' ||\n    TO_CHAR(d.check_date, 'MM') || '_d' ||\n    TO_CHAR(d.check_date, 'DD')\nORDER BY d.table_name, d.check_date;\n</code></pre>"},{"location":"partition-management/#partition-sizes","title":"Partition Sizes","text":"<pre><code>SELECT\n    parent.relname AS table_name,\n    COUNT(*) AS partition_count,\n    pg_size_pretty(SUM(pg_total_relation_size(child.oid))) AS total_size,\n    pg_size_pretty(AVG(pg_total_relation_size(child.oid))::BIGINT) AS avg_partition_size\nFROM pg_class parent\nJOIN pg_inherits i ON i.inhparent = parent.oid\nJOIN pg_class child ON child.oid = i.inhrelid\nWHERE parent.relname IN ('spans_fact', 'logs_fact', 'metrics_fact')\nGROUP BY parent.relname\nORDER BY parent.relname;\n</code></pre>"},{"location":"partition-management/#troubleshooting","title":"Troubleshooting","text":""},{"location":"partition-management/#missing-partitions","title":"Missing Partitions","text":"<p>Symptom: Ingestion fails with \"no partition of relation found for row\"</p> <p>Diagnosis:</p> <pre><code>-- Check if partition exists for specific timestamp\nSELECT\n    table_name || '_y' ||\n    TO_CHAR(TO_TIMESTAMP(timestamp_ns / 1000000000.0), 'YYYY') || '_m' ||\n    TO_CHAR(TO_TIMESTAMP(timestamp_ns / 1000000000.0), 'MM') || '_d' ||\n    TO_CHAR(TO_TIMESTAMP(timestamp_ns / 1000000000.0), 'DD') AS expected_partition,\n    EXISTS (\n        SELECT 1 FROM pg_class\n        WHERE relname = table_name || '_y' ||\n            TO_CHAR(TO_TIMESTAMP(timestamp_ns / 1000000000.0), 'YYYY') || '_m' ||\n            TO_CHAR(TO_TIMESTAMP(timestamp_ns / 1000000000.0), 'MM') || '_d' ||\n            TO_CHAR(TO_TIMESTAMP(timestamp_ns / 1000000000.0), 'DD')\n    ) AS partition_exists\nFROM (\n    SELECT 'spans_fact' AS table_name, 1737478800000000000::BIGINT AS timestamp_ns\n) AS test;\n</code></pre> <p>Fix: Create missing partition manually</p> <pre><code>-- Create partition for specific date\nSELECT create_partitions_for_range(\n    'spans_fact',\n    EXTRACT(EPOCH FROM '2026-01-21'::TIMESTAMP)::BIGINT * 1000000000,\n    EXTRACT(EPOCH FROM '2026-01-22'::TIMESTAMP)::BIGINT * 1000000000,\n    24\n);\n</code></pre>"},{"location":"partition-management/#cronjob-not-running","title":"CronJob Not Running","text":"<p>Diagnosis:</p> <pre><code># Check CronJob status\nkubectl get cronjob -n ollyscale partition-maintenance\n\n# Check recent jobs\nkubectl get jobs -n ollyscale -l app.kubernetes.io/component=partition-maintenance\n\n# Check logs\nkubectl logs -n ollyscale -l app.kubernetes.io/component=partition-maintenance\n</code></pre> <p>Fix: Trigger manual job</p> <pre><code>kubectl create job -n ollyscale \\\n    partition-maintenance-manual \\\n    --from=cronjob/ollyscale-partition-maintenance\n</code></pre>"},{"location":"partition-management/#partition-cleanup-not-working","title":"Partition Cleanup Not Working","text":"<p>Symptom: Old partitions not being dropped</p> <p>Diagnosis:</p> <pre><code>-- Check retention policy\nSELECT * FROM retention_policy;\n\n-- Manually test drop function\nSELECT * FROM drop_old_partitions('spans_fact', 'traces', 'default');\n</code></pre> <p>Fix: Verify retention policy is correct</p> <pre><code>-- Update retention policy if needed\nUPDATE retention_policy\nSET retention_days_value = 7\nWHERE signal_type_value = 'traces' AND tenant_id = 'default';\n</code></pre>"},{"location":"partition-management/#manual-operations","title":"Manual Operations","text":""},{"location":"partition-management/#create-partitions-for-specific-date-range","title":"Create Partitions for Specific Date Range","text":"<pre><code>-- Create partitions for January 2026\nSELECT create_partitions_for_range(\n    'spans_fact',\n    EXTRACT(EPOCH FROM '2026-01-01'::TIMESTAMP)::BIGINT * 1000000000,\n    EXTRACT(EPOCH FROM '2026-02-01'::TIMESTAMP)::BIGINT * 1000000000,\n    24\n);\n</code></pre>"},{"location":"partition-management/#drop-specific-partition","title":"Drop Specific Partition","text":"<pre><code>-- Drop partition for specific date\nDROP TABLE IF EXISTS spans_fact_y2026_m01_d15;\n</code></pre>"},{"location":"partition-management/#disable-automatic-maintenance","title":"Disable Automatic Maintenance","text":"<pre><code># Edit values.yaml\nhelm upgrade ollyscale ./charts/ollyscale \\\n    --namespace ollyscale \\\n    --set partitionMaintenance.enabled=false\n</code></pre>"},{"location":"partition-management/#best-practices","title":"Best Practices","text":"<ol> <li>Monitor partition coverage - Ensure partitions exist for current + N days ahead</li> <li>Check CronJob logs - Review daily maintenance logs for errors</li> <li>Set appropriate retention - Balance storage costs vs. query needs</li> <li>Test manually first - Run maintenance functions manually before relying on CronJob</li> <li>Plan for time zones - Partitions use UTC, coordinate with query patterns</li> <li>Pre-create partitions - Always maintain buffer of future partitions (7+ days)</li> </ol>"},{"location":"partition-management/#integration-with-other-components","title":"Integration with Other Components","text":""},{"location":"partition-management/#migration-job","title":"Migration Job","text":"<p>The migration job creates partition management functions during deployment:</p> <ul> <li>Runs <code>alembic upgrade head</code> as Helm pre-upgrade/pre-install hook</li> <li>Creates functions: <code>create_partitions_for_range()</code>, <code>drop_old_partitions()</code>, etc.</li> <li>Creates initial 7 days of partitions</li> </ul>"},{"location":"partition-management/#ingestion-pipeline","title":"Ingestion Pipeline","text":"<p>The OTLP receiver and frontend API insert data into fact tables:</p> <ul> <li>PostgreSQL automatically routes rows to correct partition based on timestamp</li> <li>If no partition exists, insert fails with error</li> <li>Maintenance CronJob ensures partitions always exist</li> </ul>"},{"location":"partition-management/#retention-policy","title":"Retention Policy","text":"<p>Partition cleanup respects the <code>retention_policy</code> table:</p> tenant_id signal_type_value retention_days_value default traces 7 default logs 3 default metrics 30 <p>See ollyscale-v2-postgres.md for details.</p>"},{"location":"partition-management/#references","title":"References","text":"<ul> <li>PostgreSQL Table Partitioning</li> <li>ollyscale v2 Architecture</li> <li>Postgres Infrastructure</li> <li>Migration Strategy</li> </ul>"},{"location":"postgres-infrastructure/","title":"PostgreSQL Infrastructure for ollyScale v2","text":"<p>This document describes the PostgreSQL infrastructure setup for ollyScale v2.</p>"},{"location":"postgres-infrastructure/#architecture","title":"Architecture","text":""},{"location":"postgres-infrastructure/#components","title":"Components","text":"<ol> <li>Zalando Postgres Operator - Deploys and manages PostgreSQL clusters</li> <li>Location: <code>.kind/modules/main/argocd-applications/middleware/postgres-operator.yaml</code></li> <li>Namespace: <code>postgres-operator</code></li> <li>Sync Wave: 30 (after Strimzi at wave 20, before Redis at wave 35)</li> <li>Chart: <code>https://opensource.zalando.com/postgres-operator/charts/postgres-operator</code></li> <li> <p>Version: 1.14.0</p> </li> <li> <p>PostgreSQL Database Cluster - HA database for ollyScale</p> </li> <li>Location: <code>charts/ollyscale/templates/postgresql.yaml</code></li> <li>Namespace: <code>ollyscale</code></li> <li>Managed by: Zalando Postgres Operator</li> <li>Features:<ul> <li>2 replicas with streaming replication</li> <li>Synchronous replication (patroni)</li> <li>Connection pooler (PgBouncer) for efficient connection management</li> <li>Automatic failover via Patroni</li> </ul> </li> </ol>"},{"location":"postgres-infrastructure/#deployment-order","title":"Deployment Order","text":"<ol> <li>postgres-operator (sync-wave: 30) - Installs CRDs and operator</li> <li>ollyscale chart - Deploys Postgresql CR, creates database cluster</li> </ol>"},{"location":"postgres-infrastructure/#configuration","title":"Configuration","text":""},{"location":"postgres-infrastructure/#operator-configuration","title":"Operator Configuration","text":"<pre><code># .kind/modules/main/argocd-applications/middleware/postgres-operator.yaml\nconfigKubernetes:\n  enable_pod_antiaffinity: true          # Spread replicas across nodes\n  enable_pod_disruption_budget: true     # Protect from disruptions\n  watched_namespace: \"*\"                  # Watch all namespaces\n</code></pre>"},{"location":"postgres-infrastructure/#database-configuration","title":"Database Configuration","text":"<pre><code># charts/ollyscale/values.yaml\npostgresql:\n  teamId: ollyscale\n  numberOfInstances: 2                    # Primary + 1 replica\n  volume:\n    size: 10Gi\n    storageClass: ''                      # Use default StorageClass\n  databases:\n    ollyscale: ollyscale                  # database: owner\n  users:\n    ollyscale:\n      - superuser\n      - createdb\n  postgresql:\n    version: '18'\n  resources:\n    requests:\n      cpu: 100m\n      memory: 256Mi\n    limits:\n      cpu: 1000m\n      memory: 1Gi\n  patroni:\n    synchronous_mode: true                # Sync replication for durability\n    synchronous_mode_strict: false        # Allow async if replica unavailable\n</code></pre>"},{"location":"postgres-infrastructure/#connection-details","title":"Connection Details","text":""},{"location":"postgres-infrastructure/#from-frontend-application","title":"From Frontend Application","text":"<p>Both the frontend API and OTLP receiver automatically receive these environment variables:</p> <pre><code>DATABASE_HOST=ollyscale-db-pooler        # PgBouncer connection pooler\nDATABASE_PORT=5432\nDATABASE_NAME=ollyscale\nDATABASE_USER=&lt;from secret&gt;              # Auto-generated by operator\nDATABASE_PASSWORD=&lt;from secret&gt;          # Auto-generated by operator\n</code></pre>"},{"location":"postgres-infrastructure/#secret-name-pattern","title":"Secret Name Pattern","text":"<p>The operator creates a secret with credentials:</p> <pre><code>ollyscale.&lt;chart-name&gt;-db.credentials.postgresql.acid.zalan.do\n</code></pre> <p>Keys:</p> <ul> <li><code>username</code> - Database username (ollyscale)</li> <li><code>password</code> - Auto-generated password</li> </ul>"},{"location":"postgres-infrastructure/#connection-string","title":"Connection String","text":"<pre><code># SQLAlchemy connection string\nDATABASE_URL = (\n    f\"postgresql+asyncpg://{DATABASE_USER}:{DATABASE_PASSWORD}@\"\n    f\"{DATABASE_HOST}:{DATABASE_PORT}/{DATABASE_NAME}\"\n)\n</code></pre>"},{"location":"postgres-infrastructure/#services-created","title":"Services Created","text":"<ol> <li>ollyscale-db - Direct PostgreSQL service (for admin)</li> <li>Port: 5432</li> <li> <p>Endpoints: Primary and replica pods</p> </li> <li> <p>ollyscale-db-pooler - PgBouncer connection pooler (for apps)</p> </li> <li>Port: 5432</li> <li>Mode: transaction</li> <li> <p>Replicas: 2</p> </li> <li> <p>ollyscale-db-replica - Read-only replica service</p> </li> <li>Port: 5432</li> <li>Endpoints: Replica pods only</li> </ol>"},{"location":"postgres-infrastructure/#deployment","title":"Deployment","text":""},{"location":"postgres-infrastructure/#deploy-operator","title":"Deploy Operator","text":"<pre><code>cd .kind\nterraform apply -target='kubectl_manifest.middleware_applications[\"middleware/postgres-operator.yaml\"]'\n</code></pre>"},{"location":"postgres-infrastructure/#deploy-database","title":"Deploy Database","text":"<pre><code>cd charts\nhelm upgrade --install ollyscale ./ollyscale \\\n  --namespace ollyscale \\\n  --create-namespace\n</code></pre> <p>Migration Strategy: Database schema migrations run automatically as a Kubernetes Job:</p> <ul> <li>Helm hook: <code>pre-upgrade,pre-install</code> (runs before deployment updates)</li> <li>Hook weight: <code>-5</code> (runs early in the upgrade sequence)</li> <li>Uses same image as frontend but executes <code>alembic upgrade head</code></li> <li>Runs exactly once per deployment (no race conditions between replicas)</li> <li>Failed migrations block the rollout (safety mechanism)</li> <li>Auto-cleanup after 5 minutes on success</li> </ul>"},{"location":"postgres-infrastructure/#verify-deployment","title":"Verify Deployment","text":"<pre><code># Check operator\nkubectl get pods -n postgres-operator\n\n# Check migration job (only exists during upgrade)\nkubectl get jobs -n ollyscale | grep migration\n\n# Check database cluster\nkubectl get postgresql -n ollyscale\nkubectl get pods -n ollyscale -l application=spilo\n\n# Check services\nkubectl get svc -n ollyscale | grep db\n\n# Get credentials\nkubectl get secret -n ollyscale \\\n  ollyscale.ollyscale-db.credentials.postgresql.acid.zalan.do \\\n  -o jsonpath='{.data.username}' | base64 -d\nkubectl get secret -n ollyscale \\\n  ollyscale.ollyscale-db.credentials.postgresql.acid.zalan.do \\\n  -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"postgres-infrastructure/#testing-connection","title":"Testing Connection","text":"<pre><code># Port-forward to pooler\nkubectl port-forward -n ollyscale svc/ollyscale-db-pooler 5432:5432\n\n# Connect with psql\npsql -h localhost -U ollyscale -d ollyscale\n</code></pre>"},{"location":"postgres-infrastructure/#high-availability","title":"High Availability","text":""},{"location":"postgres-infrastructure/#automatic-failover","title":"Automatic Failover","text":"<p>Patroni manages automatic failover:</p> <ol> <li>Health checks detect primary failure</li> <li>Replica promoted to primary (&lt; 30 seconds)</li> <li>Services updated to point to new primary</li> <li>Failed pod restarted as replica</li> </ol>"},{"location":"postgres-infrastructure/#synchronous-replication","title":"Synchronous Replication","text":"<ul> <li><code>synchronous_mode: true</code> - Writes wait for replica ACK</li> <li><code>synchronous_mode_strict: false</code> - Allow async if replica down (availability over consistency)</li> </ul>"},{"location":"postgres-infrastructure/#connection-pooling","title":"Connection Pooling","text":"<p>PgBouncer provides:</p> <ul> <li>Connection reuse (reduces overhead)</li> <li>Transaction-level pooling</li> <li>2 pooler instances for HA</li> <li>Automatic load balancing</li> </ul>"},{"location":"postgres-infrastructure/#monitoring","title":"Monitoring","text":""},{"location":"postgres-infrastructure/#check-cluster-status","title":"Check Cluster Status","text":"<pre><code># Patroni cluster info\nkubectl exec -n ollyscale ollyscale-db-0 -- \\\n  patronictl list\n\n# Replication status\nkubectl exec -n ollyscale ollyscale-db-0 -- \\\n  psql -U postgres -c \"SELECT * FROM pg_stat_replication;\"\n</code></pre>"},{"location":"postgres-infrastructure/#common-issues","title":"Common Issues","text":"<p>Issue: Pods stuck in Pending</p> <ul> <li>Check: <code>kubectl get events -n ollyscale</code></li> <li>Likely: Insufficient resources or missing StorageClass</li> </ul> <p>Issue: Database not created</p> <ul> <li>Check operator logs: <code>kubectl logs -n postgres-operator deployment/postgres-operator</code></li> <li>Check postgresql status: <code>kubectl describe postgresql -n ollyscale ollyscale-db</code></li> </ul> <p>Issue: Can't connect from frontend</p> <ul> <li>Verify secret exists: <code>kubectl get secret -n ollyscale | grep credentials</code></li> <li>Check pooler service: <code>kubectl get svc -n ollyscale ollyscale-db-pooler</code></li> <li>Check frontend logs: <code>kubectl logs -n ollyscale deployment/ollyscale-frontend</code></li> </ul>"},{"location":"postgres-infrastructure/#resource-management","title":"Resource Management","text":""},{"location":"postgres-infrastructure/#disk-usage","title":"Disk Usage","text":"<pre><code># Check PVC usage\nkubectl exec -n ollyscale ollyscale-db-0 -- df -h /home/postgres/pgdata\n</code></pre>"},{"location":"postgres-infrastructure/#scaling","title":"Scaling","text":"<pre><code># Scale to 3 replicas\nhelm upgrade ollyscale ./ollyscale \\\n  --namespace ollyscale \\\n  --set postgresql.numberOfInstances=3 \\\n  --reuse-values\n</code></pre>"},{"location":"postgres-infrastructure/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"postgres-infrastructure/#manual-backup","title":"Manual Backup","text":"<pre><code># Backup via pg_dump\nkubectl exec -n ollyscale ollyscale-db-0 -- \\\n  pg_dump -U ollyscale ollyscale &gt; backup.sql\n</code></pre>"},{"location":"postgres-infrastructure/#automated-backups-future","title":"Automated Backups (Future)","text":"<p>The operator supports WAL-E/WAL-G for continuous archiving:</p> <pre><code>postgresql:\n  backup:\n    enabled: true\n    s3_bucket: ollyscale-backups\n    schedule: \"0 2 * * *\"\n</code></pre>"},{"location":"postgres-infrastructure/#security","title":"Security","text":""},{"location":"postgres-infrastructure/#network-policies-recommended","title":"Network Policies (Recommended)","text":"<pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: ollyscale-db-policy\nspec:\n  podSelector:\n    matchLabels:\n      application: spilo\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          app.kubernetes.io/component: frontend\n    ports:\n    - protocol: TCP\n      port: 5432\n</code></pre>"},{"location":"postgres-infrastructure/#tls-encryption-future","title":"TLS Encryption (Future)","text":"<pre><code>postgresql:\n  tls:\n    secretName: ollyscale-db-tls\n    caSecret: ollyscale-ca\n</code></pre>"},{"location":"postgres-infrastructure/#references","title":"References","text":"<ul> <li>Zalando Postgres Operator Documentation</li> <li>Patroni Documentation</li> <li>PgBouncer Documentation</li> <li>PostgreSQL High Availability</li> </ul>"},{"location":"quickstart/","title":"Quick Start","text":"<p>Get ollyScale running in under 5 minutes!</p>"},{"location":"quickstart/#what-youll-get","title":"What You'll Get","text":"<ul> <li>ollyScale UI at <code>http://localhost:5005</code></li> <li>OpenTelemetry Collector listening on ports 4317 (gRPC) and 4318 (HTTP)</li> <li>OpAMP Server for remote collector configuration management</li> <li>Demo microservices generating automatic telemetry</li> </ul>"},{"location":"quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker Desktop installed and running</li> <li>Git (to clone the repository)</li> <li>5 minutes of your time</li> </ul>"},{"location":"quickstart/#step-1-clone-the-repository","title":"Step 1: Clone the Repository","text":"<pre><code>git clone https://github.com/ryanfaircloth/ollyscale\ncd ollyscale\n</code></pre>"},{"location":"quickstart/#step-2-start-ollyscale-core","title":"Step 2: Start ollyScale Core","text":"<pre><code>cd docker\n./01-start-core.sh\n</code></pre> <p>This pulls pre-built images from Docker Hub and starts:</p> <ul> <li>OpenTelemetry Collector (ports 4317/4318)</li> <li>OpAMP Server (ports 4320/4321)</li> <li>ollyScale OTLP Receiver (internal)</li> <li>ollyScale UI (port 5005)</li> <li>Redis storage (internal)</li> </ul> <p>Deployment time: ~30 seconds (pulls from Docker Hub)</p> <p>For local development: Use <code>./01-start-core-local.sh</code> to build images locally.</p>"},{"location":"quickstart/#step-3-deploy-demo-apps-optional-but-recommended","title":"Step 3: Deploy Demo Apps (Optional but Recommended)","text":"<p>In a new terminal:</p> <pre><code>cd apps/demo\n./01-deploy-demo.sh\n</code></pre> <p>This pulls demo images from Docker Hub and deploys two Flask microservices that automatically generate traffic.</p> <p>Wait 30 seconds for telemetry to appear!</p> <p>For local development: Use <code>./01-deploy-demo-local.sh</code> to build images locally.</p>"},{"location":"quickstart/#step-4-open-the-ui","title":"Step 4: Open the UI","text":"<p>Open your browser to: <code>http://localhost:5005</code></p> <p>You should see:</p> <p>Trace waterfall with correlated logs and span timing</p>"},{"location":"quickstart/#step-5-explore-the-features","title":"Step 5: Explore the Features","text":""},{"location":"quickstart/#traces-tab","title":"Traces Tab","text":"<p>View distributed traces across microservices with timing waterfall.</p> <p>Span waterfall showing request timing breakdown with correlated logs</p> <p>Click on a span to view detailed JSON data:</p> <p>Span detail view with full OpenTelemetry attributes</p>"},{"location":"quickstart/#logs-tab","title":"Logs Tab","text":"<p>Browse logs with trace/span correlation. Filter by severity (Error, Warn, Info, Debug).</p> <p>Real-time logs with trace and span correlation</p> <p>Click on a log entry to view full details:</p> <p>Log detail view with full attributes and resource info</p> <p>Filter to show only errors:</p> <p>Filtered error logs with trace correlation</p>"},{"location":"quickstart/#metrics-tab","title":"Metrics Tab","text":"<p>Visualize metrics with automatic charting.</p> <p>Time-series metrics visualization with rate charts</p>"},{"location":"quickstart/#service-catalog","title":"Service Catalog","text":"<p>View all services with RED metrics (Rate, Errors, Duration).</p> <p>Service catalog with RED metrics for all services</p>"},{"location":"quickstart/#service-map","title":"Service Map","text":"<p>Visualize service dependencies with an interactive graph.</p> <p>Interactive service dependency map with latency information</p>"},{"location":"quickstart/#opentelemetry-collector-opamp-config","title":"OpenTelemetry Collector + OpAMP Config","text":"<p>View and manage your OpenTelemetry Collector configuration remotely via the OpAMP protocol.</p> <p>OpenTelemetry Collector configuration management via OpAMP</p> <p>This page allows you to:</p> <ul> <li>View current configuration from connected collectors</li> <li>Apply configuration changes with validation and diff preview</li> <li>Use configuration templates for common scenarios (default, prometheus-remote-write, etc.)</li> <li>Check OpAMP server status and see connected collector agents</li> <li>Validate configurations before applying to catch errors early</li> </ul> <p>To use this feature, your OpenTelemetry Collector must be configured with the OpAMP extension (see Docker Deployment or OpenTelemetry Collector documentation).</p>"},{"location":"quickstart/#step-6-use-your-own-application","title":"Step 6: Use Your Own Application","text":"<p>Point your application's OpenTelemetry exporter to:</p> <p>For apps running on your host machine (outside Docker):</p> <pre><code>export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318\n</code></pre> <p>For apps running inside Docker:</p> <pre><code>export OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318\n</code></pre> <p>ollyScale will automatically capture and display your telemetry!</p>"},{"location":"quickstart/#cleanup","title":"Cleanup","text":"<p>Stop demo apps (keeps ollyScale running):</p> <pre><code>cd apps/demo\n./02-cleanup-demo.sh\n</code></pre> <p>Stop everything:</p> <pre><code>cd docker\n./02-stop-core.sh\n</code></pre>"},{"location":"quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Configure your own OpenTelemetry Collector</li> <li>Explore the REST API at <code>http://localhost:5005/docs</code></li> <li>Deploy on Kubernetes</li> <li>Learn about the architecture</li> </ul>"},{"location":"quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"quickstart/#ui-shows-no-traceslogsmetrics","title":"UI shows \"No traces/logs/metrics\"","text":"<ul> <li>Wait 30 seconds after starting demo apps</li> <li>Check containers are running: <code>docker ps</code></li> <li>Check demo app logs: <code>docker compose -f apps/demo/docker-compose-demo.yml logs</code></li> </ul>"},{"location":"quickstart/#port-conflicts","title":"Port conflicts","text":"<ul> <li>ollyScale uses ports 4317, 4318, 4320, 4321, 4343, 5005, 6379, 19291</li> <li>Stop conflicting services or modify ports in <code>docker-compose-ollyscale-core.yml</code></li> </ul>"},{"location":"quickstart/#demo-apps-not-generating-traffic","title":"Demo apps not generating traffic","text":"<ul> <li>Restart demo: <code>cd apps/demo &amp;&amp; ./02-cleanup-demo.sh &amp;&amp; ./01-deploy-demo.sh</code></li> <li>Check logs: <code>docker compose -f apps/demo/docker-compose-demo.yml logs demo-frontend</code></li> </ul> <p>For more help, open an issue on GitHub.</p>"},{"location":"technical/","title":"Technical Details","text":""},{"location":"technical/#architecture","title":"Architecture","text":""},{"location":"technical/#data-storage","title":"Data Storage","text":"<ul> <li>Format: Full OpenTelemetry (OTEL) format for traces, logs, and metrics</li> <li>Postgress: All telemetry stored</li> <li>Sorted Sets: Time-series data indexed by timestamp</li> <li>Correlation: Native trace-metric-log correlation via trace/span IDs</li> <li>Cardinality Protection: Prevents metric explosion</li> <li>No Persistence: Data vanishes after TTL (ephemeral dev tool)</li> </ul>"},{"location":"technical/#otlp-compatibility","title":"OTLP Compatibility","text":"<p>ollyScale is fully OpenTelemetry-native:</p> <ul> <li>Ingestion: Accepts OTLP/gRPC (primary) and OTLP/HTTP</li> <li>Storage: Stores traces, logs, and metrics in full OTEL format with resources, scopes, and attributes</li> <li>Correlation: Native support for trace/span ID correlation across all telemetry types</li> <li>REST API: Exposes OTEL-formatted JSON for programmatic access</li> <li>Control Plane: OpenTelemetry Collector OpAmp for dynamic configuration</li> </ul>"},{"location":"demos/","title":"Demo Applications","text":"<p>ollyScale includes several demo applications to help you explore its observability capabilities. These demos range from simple microservices to complex distributed systems.</p>"},{"location":"demos/#available-demos","title":"Available Demos","text":""},{"location":"demos/#custom-demo-applications","title":"Custom Demo Applications","text":"<p>Simple Python Flask microservices demonstrating core observability features:</p> <ul> <li>Services: demo-frontend and demo-backend</li> <li>Languages: Python</li> <li>Features: Auto-traffic generation, distributed tracing, Prometheus metrics</li> <li>Resource Usage: Low (~256MB)</li> <li>Best For: Quick testing, development, learning basics</li> </ul> <p>Key Highlights:</p> <ul> <li>Automatic traffic generation every 3-8 seconds</li> <li>Multiple endpoints (simple requests, calculations, complex orders, errors)</li> <li>Easy to understand and modify</li> <li>Minimal resource requirements</li> </ul> <p>View Documentation \u2192</p>"},{"location":"demos/#opentelemetry-demo","title":"OpenTelemetry Demo","text":"<p>The official OpenTelemetry demo application (\"Astronomy Shop\"):</p> <ul> <li>Services: 11+ microservices</li> <li>Languages: Go, Java, Python, .NET, Node.js, Rust, Ruby, PHP</li> <li>Features: E-commerce workflows, built-in load generator, multi-language instrumentation</li> <li>Resource Usage: High (~2-4GB)</li> <li>Best For: Comprehensive demos, training, polyglot environments</li> </ul> <p>Key Highlights:</p> <ul> <li>Production-realistic distributed system</li> <li>Showcases OTel instrumentation across 7+ languages</li> <li>Complex distributed traces (10-20 spans)</li> <li>Realistic user workflows (browse, cart, checkout, payment)</li> </ul> <p>View Documentation \u2192</p>"},{"location":"demos/#advanced-demos","title":"Advanced Demos","text":""},{"location":"demos/#ebpf-zero-code-tracing","title":"eBPF Zero-Code Tracing","text":"<p>Automatic distributed tracing without code changes using eBPF:</p> <ul> <li>Technology: eBPF with Beyla auto-instrumentation</li> <li>Features: Zero-code instrumentation, HTTP/gRPC tracing</li> <li>Best For: Legacy applications, no-modification observability</li> </ul> <p>View Documentation \u2192</p>"},{"location":"demos/#ai-agent-with-ollama","title":"AI Agent with Ollama","text":"<p>GenAI observability demo with LLM instrumentation:</p> <ul> <li>Technology: Ollama LLM with OTel instrumentation</li> <li>Features: LLM span attributes, token tracking, prompt/response logging</li> <li>Best For: AI/ML observability, GenAI applications</li> </ul> <p>View Documentation \u2192</p>"},{"location":"demos/#quick-comparison","title":"Quick Comparison","text":"Demo Complexity Services Languages Resource Usage Auto-Traffic Custom Demo Simple 2 Python Low \u2705 OTel Demo Complex 11+ 7+ High \u2705 eBPF Demo Medium 2 Go Low \u274c AI Agent Simple 1 Python Medium \u2705"},{"location":"demos/#deployment","title":"Deployment","text":"<p>All demos can be deployed via:</p>"},{"location":"demos/#helm","title":"Helm","text":"<pre><code># Custom Demo\nhelm install ollyscale-demos charts/ollyscale-demos \\\n  --namespace ollyscale-demos \\\n  --create-namespace\n\n# OTel Demo\nhelm install ollyscale-demos charts/ollyscale-demos \\\n  --set customDemo.enabled=false \\\n  --set otelDemo.enabled=true\n</code></pre>"},{"location":"demos/#terraformargocd-recommended","title":"Terraform/ArgoCD (Recommended)","text":"<pre><code>cd .kind\n\n# Enable Custom Demo\nterraform apply -var=\"custom_demo_enabled=true\"\n\n# Enable OTel Demo\nterraform apply -var=\"otel_demo_enabled=true\" -var=\"custom_demo_enabled=false\"\n</code></pre>"},{"location":"demos/#accessing-demos","title":"Accessing Demos","text":"<p>After deployment, demos are available via HTTPRoutes:</p> <ul> <li>Custom Demo Frontend: <code>https://demo-frontend.ollyscale.test:49443</code></li> <li>OTel Demo: <code>https://otel-demo.ollyscale.test:49443</code></li> <li>ollyScale UI: <code>https://ollyscale.ollyscale.test:49443</code></li> </ul>"},{"location":"demos/#viewing-telemetry","title":"Viewing Telemetry","text":"<p>All demos send telemetry to ollyScale. Open the ollyScale UI to explore:</p> <ol> <li>Service Map: Visual representation of service dependencies</li> <li>Traces: Distributed traces with timing and attributes</li> <li>Logs: Application logs with trace correlation</li> <li>Metrics: RED metrics (Rate, Errors, Duration)</li> </ol>"},{"location":"demos/#choosing-a-demo","title":"Choosing a Demo","text":"<p>For Learning/Development:</p> <ul> <li>Start with Custom Demo - simple, fast, easy to understand</li> </ul> <p>For Demonstrations/Training:</p> <ul> <li>Use OTel Demo - comprehensive, production-realistic</li> </ul> <p>For Polyglot Environments:</p> <ul> <li>Use OTel Demo - showcases multiple languages</li> </ul> <p>For Legacy Applications:</p> <ul> <li>Try eBPF Demo - no code changes required</li> </ul> <p>For AI/ML Workloads:</p> <ul> <li>Try AI Agent - GenAI-specific instrumentation</li> </ul>"},{"location":"demos/#migration","title":"Migration","text":"<p>If you're migrating from the old <code>k8s-demo/</code> or <code>k8s-otel-demo/</code> directories, see the migration sections in:</p> <ul> <li>Custom Demo Migration</li> <li>OTel Demo Migration</li> </ul>"},{"location":"demos/#support","title":"Support","text":"<p>For issues or questions:</p> <ul> <li>GitHub Issues</li> <li>Documentation</li> </ul>"},{"location":"demos/custom-demo/","title":"Custom Demo Applications","text":"<p>The custom demo applications provide a simple but realistic microservice architecture for demonstrating ollyScale's observability capabilities.</p>"},{"location":"demos/custom-demo/#overview","title":"Overview","text":"<p>The demo consists of two Python Flask applications that automatically generate OpenTelemetry traces, logs, and Prometheus metrics:</p> <ul> <li>demo-frontend: User-facing service with multiple endpoints</li> <li>demo-backend: Backend service for data processing</li> </ul> <p>Both applications feature automatic traffic generation - they create distributed traces every 3-8 seconds without external input.</p>"},{"location":"demos/custom-demo/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  demo-frontend  \u2502  Port 5000 (HTTP)\n\u2502   (Flask)       \u2502  Port 8000 (Prometheus metrics)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502 HTTP\n         \u2502 OTLP gRPC \u2192 gateway-collector:4317\n         \u2502 Prom \u2192 gateway-collector:19291\n         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  demo-backend   \u2502  Port 5000 (HTTP)\n\u2502   (Flask)       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502 OTLP gRPC \u2192 gateway-collector:4317\n         \u2193\n    ollyScale UI\n</code></pre>"},{"location":"demos/custom-demo/#frontend-endpoints","title":"Frontend Endpoints","text":""},{"location":"demos/custom-demo/#-home","title":"<code>/</code> - Home","text":"<p>Returns service information and available endpoints.</p> <p>Example:</p> <pre><code>curl https://demo-frontend.ollyscale.test:49443/\n</code></pre>"},{"location":"demos/custom-demo/#hello-simple-request","title":"<code>/hello</code> - Simple Request","text":"<p>Basic endpoint that returns a greeting. Generates simple traces.</p> <p>Example:</p> <pre><code>curl https://demo-frontend.ollyscale.test:49443/hello\n</code></pre>"},{"location":"demos/custom-demo/#calculate-backend-interaction","title":"<code>/calculate</code> - Backend Interaction","text":"<p>Calls the backend to perform a calculation. Demonstrates service-to-service tracing.</p> <p>Example:</p> <pre><code>curl https://demo-frontend.ollyscale.test:49443/calculate\n</code></pre> <p>Response:</p> <pre><code>{\n  \"operation\": \"add\",\n  \"a\": 42,\n  \"b\": 17,\n  \"result\": 59\n}\n</code></pre>"},{"location":"demos/custom-demo/#error-error-scenario","title":"<code>/error</code> - Error Scenario","text":"<p>Intentionally triggers an exception to demonstrate error tracking.</p> <p>Example:</p> <pre><code>curl https://demo-frontend.ollyscale.test:49443/error\n</code></pre>"},{"location":"demos/custom-demo/#process-order-complex-distributed-trace","title":"<code>/process-order</code> - Complex Distributed Trace","text":"<p>Creates a multi-span distributed trace across frontend and backend:</p> <ol> <li>Frontend receives order request</li> <li>Backend validates order</li> <li>Backend processes payment</li> <li>Backend checks inventory</li> <li>Order completion</li> </ol> <p>Example:</p> <pre><code>curl https://demo-frontend.ollyscale.test:49443/process-order\n</code></pre> <p>Response:</p> <pre><code>{\n  \"status\": \"success\",\n  \"order_id\": 7342,\n  \"details\": {\n    \"status\": \"success\",\n    \"order_id\": 7342,\n    \"processing_time_ms\": 287\n  }\n}\n</code></pre>"},{"location":"demos/custom-demo/#backend-endpoints","title":"Backend Endpoints","text":""},{"location":"demos/custom-demo/#health-health-check","title":"<code>/health</code> - Health Check","text":"<p>Kubernetes liveness/readiness probe endpoint.</p>"},{"location":"demos/custom-demo/#calculate-math-operations","title":"<code>/calculate</code> - Math Operations","text":"<p>Performs simple calculations with span attributes showing operands and results.</p>"},{"location":"demos/custom-demo/#process-order-processing","title":"<code>/process</code> - Order Processing","text":"<p>Handles order processing with multiple sub-operations (validation, payment, inventory).</p>"},{"location":"demos/custom-demo/#observability-features","title":"Observability Features","text":""},{"location":"demos/custom-demo/#opentelemetry-traces","title":"OpenTelemetry Traces","text":"<p>Both services are instrumented with OpenTelemetry auto-instrumentation:</p> <ul> <li>Flask instrumentation: Automatic HTTP server spans</li> <li>Requests instrumentation: Automatic HTTP client spans</li> <li>Custom spans: Business logic operations with attributes</li> </ul> <p>Span attributes include:</p> <ul> <li><code>http.method</code>, <code>http.route</code>, <code>http.status_code</code></li> <li><code>calculation.operand_a</code>, <code>calculation.operand_b</code>, <code>calculation.result</code></li> <li><code>order.id</code>, <code>order.status</code></li> <li><code>payment.amount</code>, <code>payment.method</code></li> </ul>"},{"location":"demos/custom-demo/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>Frontend exports custom metrics:</p> <ul> <li><code>demo_frontend_requests_total{endpoint, status}</code>: Request counter</li> <li><code>demo_frontend_request_duration_seconds{endpoint}</code>: Request histogram</li> </ul> <p>Metrics are scraped from port 8000 and pushed to the OTel Collector via remote write.</p>"},{"location":"demos/custom-demo/#automatic-traffic-generation","title":"Automatic Traffic Generation","text":"<p>The frontend includes a background thread that continuously generates requests:</p> <ul> <li>50%: Process orders (complex traces)</li> <li>20%: Calculate (service-to-service)</li> <li>20%: Hello (simple requests)</li> <li>10%: Errors (failure scenarios)</li> </ul> <p>Requests occur every 3-8 seconds with random intervals.</p>"},{"location":"demos/custom-demo/#deployment","title":"Deployment","text":""},{"location":"demos/custom-demo/#helm-installation","title":"Helm Installation","text":"<pre><code># Install demos chart\nhelm install ollyscale-demos charts/ollyscale-demos \\\n  --namespace ollyscale-demos \\\n  --create-namespace \\\n  --values charts/ollyscale-demos/values-local-dev.yaml\n</code></pre>"},{"location":"demos/custom-demo/#argocd-deployment-recommended","title":"ArgoCD Deployment (Recommended)","text":"<p>The demos are managed by ArgoCD via Terraform:</p> <pre><code># Enable custom demo in Terraform\ncd .kind\nterraform apply -var=\"custom_demo_enabled=true\"\n</code></pre>"},{"location":"demos/custom-demo/#configuration-options","title":"Configuration Options","text":"<p>Enable/disable via Helm values:</p> <pre><code>customDemo:\n  enabled: true # Set to false to disable\n\n  frontend:\n    image:\n      repository: ghcr.io/ryanfaircloth/demo-frontend\n      tag: latest\n\n    env:\n      otelExporterOtlpEndpoint: \"http://gateway-collector.ollyscale.svc.cluster.local:4317\"\n      otelServiceName: \"demo-frontend\"\n\n  backend:\n    image:\n      repository: ghcr.io/ryanfaircloth/demo-backend\n      tag: latest\n</code></pre>"},{"location":"demos/custom-demo/#access","title":"Access","text":"<p>After deployment, access the frontend via HTTPRoute:</p> <pre><code># Check deployment status\nkubectl get pods -n ollyscale-demos\n\n# Access frontend\ncurl https://demo-frontend.ollyscale.test:49443/\n\n# Or use port-forward\nkubectl port-forward -n ollyscale-demos svc/demo-frontend 5000:5000\ncurl http://localhost:5000/\n</code></pre>"},{"location":"demos/custom-demo/#viewing-telemetry","title":"Viewing Telemetry","text":"<p>Open ollyScale UI at <code>https://ollyscale.ollyscale.test</code> to see:</p> <ol> <li>Service Map: Visual graph showing frontend \u2192 backend relationships</li> <li>Traces: Distributed traces with detailed timing and attributes</li> <li>Logs: Application logs with trace context</li> <li>Metrics: RED metrics (Rate, Errors, Duration) per service</li> </ol>"},{"location":"demos/custom-demo/#development","title":"Development","text":""},{"location":"demos/custom-demo/#building-local-images","title":"Building Local Images","text":"<pre><code># Build and push to local registry\ncd charts\n./build-and-push-local.sh v2.1.x-custom-demo\n\n# Images will be built and pushed:\n# - registry.ollyscale.test:49443/ollyscale/demo-frontend:v2.1.x-custom-demo\n# - registry.ollyscale.test:49443/ollyscale/demo-backend:v2.1.x-custom-demo\n</code></pre>"},{"location":"demos/custom-demo/#source-code","title":"Source Code","text":"<p>Demo source code is located in:</p> <ul> <li><code>apps/demo/frontend.py</code> - Frontend Flask application</li> <li><code>apps/demo/backend.py</code> - Backend Flask application</li> <li><code>apps/demo/requirements.txt</code> - Python dependencies</li> </ul> <p>Dockerfiles:</p> <ul> <li><code>docker/dockerfiles/Dockerfile.demo-frontend</code></li> <li><code>docker/dockerfiles/Dockerfile.demo-backend</code></li> </ul>"},{"location":"demos/custom-demo/#troubleshooting","title":"Troubleshooting","text":""},{"location":"demos/custom-demo/#pods-not-starting","title":"Pods not starting","text":"<pre><code># Check pod status\nkubectl describe pod -n ollyscale-demos -l app.kubernetes.io/name=demo-frontend\n\n# Check logs\nkubectl logs -n ollyscale-demos -l app.kubernetes.io/name=demo-frontend\n</code></pre>"},{"location":"demos/custom-demo/#no-telemetry-in-ollyscale","title":"No telemetry in ollyScale","text":"<ol> <li>Verify OTel Collector is running:</li> </ol> <pre><code>kubectl get pods -n ollyscale -l app.kubernetes.io/name=opentelemetry-collector\n</code></pre> <ol> <li>Check demo environment variables:</li> </ol> <pre><code>kubectl get deployment demo-frontend -n ollyscale-demos -o yaml | grep OTEL_\n</code></pre> <ol> <li>Test collector connectivity:</li> </ol> <pre><code>kubectl exec -n ollyscale-demos deployment/demo-frontend -- \\\n  curl -v gateway-collector.ollyscale.svc.cluster.local:4317\n</code></pre>"},{"location":"demos/custom-demo/#httproute-not-working","title":"HTTPRoute not working","text":"<pre><code># Check HTTPRoute status\nkubectl get httproute -n ollyscale-demos demo-frontend -o yaml\n\n# Verify Gateway\nkubectl get gateway -n envoy-gateway-system cluster-gateway\n</code></pre>"},{"location":"demos/custom-demo/#traffic-generation","title":"Traffic Generation","text":"<p>A traffic generation script is provided to continuously send requests to the custom demo and create realistic observability data.</p>"},{"location":"demos/custom-demo/#usage","title":"Usage","text":"<pre><code># From the charts/ollyscale-demos directory\ncd charts/ollyscale-demos\n./generate-custom-demo-traffic.sh\n</code></pre> <p>The script:</p> <ul> <li>Sends requests to <code>https://demo-frontend.ollyscale.test:49443</code> (no port-forward needed)</li> <li>Generates realistic traffic patterns:</li> <li>50%: <code>/process-order</code> - Complex distributed traces</li> <li>20%: <code>/calculate</code> - Service-to-service calls</li> <li>20%: <code>/hello</code> - Simple requests</li> <li>10%: <code>/error</code> - Error scenarios</li> <li>Displays real-time request status with color-coded output</li> <li>Uses random delays (0.5-2 seconds) between requests</li> </ul>"},{"location":"demos/custom-demo/#requirements","title":"Requirements","text":"<ul> <li>Custom demo deployed via Helm/ArgoCD</li> <li>HTTPRoute configured and working</li> <li>Envoy Gateway running</li> </ul> <p>Press <code>Ctrl+C</code> to stop the traffic generator.</p>"},{"location":"demos/custom-demo/#example-use-cases","title":"Example Use Cases","text":""},{"location":"demos/custom-demo/#testing-service-dependencies","title":"Testing Service Dependencies","text":"<p>Use the <code>/process-order</code> endpoint to generate complex traces showing multiple service interactions.</p>"},{"location":"demos/custom-demo/#error-tracking","title":"Error Tracking","text":"<p>The <code>/error</code> endpoint creates error traces with exception details for testing error monitoring.</p>"},{"location":"demos/custom-demo/#load-testing","title":"Load Testing","text":"<p>Run the traffic generation script or adjust its timing for sustained load testing.</p>"},{"location":"demos/custom-demo/#metrics-analysis","title":"Metrics Analysis","text":"<p>Export Prometheus metrics to analyze request rates, error rates, and latency distributions.</p>"},{"location":"demos/custom-demo/#migration-from-k8s-demo","title":"Migration from k8s-demo","text":"<p>If you previously used <code>k8s-demo/</code>, the new Helm chart provides:</p> <ul> <li>\u2705 Same functionality with cleaner deployment</li> <li>\u2705 HTTPRoute integration (no LoadBalancer needed)</li> <li>\u2705 GitOps-ready via ArgoCD</li> <li>\u2705 Easy enable/disable via values</li> <li>\u2705 Local registry support for development</li> </ul> <p>See Migration Guide for details.</p>"},{"location":"demos/otel-demo/","title":"OpenTelemetry Demo","text":"<p>The OpenTelemetry Demo is the official demo application from the OpenTelemetry project, showcasing a realistic microservices-based e-commerce system.</p>"},{"location":"demos/otel-demo/#overview","title":"Overview","text":"<p>The OTel Demo (also known as \"Astronomy Shop\") is a complete distributed system featuring:</p> <ul> <li>11+ microservices in multiple languages (Go, Java, Node.js, Python, .NET, Rust, PHP)</li> <li>Realistic workflows: Product browsing, shopping cart, checkout, payments</li> <li>Built-in load generator: Automatic traffic simulation</li> <li>Rich telemetry: Traces, metrics, logs across all services</li> </ul> <p>When deployed with ollyScale, all telemetry data is sent to ollyScale's collectors instead of bundled backends.</p>"},{"location":"demos/otel-demo/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  frontend       \u2502\u2500\u2500\u2500\u2500\u2192\u2502 productcatalog  \u2502     \u2502  currencyservice\u2502\n\u2502  (TypeScript)   \u2502     \u2502  (Go)           \u2502     \u2502  (.NET)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502 cartservice     \u2502\u2500\u2500\u2500\u2500\u2192\u2502 redis           \u2502\n         \u2502              \u2502  (Go)           \u2502     \u2502  (cache)        \u2502\n         \u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502 checkoutservice \u2502\u2500\u2500\u2500\u2500\u2192\u2502 paymentservice  \u2502\n                        \u2502  (Go)           \u2502     \u2502  (Node.js)      \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                                 \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502 shippingservice \u2502\n                                 \u2502              \u2502  (Rust)         \u2502\n                                 \u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                                 \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502 emailservice    \u2502\n                                                \u2502  (Ruby)         \u2502\n                                                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u2193 OTLP\n        gateway-collector \u2192 ollyScale UI\n</code></pre>"},{"location":"demos/otel-demo/#services","title":"Services","text":"Service Language Purpose frontend TypeScript Web UI and BFF (Backend for Frontend) productcatalog Go Product inventory and search cartservice Go Shopping cart management with Redis checkoutservice Go Order processing orchestration paymentservice Node.js Payment processing currencyservice .NET Currency conversion shippingservice Rust Shipping cost calculation emailservice Ruby Order confirmation emails recommendationservice Python Product recommendations adservice Java Advertisement serving loadgenerator Python/Locust Traffic simulation"},{"location":"demos/otel-demo/#features","title":"Features","text":""},{"location":"demos/otel-demo/#multi-language-instrumentation","title":"Multi-Language Instrumentation","text":"<p>The demo showcases OpenTelemetry instrumentation across:</p> <ul> <li>Go: Auto-instrumentation with <code>otelhttp</code>, <code>otelgrpc</code></li> <li>Java: Auto-instrumentation via agent</li> <li>Python: Auto-instrumentation via <code>opentelemetry-instrument</code></li> <li>.NET: Native OTel SDK</li> <li>Node.js: Auto-instrumentation via SDK</li> <li>Rust: Manual instrumentation</li> <li>Ruby: SDK instrumentation</li> </ul>"},{"location":"demos/otel-demo/#realistic-scenarios","title":"Realistic Scenarios","text":"<p>The load generator creates realistic user flows:</p> <ul> <li>Browse products</li> <li>Add items to cart</li> <li>View cart</li> <li>Checkout process</li> <li>Payment processing</li> <li>Shipping calculation</li> </ul>"},{"location":"demos/otel-demo/#rich-telemetry","title":"Rich Telemetry","text":"<p>Traces:</p> <ul> <li>Multi-service distributed traces</li> <li>gRPC and HTTP spans</li> <li>Database queries (Redis)</li> <li>External service calls</li> </ul> <p>Metrics:</p> <ul> <li>Request rates per service</li> <li>Error rates</li> <li>Latency histograms</li> <li>Custom business metrics</li> </ul> <p>Logs:</p> <ul> <li>Structured logs with trace context</li> <li>Error logs</li> <li>Business event logs</li> </ul>"},{"location":"demos/otel-demo/#deployment","title":"Deployment","text":""},{"location":"demos/otel-demo/#helm-installation","title":"Helm Installation","text":"<pre><code># Install OTel Demo via ollyscale-demos chart\nhelm install ollyscale-demos charts/ollyscale-demos \\\n  --namespace ollyscale-demos \\\n  --create-namespace \\\n  --set customDemo.enabled=false \\\n  --set otelDemo.enabled=true\n</code></pre>"},{"location":"demos/otel-demo/#argocd-deployment-recommended","title":"ArgoCD Deployment (Recommended)","text":"<p>Enable via Terraform:</p> <pre><code>cd .kind\nterraform apply -var=\"otel_demo_enabled=true\" -var=\"custom_demo_enabled=false\"\n</code></pre>"},{"location":"demos/otel-demo/#configuration","title":"Configuration","text":"<p>The demo is deployed as a subchart dependency with ollyScale configuration:</p> <pre><code>otelDemo:\n  enabled: true\n\n  httpRoute:\n    enabled: true\n    hostname: otel-demo.ollyscale.test\n\nopentelemetry-demo:\n  # Disable bundled observability backends\n  opentelemetry-collector:\n    enabled: false\n  jaeger:\n    enabled: false\n  grafana:\n    enabled: false\n  prometheus:\n    enabled: false\n  opensearch:\n    enabled: false\n\n  # Configure OTLP export to ollyScale\n  default:\n    env:\n      - name: OTEL_EXPORTER_OTLP_ENDPOINT\n        value: \"http://gateway-collector.ollyscale.svc.cluster.local:4318\"\n      - name: OTEL_EXPORTER_OTLP_PROTOCOL\n        value: \"http/protobuf\"\n</code></pre>"},{"location":"demos/otel-demo/#access","title":"Access","text":""},{"location":"demos/otel-demo/#web-ui","title":"Web UI","text":"<p>After deployment, access the frontend:</p> <pre><code># Via HTTPRoute\ncurl https://otel-demo.ollyscale.test/\n\n# Or browser\nopen https://otel-demo.ollyscale.test/\n</code></pre>"},{"location":"demos/otel-demo/#service-endpoints","title":"Service Endpoints","text":"<p>The frontend provides:</p> <ul> <li>Homepage: Product catalog</li> <li>Product details: Individual product pages</li> <li>Cart: Shopping cart management</li> <li>Checkout: Order placement</li> </ul>"},{"location":"demos/otel-demo/#viewing-telemetry","title":"Viewing Telemetry","text":"<p>Open ollyScale UI at <code>https://ollyscale.ollyscale.test</code> to explore:</p>"},{"location":"demos/otel-demo/#service-map","title":"Service Map","text":"<p>See all 11+ services and their relationships:</p> <ul> <li>Frontend calling multiple backend services</li> <li>Checkout orchestrating payment, shipping, email</li> <li>Product catalog serving frontend and recommendations</li> </ul>"},{"location":"demos/otel-demo/#distributed-traces","title":"Distributed Traces","text":"<p>Example trace flow for checkout:</p> <ol> <li><code>frontend</code> - User initiates checkout</li> <li><code>checkoutservice</code> - Orchestrates order processing</li> <li><code>cartservice</code> - Retrieves cart items from Redis</li> <li><code>productcatalog</code> - Gets product details</li> <li><code>currencyservice</code> - Converts prices</li> <li><code>paymentservice</code> - Processes payment</li> <li><code>shippingservice</code> - Calculates shipping</li> <li><code>emailservice</code> - Sends confirmation</li> </ol> <p>Traces show:</p> <ul> <li>Total duration: ~500ms-2s</li> <li>Service-level timings</li> <li>gRPC/HTTP method details</li> <li>Error conditions</li> </ul>"},{"location":"demos/otel-demo/#metrics","title":"Metrics","text":"<p>View RED metrics per service:</p> <ul> <li>Rate: Requests/second</li> <li>Errors: Error rate %</li> <li>Duration: p50, p95, p99 latencies</li> </ul>"},{"location":"demos/otel-demo/#logs","title":"Logs","text":"<p>Application logs with:</p> <ul> <li>Trace IDs for correlation</li> <li>Structured fields (service, level, message)</li> <li>Error stack traces</li> </ul>"},{"location":"demos/otel-demo/#resource-requirements","title":"Resource Requirements","text":"<p>The OTel Demo is more resource-intensive than the custom demo:</p> <pre><code># Recommended resources for local dev\nresources:\n  requests:\n    memory: \"2Gi\"\n    cpu: \"1000m\"\n  limits:\n    memory: \"4Gi\"\n    cpu: \"2000m\"\n</code></pre> <p>Note: For local KIND clusters, ensure Docker/Podman has sufficient resources allocated (at least 4GB RAM).</p>"},{"location":"demos/otel-demo/#load-generation","title":"Load Generation","text":"<p>The demo includes an automatic load generator that:</p> <ul> <li>Simulates realistic user behavior</li> <li>Generates continuous traffic</li> <li>Creates diverse trace patterns</li> <li>Includes error scenarios</li> </ul> <p>To adjust load intensity, modify the load generator settings in Helm values.</p>"},{"location":"demos/otel-demo/#use-cases","title":"Use Cases","text":""},{"location":"demos/otel-demo/#multi-language-observability","title":"Multi-Language Observability","text":"<p>Perfect for testing ollyScale with polyglot microservices. See how different languages export telemetry.</p>"},{"location":"demos/otel-demo/#complex-distributed-traces","title":"Complex Distributed Traces","text":"<p>Explore deeply nested traces with 5-10 spans across multiple services.</p>"},{"location":"demos/otel-demo/#service-mesh-testing","title":"Service Mesh Testing","text":"<p>If using Istio or Linkerd, see how mesh-generated spans integrate with application spans.</p>"},{"location":"demos/otel-demo/#performance-analysis","title":"Performance Analysis","text":"<p>Identify bottlenecks in the checkout flow by analyzing trace timings.</p>"},{"location":"demos/otel-demo/#troubleshooting","title":"Troubleshooting","text":""},{"location":"demos/otel-demo/#high-resource-usage","title":"High Resource Usage","text":"<pre><code># Check pod resource usage\nkubectl top pods -n ollyscale-demos\n\n# Scale down load generator\nkubectl scale deployment loadgenerator -n ollyscale-demos --replicas=0\n</code></pre>"},{"location":"demos/otel-demo/#services-not-starting","title":"Services Not Starting","text":"<pre><code># Check pod status\nkubectl get pods -n ollyscale-demos\n\n# Describe failing pod\nkubectl describe pod &lt;pod-name&gt; -n ollyscale-demos\n\n# Check logs\nkubectl logs &lt;pod-name&gt; -n ollyscale-demos\n</code></pre>"},{"location":"demos/otel-demo/#no-telemetry","title":"No Telemetry","text":"<p>Verify OTLP endpoint configuration:</p> <pre><code># Check environment variable\nkubectl get deployment frontend -n ollyscale-demos -o yaml | grep OTEL_EXPORTER\n\n# Test collector connectivity\nkubectl exec -n ollyscale-demos deployment/frontend -- \\\n  curl -v gateway-collector.ollyscale.svc.cluster.local:4318\n</code></pre>"},{"location":"demos/otel-demo/#httproute-not-working","title":"HTTPRoute Not Working","text":"<pre><code># Check HTTPRoute\nkubectl get httproute otel-demo-frontend -n ollyscale-demos -o yaml\n\n# Verify backend service\nkubectl get svc -n ollyscale-demos | grep frontendproxy\n</code></pre>"},{"location":"demos/otel-demo/#chart-version","title":"Chart Version","text":"<p>The ollyscale-demos chart uses OpenTelemetry Demo Helm chart version:</p> <pre><code>dependencies:\n  - name: opentelemetry-demo\n    version: \"0.33.0\"\n    repository: https://open-telemetry.github.io/opentelemetry-helm-charts\n</code></pre> <p>To update to a newer version, modify <code>charts/ollyscale-demos/Chart.yaml</code> and run:</p> <pre><code>cd charts/ollyscale-demos\nhelm dependency update\n</code></pre>"},{"location":"demos/otel-demo/#comparison-with-custom-demo","title":"Comparison with Custom Demo","text":"Feature Custom Demo OTel Demo Services 2 11+ Languages Python Go, Java, Python, .NET, Node.js, Rust, Ruby Complexity Simple Production-realistic Resource Usage Low (~256MB) High (~2-4GB) Traces 3-5 spans 10-20 spans Best For Quick testing, development Comprehensive demos, training"},{"location":"demos/otel-demo/#migration-from-k8s-otel-demo","title":"Migration from k8s-otel-demo","text":"<p>If you previously used <code>k8s-otel-demo/</code>, the new Helm chart provides:</p> <ul> <li>\u2705 Same demo application, cleaner deployment</li> <li>\u2705 HTTPRoute integration for ingress</li> <li>\u2705 GitOps-ready via ArgoCD</li> <li>\u2705 Managed as subchart dependency</li> <li>\u2705 Automatic OTLP configuration</li> </ul> <p>See Migration Guide for details.</p>"},{"location":"demos/otel-demo/#references","title":"References","text":"<ul> <li>OpenTelemetry Demo Documentation</li> <li>Demo GitHub Repository</li> <li>Demo Helm Chart</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/","title":"ollyScale v2 - Postgres Backend Architecture","text":""},{"location":"plans/ollyscale-v2-postgres/#overview","title":"Overview","text":"<p>ollyScale v2 introduces a PostgreSQL-backed storage layer to replace the Redis-based ephemeral storage, providing persistent, queryable observability data with OTEL-aligned schema design.</p>"},{"location":"plans/ollyscale-v2-postgres/#architecture-principles","title":"Architecture Principles","text":""},{"location":"plans/ollyscale-v2-postgres/#core-tenets","title":"Core Tenets","text":"<ul> <li>OTEL-Native: Schema aligned with OpenTelemetry data model and semantic conventions</li> <li>Postgres-First: Leverage PostgreSQL features (JSONB, partitioning, indexes, pg_cron)</li> <li>Separation of Concerns: New <code>apps/frontend</code> app is independent from legacy <code>apps/ollyscale</code></li> <li>Clean Install: No migration/ETL from Redis required</li> <li>Kubernetes Native: Managed via Zalando Postgres Operator</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#technology-stack","title":"Technology Stack","text":"<ul> <li>Database: PostgreSQL 18+ via Zalando Postgres Operator</li> <li>App Framework: FastAPI with async SQLAlchemy</li> <li>Migration Tool: Alembic</li> <li>Exposure: Kubernetes Gateway API (HTTPRoutes)</li> <li>Deployment: Helm charts with K8s Jobs for migrations</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#data-model","title":"Data Model","text":""},{"location":"plans/ollyscale-v2-postgres/#signals","title":"Signals","text":"<p>Three primary telemetry signals with OTEL alignment:</p> <ol> <li>Traces (<code>spans_fact</code> table)</li> <li>Logs (<code>logs_fact</code> table)</li> <li>Metrics (<code>metrics_fact</code> table)</li> </ol>"},{"location":"plans/ollyscale-v2-postgres/#fact-tables","title":"Fact Tables","text":""},{"location":"plans/ollyscale-v2-postgres/#spans_fact","title":"spans_fact","text":"<p>Stores distributed trace spans with OTEL span model:</p> <pre><code>CREATE TABLE spans_fact (\n    id BIGSERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    connection_id VARCHAR(255),\n    trace_id VARCHAR(32) NOT NULL,\n    span_id VARCHAR(16) NOT NULL,\n    parent_span_id VARCHAR(16),\n\n    -- Core OTEL fields\n    name VARCHAR(1024) NOT NULL,\n    kind SMALLINT NOT NULL,  -- OTEL SpanKind enum\n    status_code SMALLINT,     -- OTEL StatusCode enum\n    status_message TEXT,\n\n    -- Timing\n    start_time_unix_nano BIGINT NOT NULL,\n    end_time_unix_nano BIGINT NOT NULL,\n    duration BIGINT GENERATED ALWAYS AS (end_time_unix_nano - start_time_unix_nano) STORED,\n\n    -- References\n    service_id INTEGER REFERENCES service_dim(id),\n    operation_id INTEGER REFERENCES operation_dim(id),\n    resource_id INTEGER REFERENCES resource_dim(id),\n\n    -- OTEL structures as JSONB\n    attributes JSONB,\n    events JSONB,\n    links JSONB,\n    resource JSONB,\n    scope JSONB,\n\n    -- Flags\n    flags INTEGER DEFAULT 0,\n    dropped_attributes_count INTEGER DEFAULT 0,\n    dropped_events_count INTEGER DEFAULT 0,\n    dropped_links_count INTEGER DEFAULT 0,\n\n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n) PARTITION BY RANGE (start_time_unix_nano);\n\nCREATE INDEX idx_spans_trace_id ON spans_fact(trace_id);\nCREATE INDEX idx_spans_service ON spans_fact(service_id);\nCREATE INDEX idx_spans_time ON spans_fact(start_time_unix_nano);\nCREATE INDEX idx_spans_attributes ON spans_fact USING GIN (attributes);\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#logs_fact","title":"logs_fact","text":"<p>Stores log entries with OTEL log data model:</p> <pre><code>CREATE TABLE logs_fact (\n    id BIGSERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    connection_id VARCHAR(255),\n\n    -- OTEL correlation\n    trace_id VARCHAR(32),\n    span_id VARCHAR(16),\n\n    -- Timing\n    time_unix_nano BIGINT NOT NULL,\n    observed_time_unix_nano BIGINT,\n\n    -- Severity\n    severity_number SMALLINT,\n    severity_text VARCHAR(64),\n\n    -- Content\n    body JSONB,\n\n    -- OTEL structures\n    attributes JSONB,\n    resource JSONB,\n    scope JSONB,\n\n    -- Flags\n    flags INTEGER DEFAULT 0,\n    dropped_attributes_count INTEGER DEFAULT 0,\n\n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n) PARTITION BY RANGE (time_unix_nano);\n\nCREATE INDEX idx_logs_trace_id ON logs_fact(trace_id);\nCREATE INDEX idx_logs_time ON logs_fact(time_unix_nano);\nCREATE INDEX idx_logs_severity ON logs_fact(severity_number);\nCREATE INDEX idx_logs_attributes ON logs_fact USING GIN (attributes);\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#metrics_fact","title":"metrics_fact","text":"<p>Stores metrics with OTEL metrics data model:</p> <pre><code>CREATE TABLE metrics_fact (\n    id BIGSERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    connection_id VARCHAR(255),\n\n    -- Metric identity\n    metric_name VARCHAR(1024) NOT NULL,\n    metric_type VARCHAR(32) NOT NULL,  -- gauge, sum, histogram, summary, exponential_histogram\n    unit VARCHAR(64),\n    description TEXT,\n\n    -- Timing\n    time_unix_nano BIGINT NOT NULL,\n    start_time_unix_nano BIGINT,\n\n    -- OTEL structures\n    resource JSONB,\n    scope JSONB,\n    attributes JSONB,\n    data_points JSONB,  -- Array of data point objects\n\n    -- Aggregation temporality (for sum/histogram)\n    temporality VARCHAR(32),\n\n    -- Monotonicity (for sum)\n    is_monotonic BOOLEAN,\n\n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n) PARTITION BY RANGE (time_unix_nano);\n\nCREATE INDEX idx_metrics_name ON metrics_fact(metric_name);\nCREATE INDEX idx_metrics_time ON metrics_fact(time_unix_nano);\nCREATE INDEX idx_metrics_attributes ON metrics_fact USING GIN (attributes);\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#dimension-tables","title":"Dimension Tables","text":""},{"location":"plans/ollyscale-v2-postgres/#service_dim","title":"service_dim","text":"<p>Service catalog:</p> <pre><code>CREATE TABLE service_dim (\n    id SERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    name VARCHAR(255) NOT NULL,\n    namespace VARCHAR(255) NOT NULL DEFAULT '',\n    version VARCHAR(255),\n    attributes JSONB,\n    first_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    UNIQUE(tenant_id, name, namespace)\n);\n</code></pre> <p>Note on namespace: Per OTEL spec, <code>service.namespace</code> is optional. We store empty string <code>''</code> when not provided (rather than NULL) so the UNIQUE constraint works correctly. OTEL spec states: \"If service.namespace is not specified then service.name is expected to be unique for all services that have no explicit namespace defined (so the empty/unspecified namespace is simply one more valid namespace).\"</p>"},{"location":"plans/ollyscale-v2-postgres/#operation_dim","title":"operation_dim","text":"<p>Operation (span name) catalog:</p> <pre><code>CREATE TABLE operation_dim (\n    id SERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    service_id INTEGER REFERENCES service_dim(id),\n    name VARCHAR(1024) NOT NULL,\n    span_kind SMALLINT,\n    first_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    UNIQUE(tenant_id, service_id, name, span_kind)\n);\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#resource_dim","title":"resource_dim","text":"<p>Resource attributes catalog:</p> <pre><code>CREATE TABLE resource_dim (\n    id SERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    resource_hash VARCHAR(64) NOT NULL,\n    attributes JSONB NOT NULL,\n    first_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    UNIQUE(tenant_id, resource_hash)\n);\n\nCREATE INDEX idx_resource_attributes ON resource_dim USING GIN (attributes);\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#retention-partitioning","title":"Retention &amp; Partitioning","text":""},{"location":"plans/ollyscale-v2-postgres/#retention-policy-table","title":"Retention Policy Table","text":"<pre><code>CREATE TABLE retention_policy (\n    id SERIAL PRIMARY KEY,\n    tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',\n    signal_type VARCHAR(32) NOT NULL,  -- 'traces', 'logs', 'metrics'\n    retention_days INTEGER NOT NULL DEFAULT 7,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    UNIQUE(tenant_id, signal_type)\n);\n\n-- Default retention policies\nINSERT INTO retention_policy (tenant_id, signal_type, retention_days) VALUES\n    ('default', 'traces', 7),\n    ('default', 'logs', 3),\n    ('default', 'metrics', 30);\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#partitioning-strategy","title":"Partitioning Strategy","text":"<p>Approach: Native PostgreSQL table partitioning by time range</p> <p>Interval: Daily partitions for spans_fact and logs_fact, weekly for metrics_fact</p> <p>Rationale:</p> <ul> <li>Daily spans/logs for fine-grained retention control</li> <li>Weekly metrics for reduced partition overhead (metrics have higher cardinality)</li> <li>Partition pruning optimizes time-range queries</li> <li>Easy partition dropping for retention enforcement</li> </ul> <p>Partition Naming:</p> <ul> <li><code>spans_fact_YYYYMMDD</code> (e.g., <code>spans_fact_20260121</code>)</li> <li><code>logs_fact_YYYYMMDD</code></li> <li><code>metrics_fact_YYYYWW</code> (e.g., <code>metrics_fact_202603</code> for week 3)</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#retention-enforcement","title":"Retention Enforcement","text":"<p>Mechanism: Kubernetes CronJob running daily at 02:00 UTC</p> <p>Process:</p> <ol> <li>Query <code>retention_policy</code> table for each signal type</li> <li>Calculate partition names older than retention window</li> <li>Drop expired partitions: <code>DROP TABLE IF EXISTS spans_fact_YYYYMMDD</code></li> <li>Log dropped partitions to stdout (captured by K8s logs)</li> </ol> <p>Job Specification: See <code>charts/ollyscale/templates/cronjob-retention.yaml</code></p>"},{"location":"plans/ollyscale-v2-postgres/#api-design","title":"API Design","text":""},{"location":"plans/ollyscale-v2-postgres/#endpoints","title":"Endpoints","text":""},{"location":"plans/ollyscale-v2-postgres/#ingest","title":"Ingest","text":"<ul> <li><code>POST /api/traces</code> - Ingest OTLP traces</li> <li><code>POST /api/logs</code> - Ingest OTLP logs</li> <li><code>POST /api/metrics</code> - Ingest OTLP metrics</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#query","title":"Query","text":"<ul> <li><code>GET /api/traces/search</code> - Search traces with filters</li> <li><code>GET /api/traces/{trace_id}</code> - Get trace by ID</li> <li><code>GET /api/logs/search</code> - Search logs with filters</li> <li><code>GET /api/metrics/search</code> - Query metrics</li> <li><code>GET /api/service-map</code> - Get service dependency graph</li> <li><code>GET /api/services</code> - List services with RED metrics</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#query-semantics","title":"Query Semantics","text":"<p>Time Range (Required):</p> <ul> <li>All queries require <code>start_time</code> and <code>end_time</code> parameters (Unix nanoseconds)</li> <li>Leverages partition pruning for performance</li> </ul> <p>Filtering:</p> <ul> <li>Structured filters: <code>{field: string, operator: string, value: any}[]</code></li> <li>Supported operators: <code>eq</code>, <code>ne</code>, <code>gt</code>, <code>lt</code>, <code>gte</code>, <code>lte</code>, <code>contains</code>, <code>regex</code></li> <li>Common fields: <code>service.name</code>, <code>http.method</code>, <code>status.code</code>, <code>severity</code>, <code>trace_id</code></li> </ul> <p>Pagination:</p> <ul> <li>Cursor-based pagination (opaque cursor encoding time + id)</li> <li><code>limit</code> parameter (default: 100, max: 1000)</li> <li>Response includes <code>has_more</code> boolean and <code>next_cursor</code> string</li> </ul> <p>Limits:</p> <ul> <li>Hard maximum of 1000 results per request (server-side enforcement)</li> <li>Query timeout: 30 seconds</li> <li>Large result warnings at 500+ rows</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#deployment","title":"Deployment","text":""},{"location":"plans/ollyscale-v2-postgres/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster with Gateway API CRDs installed</li> <li>Zalando Postgres Operator deployed</li> <li>Sufficient storage for Postgres PVCs (default: 30GB)</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#components","title":"Components","text":"<ol> <li>Postgres Cluster (<code>apps/frontend/postgres-cluster</code>)</li> <li>Zalando <code>postgresql</code> CRD resource</li> <li>Single-node, no HA (upgradeable to Patroni later)</li> <li> <p>Operator-managed credentials in Secret</p> </li> <li> <p>Migration Job (<code>charts/ollyscale/templates/job-migration.yaml</code>)</p> </li> <li>Runs Alembic <code>upgrade head</code> before app deployment</li> <li>Uses init container pattern with shared volume</li> <li> <p>Fails deployment if migrations fail</p> </li> <li> <p>Frontend App (<code>charts/ollyscale/templates/deployment-frontend.yaml</code>)</p> </li> <li>FastAPI app with async SQLAlchemy connection pool</li> <li>Reads DB credentials from operator-managed Secret</li> <li> <p>Readiness probe checks DB connectivity + migration status</p> </li> <li> <p>Gateway API (<code>charts/ollyscale/templates/httproute-frontend.yaml</code>)</p> </li> <li>HTTPRoute exposing <code>/api/*</code> paths</li> <li>Matches Gateway in <code>ollyscale</code> namespace</li> </ol>"},{"location":"plans/ollyscale-v2-postgres/#helm-values","title":"Helm Values","text":"<pre><code>postgres:\n  enabled: true\n  operator:\n    namespace: postgres-operator\n  cluster:\n    name: ollyscale-db\n    size: 30Gi\n    storageClass: standard\n  credentials:\n    secretName: ollyscale-db-credentials\n\nfrontend:\n  replicas: 2\n  image:\n    repository: ghcr.io/ryanfaircloth/ollyscale/frontend\n    tag: \"v2.0.0\"\n  resources:\n    requests:\n      memory: 512Mi\n      cpu: 250m\n    limits:\n      memory: 1Gi\n      cpu: 1000m\n  database:\n    poolSize: 20\n    maxOverflow: 10\n    queryTimeout: 30\n\nmigration:\n  enabled: true\n  backoffLimit: 3\n  ttlSecondsAfterFinished: 86400\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#credentials-flow","title":"Credentials Flow","text":"<ol> <li>Zalando Operator creates Secret: <code>&lt;cluster-name&gt;.&lt;user&gt;.&lt;secret-suffix&gt;</code></li> <li>Format: <code>ollyscale-db.frontend.credentials</code></li> <li> <p>Keys: <code>username</code>, <code>password</code>, <code>hostname</code>, <code>port</code>, <code>database</code></p> </li> <li> <p>Migration Job mounts Secret as environment variables:</p> </li> </ol> <pre><code>env:\n  - name: DB_HOST\n    valueFrom:\n      secretKeyRef:\n        name: ollyscale-db.frontend.credentials\n        key: hostname\n</code></pre> <ol> <li>Frontend App constructs connection string:</li> </ol> <pre><code>DB_URL = f\"postgresql+asyncpg://{username}:{password}@{hostname}:{port}/{database}\"\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#migration-management","title":"Migration Management","text":""},{"location":"plans/ollyscale-v2-postgres/#alembic-configuration","title":"Alembic Configuration","text":"<p>Location: <code>apps/frontend/migrations/</code></p> <p>Key Files:</p> <ul> <li><code>alembic.ini</code> - Alembic configuration</li> <li><code>env.py</code> - Environment setup with async support</li> <li><code>versions/</code> - Migration scripts</li> </ul> <p>Connection String:</p> <pre><code># env.py\nconfig.set_main_option(\n    \"sqlalchemy.url\",\n    os.getenv(\"DATABASE_URL\", \"postgresql+asyncpg://localhost/ollyscale\")\n)\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#creating-migrations","title":"Creating Migrations","text":"<pre><code>cd apps/frontend\npoetry run alembic revision -m \"add spans_fact partitioning\"\n# Edit generated file in migrations/versions/\npoetry run alembic upgrade head  # Test locally\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#migration-job-flow","title":"Migration Job Flow","text":"<ol> <li>Init container runs <code>alembic upgrade head</code></li> <li>Logs migration output to stdout</li> <li>Exits with code 0 on success, non-zero on failure</li> <li>Main app container only starts if init container succeeds</li> <li>Kubernetes backoff handles transient failures</li> </ol>"},{"location":"plans/ollyscale-v2-postgres/#rollback-strategy","title":"Rollback Strategy","text":"<p>Automatic Rollback: Not supported (forward-only migrations)</p> <p>Manual Rollback:</p> <pre><code>kubectl exec -it &lt;migration-job-pod&gt; -- alembic downgrade -1\n</code></pre> <p>Backup Strategy (future):</p> <ul> <li>pg_dump before major schema changes</li> <li>Stored in S3-compatible object storage</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#health-endpoints","title":"Health Endpoints","text":""},{"location":"plans/ollyscale-v2-postgres/#health-overall-status","title":"<code>/health</code> (Overall Status)","text":"<p>Returns 200 if app is healthy, 503 if degraded:</p> <pre><code>{\n  \"status\": \"healthy\",\n  \"database\": \"connected\",\n  \"migrations\": \"current\",\n  \"version\": \"v2.0.0\"\n}\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#healthdb-database-status","title":"<code>/health/db</code> (Database Status)","text":"<p>Returns DB connectivity and migration status:</p> <pre><code>{\n  \"connected\": true,\n  \"pool_size\": 20,\n  \"pool_active\": 5,\n  \"migrations_applied\": 42,\n  \"latest_migration\": \"20260121_add_metrics_partitioning\"\n}\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#observability-performance","title":"Observability &amp; Performance","text":""},{"location":"plans/ollyscale-v2-postgres/#instrumentation","title":"Instrumentation","text":"<p>OTEL Tracing:</p> <ul> <li>FastAPI automatic instrumentation via <code>opentelemetry-instrumentation-fastapi</code></li> <li>SQLAlchemy query tracing via <code>opentelemetry-instrumentation-sqlalchemy</code></li> <li>Sampling: 10% for normal requests, 100% for errors</li> </ul> <p>Metrics:</p> <ul> <li>HTTP request duration (histogram)</li> <li>Database connection pool stats (gauge)</li> <li>Query execution time by endpoint (histogram)</li> <li>Ingest throughput (counter)</li> </ul> <p>Logging:</p> <ul> <li>Structured JSON logs to stdout</li> <li>Correlation via <code>trace_id</code> and <code>span_id</code> fields</li> <li>Log levels: INFO (normal), DEBUG (query details), ERROR (failures)</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#performance-optimization","title":"Performance Optimization","text":"<p>Indexes:</p> <ul> <li>B-tree on time columns (partition key)</li> <li>B-tree on trace_id, span_id (exact match queries)</li> <li>GIN on JSONB attributes (attribute filtering)</li> <li>Composite indexes on (service_id, time) for service-filtered queries</li> </ul> <p>Query Patterns:</p> <ul> <li>Always include time range in WHERE clause (partition pruning)</li> <li>Use <code>attributes @&gt; '{\"key\": \"value\"}'</code> for JSONB filtering</li> <li>Prefer <code>EXISTS</code> over <code>IN</code> for subqueries</li> <li>Use <code>EXPLAIN ANALYZE</code> for slow query debugging</li> </ul> <p>Connection Pooling:</p> <ul> <li>SQLAlchemy async pool: 20 connections, max_overflow 10</li> <li>Connection timeout: 5 seconds</li> <li>Pool pre-ping enabled for stale connection detection</li> </ul> <p>Caching (future):</p> <ul> <li>Service map cached for 30 seconds (Redis)</li> <li>Service catalog cached for 5 minutes</li> <li>Query result caching for identical time ranges (optional)</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#troubleshooting","title":"Troubleshooting","text":""},{"location":"plans/ollyscale-v2-postgres/#migration-failures","title":"Migration Failures","text":"<p>Symptom: Migration Job fails, pods stuck in Init</p> <p>Diagnosis:</p> <pre><code>kubectl logs -n ollyscale job/ollyscale-migration\n</code></pre> <p>Common Causes:</p> <ul> <li>DB credentials incorrect (check Secret)</li> <li>DB not reachable (check network policies)</li> <li>Syntax error in migration script</li> <li>Concurrent migration attempts (lock timeout)</li> </ul> <p>Resolution:</p> <ul> <li>Fix underlying issue (credentials, network, SQL)</li> <li>Delete failed Job: <code>kubectl delete job -n ollyscale ollyscale-migration</code></li> <li>Helm upgrade will recreate Job</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#slow-queries","title":"Slow Queries","text":"<p>Symptom: API timeouts, high DB load</p> <p>Diagnosis:</p> <pre><code>-- Check slow queries\nSELECT * FROM pg_stat_statements\nORDER BY mean_exec_time DESC\nLIMIT 10;\n\n-- Check missing indexes\nSELECT schemaname, tablename, attname, n_distinct, correlation\nFROM pg_stats\nWHERE schemaname = 'public'\nAND correlation &lt; 0.5;\n</code></pre> <p>Resolution:</p> <ul> <li>Add missing indexes based on query patterns</li> <li>Reduce query time range</li> <li>Increase <code>limit</code> parameter instead of broad queries</li> <li>Consider query result caching</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#high-cardinality","title":"High Cardinality","text":"<p>Symptom: Metrics table growing rapidly, slow queries</p> <p>Diagnosis:</p> <pre><code>SELECT metric_name, COUNT(DISTINCT attributes) as cardinality\nFROM metrics_fact\nWHERE time_unix_nano &gt; extract(epoch from now() - interval '1 hour') * 1000000000\nGROUP BY metric_name\nORDER BY cardinality DESC\nLIMIT 20;\n</code></pre> <p>Resolution:</p> <ul> <li>Identify high-cardinality metrics</li> <li>Drop unnecessary attributes at ingestion (OTEL Processor)</li> <li>Implement attribute allowlist/blocklist</li> <li>Consider aggregating high-cardinality metrics</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#partition-management","title":"Partition Management","text":"<p>Symptom: Retention Job fails, old partitions not dropping</p> <p>Diagnosis:</p> <pre><code>kubectl logs -n ollyscale cronjob/ollyscale-retention\n</code></pre> <p>Resolution:</p> <ul> <li>Check CronJob schedule and last run time</li> <li>Verify <code>retention_policy</code> table values</li> <li>Manually drop partitions if needed:</li> </ul> <pre><code>DROP TABLE IF EXISTS spans_fact_20260101;\n</code></pre>"},{"location":"plans/ollyscale-v2-postgres/#future-enhancements","title":"Future Enhancements","text":"<p>High Availability:</p> <ul> <li>Enable Patroni for Postgres HA (Zalando Operator supports this)</li> <li>Multi-replica frontend app (already supported)</li> <li>Cross-AZ deployment</li> </ul> <p>Backups:</p> <ul> <li>Automated pg_basebackup to S3</li> <li>Point-in-time recovery (PITR) via WAL archiving</li> <li>Backup retention policy (30 days)</li> </ul> <p>Multi-Tenancy:</p> <ul> <li>Row-level security (RLS) for tenant isolation</li> <li>Separate schemas per tenant</li> <li>Tenant-specific retention policies</li> </ul> <p>Query Optimization:</p> <ul> <li>Materialized views for service catalog</li> <li>Pre-aggregated RED metrics tables</li> <li>Query result caching (Redis)</li> </ul> <p>Advanced Features:</p> <ul> <li>Trace exemplars linked to metrics</li> <li>Log pattern detection</li> <li>Anomaly detection on metrics</li> <li>Alerting on query results</li> </ul>"},{"location":"plans/ollyscale-v2-postgres/#references","title":"References","text":"<ul> <li>OpenTelemetry Specification</li> <li>Zalando Postgres Operator</li> <li>PostgreSQL Partitioning</li> <li>Alembic Documentation</li> <li>FastAPI Async SQL</li> </ul>"},{"location":"plans/react-ui-implementation-plan/","title":"React UI Implementation Plan - ollyScale v3","text":"<p>\ud83d\udcca CURRENT STATUS (2026-02-01):</p> <p>\u2705 Phases 1-6, 9, 10.2 (Basic), 10.3 COMPLETE: Core UI with i18n and browser telemetry deployed</p> <ul> <li>Apps deployed:</li> <li>\u2705 ollyscale-webui (React UI)</li> <li>\u2705 ollyscale-legacyui (old UI for comparison)</li> <li>\u2705 ollyscale-api (PostgreSQL backend)</li> <li> <p>\u2705 ollyscale-browser-collector (browser telemetry collector)</p> </li> <li> <p>Key Features Working:</p> </li> <li>\u2705 All 9 pages (Dashboard, Traces, Spans, Logs, Metrics, Services, Service Map, AI Agents stub, Collector Config stub)</li> <li>\u2705 Service Map with icons (PostgreSQL, MySQL, MongoDB, Redis, Kafka, RabbitMQ, Nginx)</li> <li>\u2705 Auto-refresh with sliding time window (LIVE/PAUSED mode)</li> <li>\u2705 Query builder with filters and presets</li> <li>\u2705 Charts and visualizations (Chart.js, Cytoscape)</li> <li>\u2705 Dark/light theme support</li> <li>\u2705 Internationalization (i18n) - 287 translation keys, en-US/en-GB, LanguageSelector component</li> <li> <p>\u2705 Browser Telemetry (Basic) - Auto-instrumented traces for page loads, interactions, API calls</p> </li> <li> <p>Priority Enhancements Needed (See \"Priority Next Steps\" at end):</p> </li> <li>\ud83d\udd04 Browser Telemetry Enhancements (Priority 1): Add error handlers, ErrorBoundary, custom events</li> <li>\ud83d\udd04 Testing (Priority 2): Infrastructure installed, need tests written (only 1 test file exists)</li> <li>\ud83d\udd04 AI Agents (Priority 3): GenAI span visualization with token tracking</li> <li> <p>\ud83d\udd04 OTel Config (Priority 4): OpAMP integration for collector management</p> </li> <li> <p>Next Steps: See \"Priority Next Steps\" section at end of document</p> </li> </ul> <p>\u26a0\ufe0f NOTE: Prior status files (react-ui-decisions.md, react-ui-implementation-status.md) were outdated and have been removed. This plan is now the single source of truth.</p> <p>Last Verified: 2026-02-01 (after i18n implementation and status verification)</p>"},{"location":"plans/react-ui-implementation-plan/#overview","title":"Overview","text":"<p>This plan outlines the complete migration from the current Vanilla JS/TypeScript UI (<code>apps/ollyscale-ui</code>) to a modern React-based UI with Bootstrap styling, advanced query builder, and embedded documentation.</p>"},{"location":"plans/react-ui-implementation-plan/#goals","title":"Goals","text":"<ol> <li>Framework Migration: Replace Vanilla JS with React for better state management and component reusability</li> <li>UI Framework: Implement Bootstrap for consistent, professional styling</li> <li>Query Builder: Replace simple text filters with a visual query builder for complex filtering</li> <li>Embedded Documentation: Move documentation into the product for better user experience</li> <li>Functional Parity: Maintain all existing features from the current UI</li> <li>Code Cleanup: Remove TinyOlly legacy code as part of the redesign</li> </ol>"},{"location":"plans/react-ui-implementation-plan/#technology-stack","title":"Technology Stack","text":""},{"location":"plans/react-ui-implementation-plan/#core","title":"Core","text":"<ul> <li>React 18+: Modern React with hooks</li> <li>TypeScript: Type safety and better developer experience</li> <li>Vite: Fast build tooling (already in use)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#ui-framework","title":"UI Framework","text":"<ul> <li>React Bootstrap: Bootstrap 5 components for React</li> <li>Bootstrap Icons: Consistent icon set</li> <li>React Router: Client-side routing</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#query-builder","title":"Query Builder","text":"<p>\u2705 PARTIALLY IMPLEMENTED</p> <ul> <li>react-querybuilder: Advanced query builder component (INSTALLED)</li> <li>Custom query builder components built (QueryBuilder, CompactQueryBuilder, EnhancedQueryBuilder)</li> <li>Custom operators for OTLP field types (CUSTOM IMPLEMENTATION, not using react-querybuilder library features)</li> <li>Field schemas defined for traces, spans, logs, metrics</li> <li>\u274c NOT using react-querybuilder's built-in UI components</li> <li>\u274c Visual query builder UI not implemented (using custom compact version)</li> <li>\u274c Save/load filter presets not implemented</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#state-management","title":"State Management","text":"<ul> <li>React Context API: Global state (theme, namespace filters)</li> <li>TanStack Query (React Query): Server state management, caching, auto-refresh</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#charts-visualization","title":"Charts &amp; Visualization","text":"<ul> <li>Recharts: React-based charting library (replaces Chart.js)</li> <li>React Cytoscape: Service map visualization (replaces Cytoscape.js direct usage)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#browser-telemetry","title":"Browser Telemetry","text":"<p>\u2705 BASIC IMPLEMENTATION COMPLETE (2026-01-30) \ud83d\udd04 ENHANCEMENTS NEEDED (error handling, custom events)</p> <ul> <li>@opentelemetry/api 1.9.0: OpenTelemetry API (INSTALLED)</li> <li>@opentelemetry/sdk-trace-web 2.5.0: Browser tracing SDK (INSTALLED)</li> <li>@opentelemetry/auto-instrumentations-web 0.56.0: Auto-instrumentation meta-package (INSTALLED)</li> <li>\u2705 Document load instrumentation (page performance)</li> <li>\u2705 User interaction instrumentation (clicks, form submits)</li> <li>\u2705 Fetch/XHR instrumentation (API call tracing)</li> <li>@opentelemetry/exporter-trace-otlp-http 0.211.0: OTLP HTTP exporter (INSTALLED)</li> <li>@opentelemetry/semantic-conventions 1.39.0: Semantic conventions (INSTALLED)</li> <li>Implementation Status:</li> <li>\u2705 src/telemetry/config.ts - Provider, exporter, consent checking</li> <li>\u2705 src/telemetry/instrumentations.ts - Auto-instrumentations configuration</li> <li>\u2705 ConsentBanner component for GDPR compliance</li> <li>\u2705 useTracing hook with startSpan, recordError, addEvent helpers</li> <li>\u2705 OpenTelemetryCollector CR deployed (ollyscale-browser-collector)</li> <li>\u2705 HTTPRoute configured for /v1/traces with proper routing</li> <li>\u274c Global error handler (window.onerror) - NOT IMPLEMENTED</li> <li>\u274c Promise rejection handler (window.onunhandledrejection) - NOT IMPLEMENTED</li> <li>\u274c ErrorBoundary component for React errors - NOT IMPLEMENTED</li> <li>\u274c Custom business events - NOT IMPLEMENTED</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#internationalization","title":"Internationalization","text":"<p>\u2705 FULLY IMPLEMENTED (2026-02-01, commit 1a166f2)</p> <ul> <li>react-i18next: Translation management (INSTALLED v15.2.0)</li> <li>i18next: Core i18n library (INSTALLED v24.2.2)</li> <li> <p>i18next-browser-languagedetector: Auto-detect browser language (INSTALLED v8.0.2) \ud83d\udd04 INFRASTRUCTURE INSTALLED, TESTS NEEDED</p> </li> <li> <p>Vitest 4.0.18: Fast unit testing (INSTALLED)</p> </li> <li>@vitest/ui: Vitest UI for test runner (INSTALLED)</li> <li>React Testing Library 16.3.2: Component testing (INSTALLED)</li> <li>@testing-library/jest-dom 6.9.1: Custom matchers (INSTALLED)</li> <li>@testing-library/user-event 14.6.1: User interaction simulation (INSTALLED)</li> <li>MSW (Mock Service Worker): API mocking (\u274c NOT INSTALLED YET)</li> <li>Playwright: E2E testing (\u274c NOT INSTALLED, optional)</li> <li>Test Files: Only 1 test file exists (useDebounce.test.ts with 4 test cases)</li> <li>Test Configuration: \u2705 vitest.config.ts exists, scripts in package.json</li> <li>Coverage Goal: 80%+ (currently near 0%)ish, French, German, Japanese</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#testing","title":"Testing","text":"<p>\u274c NOT IMPLEMENTED YET</p> <ul> <li>Vitest: Fast unit testing (NOT INSTALLED)</li> <li>React Testing Library: Component testing (NOT INSTALLED)</li> <li>@testing-library/jest-dom: Custom matchers (NOT INSTALLED)</li> <li>@testing-library/user-event: User interaction simulation (NOT INSTALLED)</li> <li>MSW (Mock Service Worker): API mocking (NOT INSTALLED)</li> <li>Playwright: E2E testing (NOT INSTALLED)</li> <li>No test files exist (0 .test.ts or .test.tsx files)</li> <li>No test configuration</li> <li>No mocks or test utilities</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#code-quality","title":"Code Quality","text":"<ul> <li>ESLint: Linting with React rules</li> <li>Prettier: Code formatting</li> <li>TypeScript: Strict mode enabled</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#directory-structure","title":"Directory Structure","text":"<pre><code>apps/react-ui/\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 vite.config.ts\n\u251c\u2500\u2500 index.html\n\u251c\u2500\u2500 public/\n\u2502   \u251c\u2500\u2500 manifest.json          # PWA manifest\n\u2502   \u251c\u2500\u2500 service-worker.js      # Basic service worker\n\u2502   \u2514\u2500\u2500 assets/\n\u2502       \u251c\u2500\u2500 logo.svg\n\u2502       \u251c\u2500\u2500 favicon.ico\n\u2502       \u2514\u2500\u2500 icons/             # PWA icons (192x192, 512x512)\n\u2502           \u251c\u2500\u2500 icon-192.png\n\u2502           \u2514\u2500\u2500 icon-512.png\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 main.tsx                    # Entry point\n\u2502   \u251c\u2500\u2500 App.tsx                     # Root component\n\u2502   \u251c\u2500\u2500 vite-env.d.ts\n\u2502   \u251c\u2500\u2500 telemetry.ts                # OpenTelemetry browser setup\n\u2502   \u251c\u2500\u2500 i18n.ts                     # i18next configuration\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 components/                 # Reusable components\n\u2502   \u2502   \u251c\u2500\u2500 layout/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 AppLayout.tsx       # Main layout with sidebar\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 Sidebar.tsx         # Navigation sidebar\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 Header.tsx          # Top header (breadcrumbs, actions)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 Footer.tsx          # Footer\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ConsentBanner.tsx   # GDPR telemetry consent\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 common/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 LoadingSpinner.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ErrorBoundary.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 EmptyState.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 CopyButton.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 DownloadButton.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 RefreshButton.tsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 Badge.tsx\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 query/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 QueryBuilder.tsx    # Main query builder\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 FilterGroup.tsx     # Filter group (AND/OR)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 FilterRule.tsx      # Individual filter\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 FieldSelector.tsx   # OTLP field dropdown\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 OperatorSelector.tsx # eq, ne, contains, regex\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ValueInput.tsx      # Value input with type hints\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 telemetry/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 TraceCard.tsx       # Trace list item\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 SpanCard.tsx        # Span list item\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 LogCard.tsx         # Log entry\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 MetricCard.tsx      # Metric display\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 TraceWaterfall.tsx  # Trace waterfall view\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 SpanDetail.tsx      # Span detail modal\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 AttributeTable.tsx  # OTLP attributes\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 JsonViewer.tsx      # Pretty JSON viewer\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500 docs/\n\u2502   \u2502       \u251c\u2500\u2500 DocsSidebar.tsx     # Documentation sidebar\n\u2502   \u2502       \u251c\u2500\u2500 DocsSearch.tsx      # Search docs\n\u2502   \u2502       \u251c\u2500\u2500 DocContent.tsx      # Render markdown content\n\u2502   \u2502       \u2514\u2500\u2500 QuickHelp.tsx       # Context-sensitive help\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 pages/                      # Page components\n\u2502   \u2502   \u251c\u2500\u2500 TracesPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 SpansPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 LogsPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 MetricsPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServiceMapPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServiceCatalogPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 AIAgentsPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 CollectorConfigPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 DocsPage.tsx            # Embedded documentation\n\u2502   \u2502   \u2514\u2500\u2500 NotFoundPage.tsx\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 features/                   # Feature-specific modules\n\u2502   \u2502   \u251c\u2500\u2500 traces/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 useTraces.ts\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 useTraceDetail.ts\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 useTraceFilters.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 components/\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 TraceList.tsx\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 TraceDetail.tsx\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 TraceFilters.tsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 types.ts\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 spans/\n\u2502   \u2502   \u251c\u2500\u2500 logs/\n\u2502   \u2502   \u251c\u2500\u2500 metrics/\n\u2502   \u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 docs/\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 api/                        # API client\n\u2502   \u2502   \u251c\u2500\u2500 client.ts               # Base API client\n\u2502   \u2502   \u251c\u2500\u2500 queries/                # React Query hooks\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 useTracesQuery.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 useLogsQuery.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 useMetricsQuery.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 useServicesQuery.ts\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 useServiceMapQuery.ts\n\u2502   \u2502   \u2514\u2500\u2500 types/\n\u2502   \u2502       \u251c\u2500\u2500 trace.ts\n\u2502   \u2502       \u251c\u2500\u2500 log.ts\n\u2502   \u2502       \u251c\u2500\u2500 metric.ts\n\u2502   \u2502       \u2514\u2500\u2500 service.ts\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 contexts/                   # React contexts\n\u2502   \u2502   \u251c\u2500\u2500 ThemeContext.tsx        # Dark/light theme\n\u2502   \u2502   \u251c\u2500\u2500 DocsContext.tsx         # Documentation state\n\u2502   \u2502   \u2514\u2500\u2500 LanguageContext.tsx     # i18n language selection\n\u2502   \u2502   \u251c\u2500\u2500 RefreshContext.tsx      # Auto-refresh control\n\u2502   \u2502   \u2514\u2500\u2500 DocsContext.tsx         # Documentation state\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 hooks/                      # Custom hooks\n\u2502   \u2502   \u251c\u2500\u2500 useAutoRefresh.ts       # Auto-refresh logic\n\u2502   \u2502   \u251c\u2500\u2500 useLocalStorage.ts      # Persist state\n\u2502   \u2502   \u251c\u2500\u2500 useDebounce.ts          # Debounce input\n\u2502   \u2502   \u251c\u2500\u2500 useQuery.ts             # Query builder state\n\u2502   \u2502   \u2514\u2500\u2500 usePagination.ts        # Pagination logic\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 utils/                      # Utility functions\n\u2502   \u2502   \u251c\u2500\u2500 formatting.ts           # Time, duration, trace ID formatting\n\u2502   \u2502   \u251c\u2500\u2500 otlp.ts                 # OTLP helpers\n\u2502   \u2502   \u251c\u2500\u2500 validation.ts           # Form validation\n\u2502   \u2502   \u2514\u2500\u2500 constants.ts            # App constants\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 styles/                     # Global styles\n\u2502   \u2502   \u251c\u2500\u2500 main.scss               # Bootstrap customization\n\u2502   \u251c\u2500\u2500 locales/                    # Translation files\n\u2502   \u2502   \u251c\u2500\u2500 en-US/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 translation.json\n\u2502   \u2502   \u2514\u2500\u2500 en-GB/\n\u2502   \u2502       \u2514\u2500\u2500 translation.json\n\u2502   \u2502   # Future: es, fr, de, ja\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 __tests__/                  # Test files\n\u2502   \u2502   \u251c\u2500\u2500 setup.ts                # Test setup\n\u2502   \u2502   \u251c\u2500\u2500 mocks/                  # Mock data\n\u2502   \u2502   \u251c\u2500\u2500 components/             # Component tests\n\u2502   \u2502   \u251c\u2500\u2500 hooks/                  # Hook tests\n\u2502   \u2502   \u2514\u2500\u2500 integration/            # Integration tests\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 assets/                     # Static assets\n\u2502       \u2514\u2500\u2500 docs/                   # Embedded docs (markdown)\n\u2502           \u251c\u2500\u2500 en-US/              # English US docs\n\u2502           \u2502   \u251c\u2500\u2500 index.md\n\u2502           \u2502   \u251c\u2500\u2500 quickstart.md\n\u2502           \u2502   \u251c\u2500\u2500 traces.md\n\u2502           \u2502   \u251c\u2500\u2500 logs.md\n\u2502           \u2502   \u251c\u2500\u2500 metrics.md\n\u2502           \u2502   \u2514\u2500\u2500 api.md\n\u2502           \u2514\u2500\u2500 en-GB/              # English GB docs (UK spelling)\n\u2502               # Future: es, fr, de, ja.md\n\u2502           \u251c\u2500\u2500 logs.md\n\u2502           \u251c\u2500\u2500 metrics.md\n\u2502           \u2514\u2500\u2500 api.md\n``OpenTelemetry Browser SDK\nnpm install @opentelemetry/api @opentelemetry/sdk-trace-web\nnpm install @opentelemetry/instrumentation-document-load\nnpm install @opentelemetry/instrumentation-user-interaction\nnpm install @opentelemetry/instrumentation-fetch\nnpm install @opentelemetry/instrumentation-xml-http-request\nnpm install @opentelemetry/exporter-trace-otlp-http\nnpm install @opentelemetry/resources @opentelemetry/semantic-conventions\n\n# Internationalization\nnpm install react-i18next i18next i18next-browser-languagedetector\n\n# Utilities\nnpm install date-fns clsx\n\n# Dev Dependencies\nnpm install -D @types/react @types/react-dom\nnpm install -D @typescript-eslint/eslint-plugin @typescript-eslint/parser\nnpm install -D sass\n\n# Testing\nnpm install -D vitest @vitest/ui\nnpm install -D @testing-library/react @testing-library/jest-dom\nnpm install -D @testing-library/user-event\nnpm install -D msw\nnpm install -D @playwright/test\nnpm install -D happy-dom # or jsdom React App\n- [ ] Create `apps/react-ui/` directory\n- [ ] Initialize with Vite + React + TypeScript\n- [ ] Configure ESLint, Prettier, TypeScript strict mode\n- [ ] Setup pre-commit hooks (already exist at repo level)\n\n#### 1.2 Install Dependencies - \ud83d\udd04 PARTIALLY COMPLETED\n\n**\u2705 INSTALLED:**\n```bash\n# Core - DONE\nnpm install react react-dom react-router-dom\nnpm install bootstrap react-bootstrap bootstrap-icons\nnpm install @tanstack/react-query axios\n\n# Query Builder - DONE (but custom implementation, not using library features)\nnpm install react-querybuilder\n\n# Charts &amp; Visualization - DONE\nnpm install recharts react-cytoscapejs cytoscape\n\n# Utilities\nnpm install date-fns clsx\n\n# PWA\nnpm install workbox-precaching workbox-routing\n\n# Dev Dependencies\nnpm install -D @types/react @types/react-dom\nnpm install -D @typescript-eslint/eslint-plugin @typescript-eslint/parser\nnpm install -D sass\nnpm install -D vite-plugin-pwa\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#13-configure-build-system-completed","title":"1.3 Configure Build System - \u2705 COMPLETED","text":"<ul> <li>[x] Update <code>vite.config.ts</code> with aliases, proxy to API</li> <li>[x] Configure Bootstrap SCSS imports</li> <li>[x] Setup environment variables (API base URL)</li> <li>[x] Configure PWA with vite-plugin-pwa</li> <li>[x] Static assets (logo, favicon) serving correctly</li> <li>[x] Multi-stage Dockerfile (Node build + nginx serve)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#14-create-base-layout-branding-completed","title":"1.4 Create Base Layout &amp; Branding - \u2705 COMPLETED","text":"<ul> <li>[x] <code>AppLayout.tsx</code> - Main layout container</li> <li>[x] <code>Sidebar.tsx</code> - Navigation sidebar with ollyScale logo</li> <li>[x] <code>Header.tsx</code> - Top header with breadcrumbs</li> <li>[x] Routing setup with React Router</li> <li>[x] <code>LoadingSpinner.tsx</code> - Animated logo spinner</li> <li>[x] <code>EmptyState.tsx</code> - Logo-based empty states</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-2-api-client-state-management-week-1-2-completed","title":"Phase 2: API Client &amp; State Management (Week 1-2) - \u2705 COMPLETED","text":""},{"location":"plans/react-ui-implementation-plan/#21-api-client-completed","title":"2.1 API Client - \u2705 COMPLETED","text":"<ul> <li>[x] Create <code>api/client.ts</code> with axios instance</li> <li>[x] Implement API types from OpenAPI spec (in <code>api/types/</code>)</li> <li>[x] Enhanced error handling and response transformation with APIError type</li> <li>[x] Request/response interceptors with user-friendly error messages</li> <li>[x] Status code-specific error handling (400, 401, 403, 404, 422, 429, 500, 503)</li> <li>[x] Network error and timeout handling</li> <li>[x] Development-only error logging</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#22-react-query-setup-completed","title":"2.2 React Query Setup - \u2705 COMPLETED","text":"<ul> <li>[x] Configure QueryClient with defaults</li> <li>[x] Create base query hooks:</li> <li>[x] <code>useTracesQuery</code> (POST /api/traces/search)</li> <li>[x] <code>useSpansQuery</code> (POST /api/spans/search)</li> <li>[x] <code>useLogsQuery</code> (POST /api/logs/search)</li> <li>[x] <code>useMetricsQuery</code> (POST /api/metrics/search)</li> <li>[x] <code>useServicesQuery</code> (POST /api/services)</li> <li>[x] <code>useServiceMapQuery</code> (POST /api/service-map)</li> <li>[x] <code>useTraceDetailQuery</code> (GET /api/traces/{id})</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#23-context-providers-completed","title":"2.3 Context Providers - \u2705 COMPLETED","text":"<ul> <li>[x] ThemeContext (dark/light/auto mode with system preference detection)</li> <li>[x] QueryContext (filters, time ranges, live mode, presets)</li> <li>[x] RefreshContext (auto-refresh toggle + interval)</li> <li>[x] DocsContext - DEFERRED (embedded docs not needed yet)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#24-custom-hooks-completed","title":"2.4 Custom Hooks - \u2705 COMPLETED","text":"<ul> <li>[x] <code>useAutoRefresh</code> - Auto-refresh logic with RefreshContext integration and sliding time window</li> <li>[x] <code>useQuery</code> - Re-export of QueryContext hook</li> <li>[x] <code>useDebounce</code> - Debounce values for search inputs (500ms default)</li> <li>[x] <code>useLocalStorage</code> - Type-safe localStorage persistence with cross-tab sync</li> <li>[x] <code>usePagination</code> - DEFERRED (API handles pagination internally)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-3-query-builder-component-week-2-custom-implementation-not-using-library","title":"Phase 3: Query Builder Component (Week 2) - \u26a0\ufe0f CUSTOM IMPLEMENTATION (NOT USING LIBRARY)","text":"<p>STATUS: Custom implementation built, react-querybuilder installed but NOT used DECISION NEEDED: Refactor to use library OR remove dependency</p>"},{"location":"plans/react-ui-implementation-plan/#31-query-builder-core-custom-implementation","title":"3.1 Query Builder Core - \u2705 CUSTOM IMPLEMENTATION","text":"<ul> <li>[x] Custom QueryBuilder components (QueryBuilder.tsx, CompactQueryBuilder.tsx, EnhancedQueryBuilder.tsx)</li> <li>[x] OTLP field schemas defined for traces, spans, logs, metrics</li> <li>[ ] NOT using <code>react-querybuilder</code> library features (\u274c TECHNICAL DEBT)</li> <li>[x] Field schemas in FieldSchema interface</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#32-custom-operators-implemented","title":"3.2 Custom Operators - \u2705 IMPLEMENTED","text":"<ul> <li>[x] Operators: <code>eq</code>, <code>ne</code>, <code>gt</code>, <code>lt</code>, <code>gte</code>, <code>lte</code>, <code>contains</code>, <code>regex</code></li> <li>[x] Type-specific value inputs (string, number, enum, boolean)</li> <li>[x] Enum dropdowns for fields like span.kind, severity_text</li> <li>[x] DateTimePicker for custom time ranges</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#33-filter-presets-implemented","title":"3.3 Filter Presets - \u2705 IMPLEMENTED","text":"<ul> <li>[x] Save/load presets to localStorage via QueryContext</li> <li>[x] Time range quick filters (5m, 15m, 30m, 1h, 3h, 6h, 12h, 24h)</li> <li>[x] Delete presets functionality</li> <li>[x] Preset modal for saving with name/description</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#34-query-builder-ui-implemented","title":"3.4 Query Builder UI - \u2705 IMPLEMENTED","text":"<ul> <li>[x] Bootstrap styling throughout</li> <li>[x] Add/remove individual filters</li> <li>[ ] NO filter groups (AND/OR logic) - only flat filter list</li> <li>[ ] NO field autocomplete</li> <li>[x] Basic validation (empty field warnings)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-4-core-pages-traces-spans-week-3-completed","title":"Phase 4: Core Pages - Traces &amp; Spans (Week 3) - \u2705 COMPLETED","text":""},{"location":"plans/react-ui-implementation-plan/#41-traces-page-completed","title":"4.1 Traces Page - \u2705 COMPLETED","text":"<ul> <li>[x] <code>TracesPage.tsx</code> - Traces table with filters</li> <li>[x] Table-based UI (no separate TraceList/TraceCard components - simpler approach)</li> <li>[x] Query builder integration (EnhancedQueryBuilder)</li> <li>[x] Status code filter buttons - DEFERRED (can filter via query builder)</li> <li>[x] Export JSON functionality (DownloadButton component)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#42-trace-detail-view-completed","title":"4.2 Trace Detail View - \u2705 COMPLETED","text":"<ul> <li>[x] Waterfall shown in modal (no separate TraceDetail.tsx needed)</li> <li>[x] <code>TraceWaterfall.tsx</code> - Span timeline visualization with duration bars</li> <li>[x] <code>SpanDetail.tsx</code> - Span detail modal with attributes</li> <li>[x] <code>CorrelatedLogs.tsx</code> - Logs linked to trace/span IDs</li> <li>[x] Navigation: trace \u2192 spans \u2192 logs (clickable IDs throughout)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#43-spans-page-implemented","title":"4.3 Spans Page - \u2705 IMPLEMENTED","text":"<ul> <li>[x] <code>SpansPage.tsx</code> - Spans table with filters</li> <li>[x] Service filtering via query builder</li> <li>[x] Query builder for span attributes</li> <li>[x] Link to parent trace (clickable trace IDs)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-5-logs-metrics-pages-week-3-4-completed","title":"Phase 5: Logs &amp; Metrics Pages (Week 3-4) - \u2705 COMPLETED","text":""},{"location":"plans/react-ui-implementation-plan/#51-logs-page-completed","title":"5.1 Logs Page - \u2705 COMPLETED","text":"<ul> <li>[x] <code>LogsPage.tsx</code> - Logs list with expandable rows</li> <li>[x] Table-based UI (no separate LogCard component - simpler approach)</li> <li>[x] Trace correlation links (clickable trace IDs)</li> <li>[x] Severity filtering (ERROR, WARN, INFO, DEBUG) via query builder</li> <li>[x] Log body rendering with attribute fallback</li> <li>[x] UX Improvements:</li> <li>[x] Empty body detection (null, undefined, \"\", \"{}\")</li> <li>[x] Attribute fallback for empty bodies (shows first 2-3 attributes)</li> <li>[x] Column renamed from \"Message\" to \"Event Data\"</li> <li>[x] Expandable row details with full attributes and body</li> <li>[x] Deferred Features:</li> <li>Log streaming/tailing mode (live mode with auto-refresh provides similar UX)</li> <li>Custom log level badge colors (Bootstrap badges sufficient)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#52-metrics-page-completed","title":"5.2 Metrics Page - \u2705 COMPLETED","text":"<ul> <li>[x] <code>MetricsPage.tsx</code> - Metrics list with dense table layout</li> <li>[x] Metric overview with cardinality column</li> <li>[x] Metric detail modal with time-series chart</li> <li>[x] Cardinality explorer modal:</li> <li>[x] Label analysis with expandable attribute values</li> <li>[x] High-cardinality warnings (visual indicators)</li> <li>[x] Series count display</li> <li>[x] Raw series view (PromQL format)</li> <li>[x] Export functionality (Copy PromQL, Download JSON)</li> <li>[x] RED metrics display</li> <li>[x] Deferred Features:</li> <li>Recharts improvements (current Chart.js integration works well)</li> <li>Metric type filtering (can filter via query builder)</li> <li>Time aggregation (handled by backend)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-6-services-service-map-week-4-completed","title":"Phase 6: Services &amp; Service Map (Week 4) - \u2705 COMPLETED","text":""},{"location":"plans/react-ui-implementation-plan/#61-service-catalog-completed","title":"6.1 Service Catalog - \u2705 COMPLETED","text":"<ul> <li>[x] <code>ServiceCatalogPage.tsx</code> - Service list with RED metrics</li> <li>[x] Service cards with metrics display</li> <li>[x] Sortable table with inline charts</li> <li>[x] Inline metric charts (simplified view)</li> <li>[x] Navigate to service traces/spans via query builder</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#62-service-map-completed","title":"6.2 Service Map - \u2705 COMPLETED","text":"<ul> <li>[x] <code>ServiceMapPage.tsx</code> - Interactive service map page</li> <li>[x] <code>ServiceGraph.tsx</code> - React Cytoscape component</li> <li>[x] React Cytoscape integration</li> <li>[x] Interactive graph (zoom, pan, drag)</li> <li>[x] Zoom controls (in/out/fit/center)</li> <li>[x] Node types with color coding (Client, Server, Database, Messaging, External)</li> <li>[x] Edge labels showing call counts</li> <li>[x] Edge thickness based on traffic volume</li> <li>[x] Node selection with metrics popup</li> <li>[x] Layout switching (hierarchical/grid)</li> <li>[x] Real-time updates via auto-refresh</li> <li>[x] Node click shows service metrics (requests, errors, P50 latency)</li> <li>[x] NEW: OTEL semantic conventions for icon detection (db.system, messaging.system)</li> <li>[x] NEW: Local devicon fonts with Unicode characters (no CDN dependency)</li> <li>[x] NEW: Theme-compatible colors for light/dark mode</li> <li>[x] NEW: Removed borders, improved visual styling</li> <li>[x] NEW: PostgreSQL, MySQL, MongoDB, Redis, Kafka, RabbitMQ, Nginx icons</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-7-ui-polish-optimization-futureoptional-deferred","title":"Phase 7: UI Polish &amp; Optimization (Future/Optional) - \u23f8\ufe0f DEFERRED","text":""},{"location":"plans/react-ui-implementation-plan/#71-query-builder-space-optimization","title":"7.1 Query Builder Space Optimization","text":"<p>Status: Deferred - Not critical for MVP Goal: Reduce vertical space usage of EnhancedQueryBuilder component (~50% reduction target) Current State: Fully functional with all features (time range, filters, presets)</p> <p>Optimization tasks:</p> <ul> <li>[ ] Compact time range section (horizontal layout, smaller buttons)</li> <li>[ ] Reduce form control padding (use size=\"sm\" consistently)</li> <li>[ ] Collapse advanced filters by default with toggle</li> <li>[ ] Reduce card padding (py-3 \u2192 py-2)</li> <li>[ ] Make preset UI more compact (dropdown or smaller buttons)</li> <li>[ ] Consider collapsible sections for less-used features</li> </ul> <p>Important: Do NOT remove functionality during optimization. All features must remain:</p> <ul> <li>\u2705 Time range presets and custom date/time selection</li> <li>\u2705 Namespace and service filtering</li> <li>\u2705 Free text search</li> <li>\u2705 Advanced filters with add/remove</li> <li>\u2705 Saved presets with delete capability</li> <li>\u2705 Query reset and builder collapse</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-8-ai-agents-collector-config-embedded-docs-week-5-partially-started","title":"Phase 8: AI Agents &amp; Collector Config &amp; Embedded Docs (Week 5) - \ud83d\udd04 PARTIALLY STARTED","text":""},{"location":"plans/react-ui-implementation-plan/#81-ai-agents-page-basic-page-exists","title":"8.1 AI Agents Page - \ud83d\udd04 BASIC PAGE EXISTS","text":"<ul> <li>[x] <code>AIAgentsPage.tsx</code> - Basic page structure created</li> <li>[ ] LLM session list view - NOT IMPLEMENTED</li> <li>[ ] GenAI span visualization - NOT IMPLEMENTED</li> <li>[ ] Token tracking (input/output) - NOT IMPLEMENTED</li> <li>[ ] Cost estimation - NOT IMPLEMENTED</li> <li>[ ] Prompt/response viewer - NOT IMPLEMENTED</li> <li>[ ] Model filtering - NOT IMPLEMENTED</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#82-otel-collector-config-page-basic-page-exists","title":"8.2 OTel Collector Config Page - \ud83d\udd04 BASIC PAGE EXISTS","text":"<ul> <li>[x] <code>OtelConfigPage.tsx</code> - Basic page structure created</li> <li>[ ] OpAMP status display - NOT IMPLEMENTED</li> <li>[ ] Configuration viewer - NOT IMPLEMENTED</li> <li>[ ] Validation feedback - NOT IMPLEMENTED</li> <li>[ ] Apply changes UI - NOT IMPLEMENTED</li> <li>[ ] Collector templates - NOT IMPLEMENTED</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#83-embedded-documentation-not-started","title":"8.3 Embedded Documentation - \u274c NOT STARTED","text":""},{"location":"plans/react-ui-implementation-plan/#831-documentation-structure","title":"8.3.1 Documentation Structure","text":"<ul> <li>[ ] Convert existing docs to React components</li> <li>[ ] Markdown rendering with <code>react-markdown</code></li> <li>[ ] Code syntax highlighting</li> <li>[ ] In-app navigation</li> <li>[ ] Search functionality</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#832-context-sensitive-help","title":"8.3.2 Context-Sensitive Help","text":"<ul> <li>[ ] \"?\" icon on each page</li> <li>[ ] Popover with relevant docs</li> <li>[ ] Keyboard shortcuts (Ctrl+/)</li> <li>[ ] Tooltips on complex features</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#833-documentation-pages","title":"8.3.3 Documentation Pages","text":"<ul> <li>[ ] Quick Start guide</li> <li>[ ] Traces documentation</li> <li>[ ] Logs documentation</li> <li>[ ] Metrics documentation</li> <li>[ ] Query builder guide</li> <li>[ ] API reference (embedded OpenAPI)</li> <li>[ ] Troubleshooting</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#101-opentelemetry-browser-setup","title":"10.1 OpenTelemetry Browser Setup","text":"<ul> <li>[ ] Configure OpenTelemetry SDK in <code>telemetry.ts</code></li> <li>[ ] Auto-instrumentation for:</li> <li>Page loads and navigation</li> <li>User interactions (clicks, form submissions)</li> <li>Fetch/XHR API calls</li> <li>Phase 12: Performance &amp; Polish (Week 9)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#121-performance-optimization","title":"12.1 Performance Optimization","text":"<ul> <li>[ ] React.memo for expensive components</li> <li>[ ] Virtualization for large lists (react-window or TanStack Virtual)</li> <li>[ ] Query caching strategy with React Query</li> <li>[ ] Code splitting with React.lazy</li> <li>[ ] Bundle size optimization (tree-shaking, compression)</li> <li>[ ] Image optimization (lazy loading, WebP)</li> <li>[ ] Web Vitals monitoring with OpenTelemetry</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#122-accessibility","title":"12.2 Accessibility","text":"<ul> <li>[ ] Keyboard navigation (tab order, shortcuts)</li> <li>[ ] ARIA labels and roles</li> <li>[ ] Focus management (modals, drawers)</li> <li>[ ] Screen reader support</li> <li>[ ] Color contrast (WCAG AA)</li> <li>[ ] Reduced motion support</li> <li>[ ] Skip to main content link</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#123-polish","title":"12.3 Polish","text":"<ul> <li>[ ] Loading states (skeletons, spinners)</li> <li>[ ] 3.1 OpenTelemetry Collector for Browser Telemetry</li> <li>[ ] Create dedicated OTel Collector instance for UI telemetry</li> <li>[ ] Collector configuration:</li> <li>OTLP HTTP receiver on <code>/v1/traces</code>, <code>/v1/metrics</code>, <code>/v1/logs</code></li> <li>Batch processor</li> <li>Forward to main OTLP receiver</li> <li>CORS headers for browser access</li> <li>[ ] Deploy as separate service: <code>ollyscale-ui-collector</code></li> <li>[ ] Helm chart updates:</li> <li>Add <code>uiCollector</code> section to <code>values.yaml</code></li> <li>Deployment manifest for UI collector</li> <li>Service manifest (ClusterIP)</li> <li>HTTPRoute for <code>/api/v1/otlp/*</code> (browser access)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#132-kubernetes-httproute-for-browser-telemetry","title":"13.2 Kubernetes HTTPRoute for Browser Telemetry","text":"<ul> <li>[ ] Create HTTPRoute in Helm chart:</li> </ul> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: ollyscale-ui-telemetry\n  namespace: ollyscale\nspec:\n  parentRefs:\n    - name: ollyscale-gateway\n      namespace: ollyscale\n  hostnames:\n    - \"ollyscale.test\"\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api/v1/otlp\n      backendRefs:\n        # OTel Operator creates service with format: {name}-collector\n        - name: ollyscale-ui-collector-collector\n          port: 4318\n      filters:\n        - type: ResponseHeaderModifier\n          responseHeaderModifier:\n            add:\n              - name: Access-Control-Allow-Origin\n                value: \"https://ollyscale.test\"\n              - name: Access-Control-Allow-Methods\n                value: \"POST, OPTIONS\"\n              - name: Access-Control-Allow-Headers\n                value: \"Content-Type, Authorization\"\n</code></pre> <ul> <li>[ ] CORS already handled by collector config (belt-and-suspenders approach)</li> <li>[ ] Rate limiting handled by collector's <code>memory_limiter</code> processor</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#133-docker-build","title":"13.3 Docker Build","text":"<ul> <li>[ ] Update <code>Dockerfile</code> for React build</li> <li>[ ] Multi-stage build:</li> <li>Build stage: Node.js + npm build</li> <li>Runtime stage: nginx + static files</li> <li>[ ] Environment variable injection at runtime (not build time)</li> <li>[ ] Health check endpoint</li> <li>[ ] Non-root user</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#134-helm-chart-updates","title":"13.4 Helm Chart Updates","text":"<ul> <li>[ ] Update <code>charts/ollyscale/</code> to use new UI image</li> <li>[ ] Add UI collector deployment and service</li> <li>[ ] Add HTTPRoute for UI telemetry</li> <li>[ ] ConfigMap for nginx configuration</li> <li>[ ] ConfigMap for i18n translations (if external)</li> <li>[ ] Update image references in <code>values.yaml</code></li> </ul>"},{"location":"plans/react-ui-implementation-plan/#135-documentation-update","title":"13.5 Documentation Update","text":"<ul> <li>[ ] Update README with new UI screenshots</li> <li>[ ] Document query builder usage</li> <li>[ ] Document i18n/localization</li> <li>[ ] Document browser telemetry setup</li> <li>[ ] Migration guide from old UI</li> <li>[ ] Architecture diagrams (Mermaid)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#136-cicd-pipeline-updates","title":"13.6 CI/CD Pipeline Updates","text":"<ul> <li>[ ] Update <code>.github/workflows/</code> for React app:</li> <li>Build workflow (npm build, TypeScript check)</li> <li>Test workflow (Vitest unit, RTL component, Playwright E2E)</li> <li>Lint workflow (ESLint, Prettier)</li> <li>Docker build workflow (multi-arch: amd64, arm64)</li> <li>Release workflow (version bump, changelog, publish images)</li> <li>[ ] Add workflow for dependency updates (Renovate/Dependabot)</li> <li>[ ] Add workflow for bundle size monitoring</li> <li>[ ] Add workflow for accessibility testing (axe-core)</li> <li>[ ] Add workflow for lighthouse CI (performance)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#137-performance-budgets-monitoring","title":"13.7 Performance Budgets &amp; Monitoring","text":"<ul> <li>[ ] Define performance budgets:</li> <li>Initial bundle size: &lt; 500 KB gzipped</li> <li>Time to Interactive (TTI): &lt; 3s on 3G</li> <li>First Contentful Paint (FCP): &lt; 1.5s</li> <li>Largest Contentful Paint (LCP): &lt; 2.5s</li> <li>Cumulative Layout Shift (CLS): &lt; 0.1</li> <li>[ ] Add bundle analyzer (rollup-plugin-visualizer)</li> <li>[ ] Add performance monitoring with Web Vitals</li> <li>[ ] Set up alerts for performance regressions</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#138-migration-strategy","title":"13.8 Migration Strategy","text":"<ul> <li>[ ] Phase 1: Deploy new UI at <code>/beta</code> path (parallel to old UI)</li> <li>[ ] Phase 2: Beta testing with selected users (2 weeks)</li> <li>[ ] Phase 3: Add feature flag to switch between UIs</li> <li>[ ] Phase 4: Make new UI default (old UI at <code>/legacy</code>)</li> <li>[ ] Phase 5: Deprecation notice for old UI (4 weeks)</li> <li>[ ] Phase 6: Remove old UI completely</li> <li>[ ] Document migration process for users</li> <li>[ ] Provide feedback mechanism during beta</li> <li>[ ] Track adoption metrics (which UI users choose)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#139-cleanup","title":"13.9 Cleanup","text":"<ul> <li>[ ] Remove <code>apps/ollyscale-ui/</code> (old UI) - ONLY AFTER Phase 6</li> <li>[ ] Update build scripts in <code>scripts/build/</code></li> <li>[ ] Update CI/CD pipelines (.github/workflows)</li> <li>[ ] Remove TinyOlly legacy code references</li> <li>[ ] Update <code>release-please-config.json</code></li> <li>[ ] Archive old UI documentation, OTLP helpers</li> <li>[ ] Test API client: request/response handling, errors</li> <li>[ ] Test contexts: theme, namespace, refresh, language</li> <li>[ ] Coverage target: 80%+</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#112-component-tests-react-testing-library","title":"11.2 Component Tests (React Testing Library)","text":"<ul> <li>[ ] Test common components: buttons, badges, cards, modals</li> <li>[ ] Test query builder: filter add/remove, operators, validation</li> <li>[ ] Test telemetry cards: TraceCard, SpanCard, LogCard, MetricCard</li> <li>[ ] Test pages: rendering, loading states, error states</li> <li>[ ] User interaction tests with <code>@testing-library/user-event</code></li> <li>[ ] Accessibility tests (keyboard nav, ARIA)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#113-integration-tests-msw","title":"11.3 Integration Tests (MSW)","text":"<ul> <li>[ ] Mock API endpoints with MSW</li> <li>[ ] Test complete user flows:</li> <li>Search traces \u2192 view detail \u2192 see logs</li> <li>Apply filters \u2192 see results</li> <li>Auto-refresh \u2192 data updates</li> <li>Change language \u2192 UI updates</li> <li>[ ] Test error scenarios: 404, 500, network errors</li> <li>[ ] Test pagination and infinite scroll</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#114-e2e-tests-playwright","title":"11.4 E2E Tests (Playwright)","text":"<ul> <li>[ ] Critical user paths:</li> <li>Navigate tabs</li> <li>Apply query builder filters</li> <li>View trace waterfall</li> <li>Check service map</li> <li>Change theme/language</li> <li>[ ] Cross-browser testing (Chrome, Firefox, Safari)</li> <li>[ ] Visual regression tests (screenshots)</li> <li>[ ] Performance tests (Lighthouse</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-8-ai-agents-collector-config-embedded-docs-week-5-partially-started_1","title":"Phase 8: AI Agents &amp; Collector Config &amp; Embedded Docs (Week 5) - \ud83d\udd04 PARTIALLY STARTED","text":""},{"location":"plans/react-ui-implementation-plan/#81-ai-agents-page-basic-page-exists_1","title":"8.1 AI Agents Page - \ud83d\udd04 BASIC PAGE EXISTS","text":"<ul> <li>[x] <code>AIAgentsPage.tsx</code> - Basic page structure created</li> <li>[ ] LLM session list view - NOT IMPLEMENTED</li> <li>[ ] GenAI span visualization - NOT IMPLEMENTED</li> <li>[ ] Token tracking (input/output) - NOT IMPLEMENTED</li> <li>[ ] Cost estimation - NOT IMPLEMENTED</li> <li>[ ] Prompt/response viewer - NOT IMPLEMENTED</li> <li>[ ] Model filtering - NOT IMPLEMENTED</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#82-otel-collector-config-page-basic-page-exists_1","title":"8.2 OTel Collector Config Page - \ud83d\udd04 BASIC PAGE EXISTS","text":"<ul> <li>[x] <code>OtelConfigPage.tsx</code> - Basic page structure created</li> <li>[ ] OpAMP status display - NOT IMPLEMENTED</li> <li>[ ] Configuration viewer - NOT IMPLEMENTED</li> <li>[ ] Validation feedback - NOT IMPLEMENTED</li> <li>[ ] Apply changes UI - NOT IMPLEMENTED</li> <li>[ ] Collector templates - NOT IMPLEMENTED</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#83-embedded-documentation-not-started_1","title":"8.3 Embedded Documentation - \u274c NOT STARTED","text":""},{"location":"plans/react-ui-implementation-plan/#831-documentation-structure_1","title":"8.3.1 Documentation Structure","text":"<ul> <li>[ ] Convert existing docs to React components</li> <li>[ ] Markdown rendering with <code>react-markdown</code></li> <li>[ ] Code syntax highlighting</li> <li>[ ] In-app navigation</li> <li>[ ] Search functionality</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#832-context-sensitive-help_1","title":"8.3.2 Context-Sensitive Help","text":"<ul> <li>[ ] \"?\" icon on each page</li> <li>[ ] Popover with relevant docs</li> <li>[ ] Keyboard shortcuts (Ctrl+/)</li> <li>[ ] Tooltips on complex features</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#833-documentation-pages_1","title":"8.3.3 Documentation Pages","text":"<ul> <li>[ ] Quick Start guide</li> <li>[ ] Traces documentation</li> <li>[ ] Logs documentation</li> <li>[ ] Metrics documentation</li> <li>[ ] Query builder guide</li> <li>[ ] API reference (embedded OpenAPI)</li> <li>[ ] Troubleshooting</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-9-auto-refresh-controls-week-6-completed","title":"Phase 9: Auto-Refresh &amp; Controls (Week 6) - \u2705 COMPLETED","text":""},{"location":"plans/react-ui-implementation-plan/#91-auto-refresh-logic-completed","title":"9.1 Auto-Refresh Logic - \u2705 COMPLETED","text":"<ul> <li>[x] <code>useAutoRefresh</code> hook - Implemented in apps/web-ui/src/hooks/useAutoRefresh.ts</li> <li>[x] Toggle button in EnhancedQueryBuilder - LIVE/PAUSED button with icons</li> <li>[x] Configurable interval (5s default) - Hardcoded to 5s in useAutoRefresh hook</li> <li>[x] Sliding time window - When LIVE mode enabled, time range updates on each refresh</li> <li>[x] Auto-disable live mode when user manually adjusts time - Prevents unexpected behavior</li> <li>[x] LocalStorage persistence - Live mode state persists across page reloads</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#92-global-controls-partially-completed","title":"9.2 Global Controls - \u2705 PARTIALLY COMPLETED","text":"<ul> <li>[x] Time range selector (last N minutes) - 5/15/30/60 minute buttons with LIVE mode integration</li> <li>[x] Time range presets highlight when active - Visual feedback for selected relative window</li> <li>[x] Timezone display on all timestamps - Shows \"UTC\" or local timezone abbreviation</li> <li>[x] Manual time range picker - DateTimePicker for custom start/end selection</li> <li>[ ] Namespace filter dropdown (multi-select) - Exists but not multi-select</li> <li>[ ] Theme toggle (dark/light) - Not yet implemented</li> <li>[ ] Refresh button (manual) - Exists in query builder (via refetch)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-10-testing-i18n-week-7-partially-started","title":"Phase 10: Testing &amp; i18n (Week 7) - \ud83d\udd04 PARTIALLY STARTED","text":""},{"location":"plans/react-ui-implementation-plan/#101-testing-infrastructure-setup-complete-tests-needed","title":"10.1 Testing Infrastructure - \u2705 SETUP COMPLETE, \ud83d\udd04 TESTS NEEDED","text":"<p>Status: Testing libraries installed, vitest configured, 1 test file exists (useDebounce.test.ts)</p> <p>\u2705 Completed:</p> <ul> <li>[x] Install Vitest@4.0.18, @vitest/ui</li> <li>[x] Install React Testing Library (@testing-library/react@16.3.2, jest-dom@6.9.1, user-event@14.6.1)</li> <li>[x] Configure vitest.config.ts</li> <li>[x] Add test scripts to package.json (test, test:watch, test:coverage, test:ui)</li> <li>[x] First test written: useDebounce.test.ts (4 test cases)</li> </ul> <p>\ud83d\udd04 Tests Needed (\u23f1\ufe0f 3-4 days for comprehensive coverage):</p> <ul> <li>[ ] Install MSW@2.x for API mocking (not yet installed)</li> <li>[ ] Create test setup file (src/test/setup.ts)</li> <li>[ ] Unit tests for hooks: useAutoRefresh, useLocalStorage, useTracing, useQuery</li> <li>[ ] Unit tests for utilities: dateUtils, formatters, validators</li> <li>[ ] Component tests with React Testing Library:</li> <li>[ ] Common components (buttons, badges, cards, modals)</li> <li>[ ] Query builder components</li> <li>[ ] Page components (rendering, loading, error states)</li> <li>[ ] API client tests with MSW</li> <li>[ ] Context tests (ThemeContext, QueryContext, RefreshContext)</li> <li>[ ] E2E tests with Playwright (optional)</li> </ul> <p>Coverage Goal: 80%+ code coverage</p>"},{"location":"plans/react-ui-implementation-plan/#102-browser-telemetry-complete-basic-enhancements-needed","title":"10.2 Browser Telemetry - \u2705 COMPLETE (Basic), \ud83d\udd04 ENHANCEMENTS NEEDED","text":"<p>Status: Core implementation complete with automatic traces, needs error handling enhancements</p> <p>\u2705 Completed (2026-01-30):</p> <ul> <li>[x] Install @opentelemetry/api, sdk-trace-web</li> <li>[x] Install auto-instrumentation packages (auto-instrumentations-web meta-package)</li> <li>[x] Install OTLP exporter (exporter-trace-otlp-http)</li> <li>[x] Create src/telemetry/ configuration files:</li> <li>[x] config.ts - Provider, exporter, consent checking</li> <li>[x] instrumentations.ts - Auto-instrumentations for document-load, user-interaction, fetch, XHR</li> <li>[x] GDPR consent banner component (ConsentBanner.tsx)</li> <li>[x] Telemetry opt-in/opt-out mechanism (localStorage-based)</li> <li>[x] OpenTelemetryCollector CR deployed (ollyscale-browser-collector)</li> <li>[x] HTTPRoute configured for /v1/traces with CORS</li> <li>[x] useTracing hook with startSpan, recordError, addEvent helpers</li> </ul> <p>Browser Telemetry Captures (Auto-instrumented):</p> <ul> <li>\u2705 Page load performance metrics (document-load instrumentation)</li> <li>\u2705 User interactions (clicks, form submits, keypresses)</li> <li>\u2705 API call tracing with trace propagation (fetch/XHR)</li> <li>\u2705 Resource attributes (service.name: ollyscale-web-ui, service.version, deployment.environment)</li> </ul> <p>\ud83d\udd04 Needed Enhancements (\u23f1\ufe0f 1 day):</p> <ul> <li>[ ] Global error handler for unhandled exceptions (<code>window.onerror</code>)</li> <li>[ ] Global promise rejection handler (<code>window.onunhandledrejection</code>)</li> <li>[ ] ErrorBoundary component to catch React errors</li> <li>[ ] Custom events for business logic (button clicks, filter changes, etc.)</li> <li>[ ] Error sampling strategy (100% errors, 10% success)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#103-internationalization-complete-2026-02-01","title":"10.3 Internationalization - \u2705 COMPLETE (2026-02-01)","text":"<p>Status: Fully implemented with 287 translation keys across 16 namespaces</p> <ul> <li>[x] Install react-i18next, i18next, i18next-browser-languagedetector</li> <li>[x] Create src/i18n/config.ts configuration with LanguageDetector</li> <li>[x] Create src/i18n/locales/en-US/translation.json (287 keys)</li> <li>[x] Create src/i18n/locales/en-GB/translation.json (UK spelling variants)</li> <li>[x] Import i18n config in main.tsx before App render</li> <li>[x] Replace hardcoded strings with t() function (all pages, sidebar, common components)</li> <li>[x] LanguageSelector component with flag dropdowns (\ud83c\uddfa\ud83c\uddf8/\ud83c\uddec\ud83c\udde7)</li> <li>[x] Language persistence via localStorage</li> <li>[x] Date format localization (US: MM/DD/YYYY vs GB: DD/MM/YYYY)</li> </ul> <p>Translation Namespaces: app, nav, sidebar, common, query, dashboard, traces, spans, logs, metrics, services, serviceMap, aiAgents, otelConfig, consent, theme, errors, dateTime</p> <p>Commit: 1a166f2 - feat(web-ui): implement internationalization (i18n) support</p>"},{"location":"plans/react-ui-implementation-plan/#104-performance-optimization-basic-implementation","title":"10.4 Performance Optimization - \ud83d\udd04 BASIC IMPLEMENTATION","text":"<ul> <li>[x] Basic React Query caching (enabled by default)</li> <li>[ ] React.memo for expensive components</li> <li>[ ] Virtualization for large lists (react-window)</li> <li>[ ] Code splitting with React.lazy</li> <li>[ ] Bundle size optimization</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#105-accessibility-not-started","title":"10.5 Accessibility - \u274c NOT STARTED","text":"<ul> <li>[ ] Keyboard navigation</li> <li>[ ] ARIA labels</li> <li>[ ] Focus management</li> <li>[ ] Screen reader support</li> <li>[ ] Color contrast audit (WCAG AA)</li> <li>[ ] Reduced motion support</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#106-pwa-polish-partially-implemented","title":"10.6 PWA &amp; Polish - \ud83d\udd04 PARTIALLY IMPLEMENTED","text":"<ul> <li>[x] vite-plugin-pwa installed</li> <li>[ ] PWA manifest configuration</li> <li>[ ] Service worker registration</li> <li>[ ] App icons (192x192, 512x512)</li> <li>[ ] Install prompt testing</li> <li>[x] LoadingSpinner component exists</li> <li>[x] EmptyState component exists</li> <li>[ ] Error states with ErrorBoundary</li> <li>[ ] Animations/transitions</li> <li>[x] Responsive design (mobile-friendly)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#107-gdpr-compliance-not-started","title":"10.7 GDPR Compliance - \u274c NOT STARTED","text":"<ul> <li>[ ] ConsentBanner.tsx component</li> <li>[ ] Telemetry opt-in/opt-out UI</li> <li>[ ] Store consent in localStorage</li> <li>[ ] Respect consent in telemetry init</li> <li>[ ] Privacy policy link in footer</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#phase-11-infrastructure-deployment-week-8-partially-complete","title":"Phase 11: Infrastructure &amp; Deployment (Week 8) - \ud83d\udd04 PARTIALLY COMPLETE","text":""},{"location":"plans/react-ui-implementation-plan/#111-docker-build-completed","title":"11.1 Docker Build - \u2705 COMPLETED","text":"<ul> <li>[x] Multi-stage Dockerfile (Node build + nginx serve)</li> <li>[x] Non-root user</li> <li>[x] Static assets copied correctly</li> <li>[ ] Environment variable injection at runtime (currently build-time)</li> <li>[x] Health check endpoint (nginx default)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#112-helm-chart-deployed","title":"11.2 Helm Chart - \u2705 DEPLOYED","text":"<ul> <li>[x] <code>charts/ollyscale/</code> exists and deployed</li> <li>[x] web-ui deployment configured</li> <li>[x] HTTPRoute for web UI</li> <li>[x] Service created</li> <li>[x] Image references in values.yaml</li> <li>[ ] OpenTelemetryCollector CR for UI telemetry - NOT CREATED</li> <li>[ ] HTTPRoute for /api/v1/otlp/* - NOT CREATED</li> <li>[ ] ConfigMap for i18n translations - NOT NEEDED YET</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#113-cicd-pipeline-updates-not-started","title":"11.3 CI/CD Pipeline Updates - \u274c NOT STARTED","text":"<ul> <li>[ ] Test workflow (Vitest unit, RTL component, Playwright E2E)</li> <li>[ ] Lint workflow improvements</li> <li>[ ] Bundle size monitoring</li> <li>[ ] Accessibility testing (axe-core)</li> <li>[ ] Lighthouse CI</li> <li>[x] Docker build workflow exists (builds on push)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#114-documentation-updates-partially-done","title":"11.4 Documentation Updates - \ud83d\udd04 PARTIALLY DONE","text":"<ul> <li>[ ] Update README with new UI screenshots</li> <li>[ ] Document query builder usage</li> <li>[ ] Document i18n/localization (when implemented)</li> <li>[ ] Document browser telemetry setup (when implemented)</li> <li>[ ] Migration guide from old UI</li> <li>[x] Implementation plan exists</li> <li>[x] Status report created</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#115-migration-strategy-not-planned-yet","title":"11.5 Migration Strategy - \u274c NOT PLANNED YET","text":"<ul> <li>[ ] Decide: parallel deployment or full switch</li> <li>[ ] If parallel: HTTPRoute configuration for /beta path</li> <li>[ ] Beta testing period duration</li> <li>[ ] Rollback plan</li> <li>[ ] Old UI removal timeline</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#query-builder-design","title":"Query Builder Design","text":""},{"location":"plans/react-ui-implementation-plan/#filter-structure","title":"Filter Structure","text":"<pre><code>interface Filter {\n  field: string;      // e.g., \"service.name\", \"http.status_code\"\n  operator: string;   // eq, ne, gt, lt, gte, lte, contains, regex\n  value: any;         // string, number, boolean, etc.\n}\n\ninterface FilterGroup {\n  combinator: 'AND' | 'OR';\n  filters: (Filter | FilterGroup)[];\n}\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#example-query-builder-ui","title":"Example Query Builder UI","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Query Builder                                    [Save] [Clear]\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [AND \u25bc]                                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 service.name    [equals \u25bc]  demo-frontend    [-]    \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 http.status_code [gte \u25bc]    400                [-]   \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502   [+ Add Filter]                                           \u2502\n\u2502                                                              \u2502\n\u2502 [Apply Filter]                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#otlp-field-schema","title":"OTLP Field Schema","text":""},{"location":"plans/react-ui-implementation-plan/#tracespan-fields","title":"Trace/Span Fields","text":"<ul> <li><code>trace_id</code> (string)</li> <li><code>span_id</code> (string)</li> <li><code>service.name</code> (string)</li> <li><code>service.namespace</code> (string)</li> <li><code>span.kind</code> (enum: INTERNAL, SERVER, CLIENT, PRODUCER, CONSUMER)</li> <li><code>http.method</code> (enum: GET, POST, PUT, DELETE, PATCH)</li> <li><code>http.status_code</code> (number)</li> <li><code>http.route</code> (string)</li> <li><code>duration_seconds</code> (number)</li> <li><code>status.code</code> (enum: UNSET, OK, ERROR)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#log-fields","title":"Log Fields","text":"<ul> <li><code>severity_text</code> (enum: DEBUG, INFO, WARN, ERROR, FATAL)</li> <li><code>severity_number</code> (number: 0-24)</li> <li><code>body</code> (string or structured)</li> <li><code>trace_id</code> (string)</li> <li><code>span_id</code> (string)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#metric-fields","title":"Metric Fields","text":"<ul> <li><code>metric.name</code> (string)</li> <li><code>metric.type</code> (enum: Gauge, Counter, Histogram, Summary)</li> <li><code>attributes.*</code> (dynaBrowser telemetry + i18n + themes | | Phase 11 | 1 week | Testing &amp; quality | | Phase 12 | 1 week | Performance &amp; polish | | Phase 13 | 0.5 weeks | Infrastructure &amp; deployment | | Total | **13 Customization</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#color-palette","title":"Color Palette","text":"<pre><code>// apps/react-ui/src/styles/variables.scss\n\n// Primary colors\n$primary: #0d6efd;\n$secondary: #6c757d;\n$success: #198754;\n$danger: #dc3545;\n$warning: #ffc107;\n$info: #0dcaf0;\n\n// Dark theme\n$dark-bg: #1a1a1a;\n$dark-surface: #2d2d2d;\n$dark-border: #404040;\n$dark-text: #e0e0e0;\n\n// Light theme\n$light-bg: #ffffff;\n$light-surface: #f8f9fa;\n$light-border: #dee2e6;\n$light-text: #212529;\n\n// Trace status colors\n$status-ok: #10b981;\n$status-error: #ef4444;\n$status-unset: #6b7280;\n</code></pre> <p>Browser Telemetry Architecture</p>"},{"location":"plans/react-ui-implementation-plan/#opentelemetry-collector-for-ui-telemetry","title":"OpenTelemetry Collector for UI Telemetry","text":"<pre><code>Browser (React App)\n  \u2502\n  \u2502 OTLP/HTTP (fetch)\n  \u2502 /api/v1/otlp/v1/traces\n  \u2502 /api/v1/otlp/v1/metrics\n  \u2502\n  \u2193\nEnvoy Gateway (HTTPRoute)\n  \u2502\n  \u2193\nollyscale-ui-collector:4318 (OTLP HTTP)\n  \u2502\n  \u2502 processors: batch, resource\n  \u2502\n  \u2193\nollyscale-otlp-receiver:4343 (main ingestion)\n  \u2502\n  \u2193\nRedis Storage\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#telemetry-configuration-telemetryts","title":"Telemetry Configuration (<code>telemetry.ts</code>)","text":"<pre><code>import { WebTracerProvider } from '@opentelemetry/sdk-trace-web';\nimport { Resource } from '@opentelemetry/resources';\nimport { SEMRESATTRS_SERVICE_NAME, SEMRESATTRS_SERVICE_VERSION, SEMRESATTRS_SERVICE_NAMESPACE } from '@opentelemetry/semantic-conventions';\nimport { OTLPTraceExporter } from '@opentelemetry/exporter-trace-otlp-http';\nimport { BatchSpanProcessor } from '@opentelemetry/sdk-trace-base';\nimport { registerInstrumentations } from '@opentelemetry/instrumentation';\nimport { DocumentLoadInstrumentation } from '@opentelemetry/instrumentation-document-load';\nimport { UserInteractionInstrumentation } from '@opentelemetry/instrumentation-user-interaction';\nimport { FetchInstrumentation } from '@opentelemetry/instrumentation-fetch';\nimport { XMLHttpRequestInstrumentation } from '@opentelemetry/instrumentation-xml-http-request';\nimport { ZoneContextManager } from '@opentelemetry/context-zone';\n\nexport function initTelemetry() {\n  // Check if user has consented (GDPR compliance)\n  const telemetryEnabled = localStorage.getItem('ollyscale-telemetry-consent') !== 'false';\n  if (!telemetryEnabled) {\n    console.info('Browser telemetry disabled by user preference');\n    return;\n  }\n\n  const provider = new WebTracerProvider({\n    resource: new Resource({\n      [SEMRESATTRS_SERVICE_NAME]: 'ollyscale-ui',\n      [SEMRESATTRS_SERVICE_VERSION]: import.meta.env.VITE_APP_VERSION || 'dev',\n      [SEMRESATTRS_SERVICE_NAMESPACE]: 'ollyscale',\n      'deployment.environment': import.meta.env.MODE || 'production',\n    }),\n  });\n\n  // Export to dedicated UI collector via Gateway HTTPRoute\n  const exporter = new OTLPTraceExporter({\n    url: '/api/v1/otlp/v1/traces',\n    headers: {\n      // Could add auth token here if needed\n    },\n  });\n\n  provider.addSpanProcessor(new BatchSpanProcessor(exporter, {\n    maxQueueSize: 100,\n    maxExportBatchSize: 10,\n    scheduledDelayMillis: 5000,\n  }));\n\n  // Use ZoneContextManager for better async context propagation\n  provider.register({\n    contextManager: new ZoneContextManager(),\n  });\n\n  // Auto-instrumentation\n  registerInstrumentations({\n    instrumentations: [\n      new DocumentLoadInstrumentation(),\n      new UserInteractionInstrumentation({\n        eventNames: ['click', 'submit'],\n        shouldPreventSpanCreation: (eventType, element, span) =&gt; {\n          // Don't create spans for auto-refresh background activity\n          if (element.id === 'auto-refresh-btn') return true;\n          return false;\n        },\n      }),\n      new FetchInstrumentation({\n        propagateTraceHeaderCorsUrls: [/.*/],\n        clearTimingResources: true,\n        ignoreUrls: [/api\\/v1\\/otlp/], // Don't trace telemetry exports\n        applyCustomAttributesOnSpan: (span, request, result) =&gt; {\n          // Add custom attributes for API calls\n          if (request.url.includes('/api/')) {\n            span.setAttribute('http.url', request.url);\n            if (result instanceof Response) {\n              span.setAttribute('http.status_code', result.status);\n            }\n          }\n        },\n      }),\n      new XMLHttpRequestInstrumentation({\n        propagateTraceHeaderCorsUrls: [/.*/],\n        ignoreUrls: [/api\\/v1\\/otlp/],\n      }),\n    ],\n  });\n\n  console.info('OpenTelemetry browser instrumentation initialized');\n}\n\n// Call from main.tsx after user consent check\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#captured-browser-telemetry","title":"Captured Browser Telemetry","text":"<ol> <li>Page Load Spans</li> <li>DNS lookup time</li> <li>Connection time</li> <li>Request/response time</li> <li>DOM interactive, complete</li> <li> <p>First paint, contentful paint</p> </li> <li> <p>Navigation Spans</p> </li> <li>Route changes (React Router)</li> <li> <p>Component mount/unmount</p> </li> <li> <p>User Interaction Spans</p> </li> <li>Button clicks</li> <li>Form submissions</li> <li> <p>Query builder interactions</p> </li> <li> <p>API Call Spans</p> </li> <li>Fetch requests to <code>/api/*</code></li> <li>Request/response times</li> <li> <p>Status codes, errors</p> </li> <li> <p>Error Spans</p> </li> <li>JavaScript errors</li> <li>React error boundaries</li> <li>API errors</li> </ol>"},{"location":"plans/react-ui-implementation-plan/#internationalization-i18n-implementation","title":"Internationalization (i18n) Implementation","text":""},{"location":"plans/react-ui-implementation-plan/#translation-file-structure","title":"Translation File Structure","text":"<pre><code>// locales/en-US/translation.json (US English)\n{\n  \"nav\": {\n    \"traces\": \"Traces\",\n    \"logs\": \"Logs\",\n    \"metrics\": \"Metrics\",\n    \"serviceMap\": \"Service Map\",\n    \"serviceCatalog\": \"Service Catalog\",\n    \"aiAgents\": \"AI Agents\",\n    \"collectorConfig\": \"OTel Config\",\n    \"docs\": \"Documentation\"\n  },\n  \"actions\": {\n    \"search\": \"Search\",\n    \"filter\": \"Filter\",\n    \"clear\": \"Clear\",\n    \"apply\": \"Apply\",\n    \"export\": \"Export\",\n    \"copy\": \"Copy\",\n    \"download\": \"Download\",\n    \"refresh\": \"Refresh\"\n  },\n  \"queryBuilder\": {\n    \"addFilter\": \"Add Filter\",\n    \"addGroup\": \"Add Group\",\n    \"field\": \"Field\",\n    \"operator\": \"Operator\",\n    \"value\": \"Value\",\n    \"operators\": {\n      \"eq\": \"Equals\",\n      \"ne\": \"Not Equals\",\n      \"gt\": \"Greater Than\",\n      \"lt\": \"Less Than\",\n      \"gte\": \"Greater Than or Equal\",\n      \"lte\": \"Less Than or Equal\",\n      \"contains\": \"Contains\",\n      \"regex\": \"Regex Match\"\n    }\n  },\n  \"telemetry\": {\n    \"traces\": {\n      \"title\": \"Traces\",\n      \"traceId\": \"Trace ID\",\n      \"duration\": \"Duration\",\n      \"spans\": \"Spans\",\n      \"status\": \"Status\"\n    }\n  }\n}\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#usage-in-components","title":"Usage in Components","text":"<pre><code>import { useTranslation } from 'react-i18next';\n\nexport function TracesPage() {\n  const { t } = useTranslation();\n\n  return (\n    &lt;div&gt;\n      &lt;h1&gt;{t('telemetry.traces.title')}&lt;/h1&gt;\n      &lt;button&gt;{t('actions.refresh')}&lt;/button&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#language-selector","title":"Language Selector","text":"<pre><code>import { useTranslation } from 'react-i18next';\n\nexport function LanguageSelector() {\n  const { i18n } = useTranslation();\n\n  const languages = [\n    { code: 'en-US', name: 'English (US)' },\n    { code: 'en-GB', name: 'English (UK)' },\n    // Future expansion ready\n    // { code: 'es', name: 'Espa\u00f1ol' },\n    // { code: 'fr', name: 'Fran\u00e7ais' },\n    // { code: 'de', name: 'Deutsch' },\n    // { code: 'ja', name: '\u65e5\u672c\u8a9e' },\n  ];\n\n  return (\n    &lt;Dropdown&gt;\n      &lt;Dropdown.Toggle&gt;\n        {languages.find(l =&gt; l.code === i18n.language)?.name}\n      &lt;/Dropdown.Toggle&gt;\n      &lt;Dropdown.Menu&gt;\n        {languages.map(lang =&gt; (\n          &lt;Dropdown.Item\n            key={lang.code}\n            onClick={() =&gt; i18n.changeLanguage(lang.code)}\n          &gt;\n            {lang.name}\n          &lt;/Dropdown.Item&gt;\n        ))}\n      &lt;/Dropdown.Menu&gt;\n    &lt;/Dropdown&gt;\n  );\n}\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#theme-system","title":"Theme System","text":""},{"location":"plans/react-ui-implementation-plan/#theme-context-with-system-preference","title":"Theme Context with System Preference","text":"<pre><code>import { createContext, useContext, useEffect, useState } from 'react';\n\ntype Theme = 'light' | 'dark' | 'auto';\n\ninterface ThemeContextType {\n  theme: Theme;\n  effectiveTheme: 'light' | 'dark';\n  setTheme: (theme: Theme) =&gt; void;\n}\n\nconst ThemeContext = createContext&lt;ThemeContextType | undefined&gt;(undefined);\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setThemeState] = useState&lt;Theme&gt;(() =&gt; {\n    return (localStorage.getItem('ollyscale-theme') as Theme) || 'auto';\n  });\n\n  const [effectiveTheme, setEffectiveTheme] = useState&lt;'light' | 'dark'&gt;('light');\n\n  useEffect(() =&gt; {\n    if (theme === 'auto') {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      setEffectiveTheme(mediaQuery.matches ? 'dark' : 'light');\n\n      const handler = (e: MediaQueryListEvent) =&gt; {\n        setEffectiveTheme(e.matches ? 'dark' : 'light');\n      };\n      mediaQuery.addEventListener('change', handler);\n      return () =&gt; mediaQuery.removeEventListener('change', handler);\n    } else {\n      setEffectiveTheme(theme);\n    }\n  }, [theme]);\n\n  useEffect(() =&gt; {\n    document.documentElement.setAttribute('data-bs-theme', effectiveTheme);\n  }, [effectiveTheme]);\n\n  const setTheme = (newTheme: Theme) =&gt; {\n    setThemeState(newTheme);\n    localStorage.setItem('ollyscale-theme', newTheme);\n  };\n\n  return (\n    &lt;ThemeContext.Provider value={{ theme, effectiveTheme, setTheme }}&gt;\n      {children}\n    &lt;/ThemeContext.Provider&gt;\n  );\n}\n\nexport const useTheme = () =&gt; {\n  const context = useContext(ThemeContext);\n  if (!context) throw new Error('useTheme must be used within ThemeProvider');\n  return context;\n};\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#theme-toggle-component","title":"Theme Toggle Component","text":"<pre><code>import { useTheme } from '../contexts/ThemeContext';\nimport { Sun, Moon, Circle } from 'react-bootstrap-icons';\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    &lt;div className=\"btn-group\" role=\"group\"&gt;\n      &lt;button\n        className={`btn btn-sm ${theme === 'light' ? 'btn-primary' : 'btn-outline-secondary'}`}\n        onClick={() =&gt; setTheme('light')}\n      &gt;\n        &lt;Sun /&gt;\n      &lt;/button&gt;\n      &lt;button\n        className={`btn btn-sm ${theme === 'dark' ? 'btn-primary' : 'btn-outline-secondary'}`}\n        onClick={() =&gt; setTheme('dark')}\n      &gt;\n        &lt;Moon /&gt;\n      &lt;/button&gt;\n      &lt;button\n        className={`btn btn-sm ${theme === 'auto' ? 'btn-primary' : 'btn-outline-secondary'}`}\n        onClick={() =&gt; setTheme('auto')}\n      &gt;\n        &lt;Circle /&gt;\n      &lt;/button&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#testing-strategy","title":"Testing Strategy","text":""},{"location":"plans/react-ui-implementation-plan/#unit-tests-with-vitest","title":"Unit Tests with Vitest","text":"<pre><code>// __tests__/hooks/useAutoRefresh.test.ts\nimport { renderHook, act } from '@testing-library/react';\nimport { describe, it, expect, vi } from 'vitest';\nimport { useAutoRefresh } from '../../hooks/useAutoRefresh';\n\ndescribe('useAutoRefresh', () =&gt; {\n  it('should call refetch function on interval', () =&gt; {\n    vi.useFakeTimers();\n    const refetchFn = vi.fn();\n\n    const { result } = renderHook(() =&gt; useAutoRefresh(refetchFn, 1000));\n\n    expect(refetchFn).not.toHaveBeenCalled();\n\n    act(() =&gt; {\n      vi.advanceTimersByTime(1000);\n    });\n\n    expect(refetchFn).toHaveBeenCalledTimes(1);\n\n    vi.useRealTimers();\n  });\n\n  it('should toggle auto-refresh', () =&gt; {\n    const { result } = renderHook(() =&gt; useAutoRefresh(vi.fn()));\n\n    expect(result.current.enabled).toBe(true);\n\n    act(() =&gt; {\n      result.current.toggle();\n    });\n\n    expect(result.current.enabled).toBe(false);\n  });\n});\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#component-tests","title":"Component Tests","text":"<pre><code>// __tests__/components/TraceCard.test.tsx\nimport { render, screen } from '@testing-library/react';\nimport { describe, it, expect } from 'vitest';\nimport { TraceCard } from '../../components/telemetry/TraceCard';\n\ndescribe('TraceCard', () =&gt; {\n  const mockTrace = {\n    trace_id: 'abc123',\n    service_name: 'test-service',\n    name: 'GET /api/users',\n    duration_seconds: 0.125,\n    status_code: 200,\n  };\n\n  it('renders trace information', () =&gt; {\n    render(&lt;TraceCard trace={mockTrace} /&gt;);\n\n    expect(screen.getByText('test-service')).toBeInTheDocument();\n    expect(screen.getByText('GET /api/users')).toBeInTheDocument();\n    expect(screen.getByText('125ms')).toBeInTheDocument();\n  });\n\n  it('displays status badge with correct color', () =&gt; {\n    render(&lt;TraceCard trace={mockTrace} /&gt;);\n\n    const badge = screen.getByText('200');\n    expect(badge).toHaveClass('badge-success');\n  });\n});\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#integration-tests-with-msw","title":"Integration Tests with MSW","text":"<pre><code>// __tests__/integration/tracesFlow.test.tsx\nimport { render, screen, waitFor } from '@testing-library/react';\nimport { setupServer } from 'msw/node';\nimport { http, HttpResponse } from 'msw';\nimport { describe, it, expect, beforeAll, afterAll } from 'vitest';\nimport { TracesPage } from '../../pages/TracesPage';\n\nconst server = setupServer(\n  http.post('/api/traces/search', () =&gt; {\n    return HttpResponse.json({\n      traces: [\n        { trace_id: 'abc123', service_name: 'test', name: 'GET /test' }\n      ],\n      pagination: { has_more: false }\n    });\n  })\n);\n\nbeforeAll(() =&gt; server.listen());\nafterAll(() =&gt; server.close());\n\ndescribe('Traces Flow', () =&gt; {\n  it('loads and displays traces', async () =&gt; {\n    render(&lt;TracesPage /&gt;);\n\n    await waitFor(() =&gt; {\n      expect(screen.getByText('test')).toBeInTheDocument();\n    });\n  });\n});\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#e2e-tests-with-playwright","title":"E2E Tests with Playwright","text":"<pre><code>// e2e/traces.spec.ts\nimport { test, expect } from '@playwright/test';\n\ntest.describe('Traces Page', () =&gt; {\n  test('should navigate to traces and view detail', async ({ page }) =&gt; {\n    await page.goto('/');\n\n    // Click traces tab\n    await page.click('text=Traces');\n\n    // Wait for traces to load\n    await page.waitForSelector('.trace-card');\n\n    // Click first trace\n    await page.click('.trace-card:first-child');\n\n    // Verify trace detail view\n    await expect(page.locator('.trace-waterfall')).toBeVisible();\n  });\n\n  test('should apply query builder filter', async ({ page }) =&gt; {\n    await page.goto('/traces');\n\n    // Open query builder\n    await page.click('text=Add Filter');\n\n    // Select field\n    await page.selectOption('[name=\"field\"]', 'service.name');\n\n    // Select operator\n    await page.selectOption('[name=\"operator\"]', 'eq');\n\n    // Enter value\n    await page.fill('[name=\"value\"]', 'demo-frontend');\n\n    // Apply filter\n    await page.click('text=Apply Filter');\n\n    // Verify filtered results\n    await expect(page.locator('.trace-card')).toContainText('demo-frontend');\n  });\n});\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#open-questions","title":"Open Questions","text":"<ol> <li>Deployment Strategy: Run old and new UI side-by-side during transition?</li> <li>Feature Flags: Gradual rollout or full switch?</li> <li>Browser Support: Target modern browsers only (ES2020+)?</li> <li>Mobile Support: Full responsive or desktop-focused?</li> <li>Translation Contributors: How to manage community translations?</li> <li>Telemetry Privacy: User consent for browser telemetry collection?</li> <li> <p>Sampling Rate: What percentage of browser spans to sample</p> </li> <li> <p>Badges: Status-specific colors</p> </li> </ol>"},{"location":"plans/react-ui-implementation-plan/#auto-refresh-implementation","title":"Auto-Refresh Implementation","text":"<pre><code>// hooks/useAutoRefresh.ts\nexport function useAutoRefresh(refetchFn: () =&gt; void, interval = 5000) {\n  const [enabled, setEnabled] = useState(() =&gt; {\n    return localStorage.getItem('ollyscale-auto-refresh') !== 'false';\n  });\n\n  useEffect(() =&gt; {\n    if (!enabled) return;\n\n    const intervalId = setInterval(refetchFn, interval);\n    return () =&gt; clearInterval(intervalId);\n  }, [enabled, interval, refetchFn]);\n\n  const toggle = () =&gt; {\n    setEnabled(!enabled);\n    localStorage.setItem('ollyscale-auto-refresh', String(!enabled));\n  };\n\n  return { enabled, toggle };\n}\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#embedded-documentation-strategy","title":"Embedded Documentation Strategy","text":""},{"location":"plans/react-ui-implementation-plan/#documentation-sources","title":"Documentation Sources","text":"<ol> <li>Existing Docs: Convert <code>docs/*.md</code> to React components</li> <li>Inline Help: Contextual tooltips and popovers</li> <li>OpenAPI: Embed API reference from <code>/api/docs</code></li> </ol>"},{"location":"plans/react-ui-implementation-plan/#documentation-navigation","title":"Documentation Navigation","text":"<pre><code>Sidebar \u2192 Docs Tab \u2192 [Search Bar]\n  \u251c\u2500\u2500 Quick Start\n  \u251c\u2500\u2500 Features\n  \u2502   \u251c\u2500\u2500 Traces\n  \u2502   \u251c\u2500\u2500 Logs\n  \u2502   \u251c\u2500\u2500 Metrics\n  \u2502   \u2514\u2500\u2500 Service Map\n  \u251c\u2500\u2500 Query Builder Guide\n  \u251c\u2500\u2500 API Reference\n  \u2514\u2500\u2500 Troubleshooting\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#markdown-rendering","title":"Markdown Rendering","text":"<pre><code>import ReactMarkdown from 'react-markdown';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\n\n&lt;ReactMarkdown\n  components={{\n    code: ({ inline, className, children }) =&gt; {\n      const match = /language-(\\w+)/.exec(className || '');\n      return !inline &amp;&amp; match ? (\n        &lt;SyntaxHighlighter language={match[1]}&gt;\n          {String(children).replace(/\\n$/, '')}\n        &lt;/SyntaxHighlighter&gt;\n      ) : (\n        &lt;code className={className}&gt;{children}&lt;/code&gt;\n      );\n    }\n  }}\n&gt;\n  {docContent}\n&lt;/ReactMarkdown&gt;\n</code></pre>"},{"location":"plans/react-ui-implementation-plan/#migration-from-current-ui","title":"Migration from Current UI","text":""},{"location":"plans/react-ui-implementation-plan/#feature-mapping","title":"Feature Mapping","text":"Current UI Feature New React Implementation Sidebar navigation <code>Sidebar.tsx</code> with React Router Auto-refresh toggle <code>RefreshContext</code> + <code>useAutoRefresh</code> hook Theme toggle <code>ThemeContext</code> with Bootstrap themes Namespace filter <code>NamespaceContext</code> with multi-select dropdown Text search Query builder with \"contains\" operator Status filters (2xx, 4xx, 5xx) Query builder presets Trace waterfall <code>TraceWaterfall.tsx</code> with Recharts Service map React Cytoscape Metrics charts Recharts (replaces Chart.js) JSON export Maintained with <code>CopyButton</code>, <code>DownloadButton</code> Log correlation Maintained with context links AI Agents view New page with GenAI span rendering Collector config New page with Monaco editor"},{"location":"plans/react-ui-implementation-plan/#success-criteria","title":"Success Criteria","text":""},{"location":"plans/react-ui-implementation-plan/#branding-visual-identity","title":"Branding &amp; Visual Identity","text":"<ul> <li>\u2705 ollyScale logo and favicon preserved from current UI</li> <li>\u2705 Logo displayed in sidebar header</li> <li>\u2705 Logo used in loading spinner (animated rotation)</li> <li>\u2705 Logo used in empty states (dimmed opacity)</li> <li>\u2705 Consistent visual identity with current UI</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#functional-parity","title":"Functional Parity","text":"<ul> <li>\u2705 All current features work in new UI</li> <li>\u2705 Query builder replaces text search with advanced filtering</li> <li>\u2705 Auto-refresh works identically with pause detection</li> <li>\u2705 Theme switching (light/dark/auto) persists</li> <li>\u2705 All API endpoints consumed correctly</li> <li>\u2705 Namespace filtering works across all views</li> <li>\u2705 Export/download functionality maintained</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#performance","title":"Performance","text":"<ul> <li>\u2705 Initial load &lt; 2 seconds (on 4G)</li> <li>\u2705 Time to Interactive (TTI) &lt; 3 seconds</li> <li>\u2705 First Contentful Paint (FCP) &lt; 1.5 seconds</li> <li>\u2705 Largest Contentful Paint (LCP) &lt; 2.5 seconds</li> <li>\u2705 Page transitions &lt; 300ms</li> <li>\u2705 Auto-refresh doesn't cause UI jank</li> <li>\u2705 Large datasets handled with virtualization</li> <li>\u2705 Bundle size &lt; 500 KB gzipped</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#code-quality_1","title":"Code Quality","text":"<ul> <li>\u2705 TypeScript strict mode passes</li> <li>\u2705 ESLint with no warnings</li> <li>\u2705 80%+ test coverage (unit + component)</li> <li>\u2705 E2E tests for critical paths</li> <li>\u2705 Accessible (WCAG AA compliance)</li> <li>\u2705 No console errors in production</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#internationalization_1","title":"Internationalization","text":"<ul> <li>\u2705 2 initial locales supported (en-US, en-GB)</li> <li>\u2705 All UI strings translated with regional differences</li> <li>\u2705 Date/time formatting per locale (US vs UK formats)</li> <li>\u2705 Language switching works without reload</li> <li>\u2705 Localized documentation available for both locales</li> <li>\u2705 Framework ready for future language expansion</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#observability","title":"Observability","text":"<ul> <li>\u2705 Browser telemetry capturing key metrics</li> <li>\u2705 User interaction tracking working</li> <li>\u2705 API call tracing with trace propagation</li> <li>\u2705 Error tracking and reporting</li> <li>\u2705 Web Vitals monitored</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#documentation","title":"Documentation","text":"<ul> <li>\u2705 Embedded docs cover all features</li> <li>\u2705 Context-sensitive help works</li> <li>\u2705 Search returns relevant results</li> <li>\u2705 Documentation available in all languages</li> <li>\u2705 API reference embedded and searchable</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#migration","title":"Migration","text":"<ul> <li>\u2705 Beta period completed successfully</li> <li>\u2705 User feedback addressed</li> <li>\u2705 Smooth rollout with no downtime</li> <li>\u2705 Old UI deprecated gracefully</li> <li>\u2705 Migration guide published</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#timeline","title":"Timeline","text":"Phase Duration Deliverable Phase 1-2 2 weeks Infrastructure + API client Phase 3 1 week Query builder Phase 4-5 2 weeks Core pages (Traces, Logs, Metrics) Phase 6-7 2 weeks Services &amp; advanced features Phase 8 1.5 weeks Embedded documentation Phase 9 1 week Auto-refresh &amp; controls Phase 10 1 week Browser telemetry + i18n + themes Phase 11 1 week Infrastructure (OTel CR, HTTPRoute) &amp; deployment Total 12 weeks Production-ready React UI"},{"location":"plans/react-ui-implementation-plan/#additional-features-to-consider-future-enhancements","title":"Additional Features to Consider (Future Enhancements)","text":""},{"location":"plans/react-ui-implementation-plan/#phase-12-post-launch-enhancements","title":"Phase 12+ (Post-Launch Enhancements)","text":""},{"location":"plans/react-ui-implementation-plan/#component-documentation-storybook","title":"Component Documentation (Storybook)","text":"<ul> <li>[ ] Add Storybook for component library</li> <li>[ ] Document all reusable components</li> <li>[ ] Interactive component playground</li> <li>[ ] Accessibility testing in Storybook</li> <li>[ ] Visual regression testing with Chromatic</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#advanced-features","title":"Advanced Features","text":"<ul> <li>[ ] PWA Support: Service worker, offline mode, installable</li> <li>[ ] Real-time Updates: WebSockets or SSE for live data</li> <li>[ ] Query Preset Sharing: Export/import/share query builder filters</li> <li>[ ] Keyboard Shortcuts: Document and implement shortcuts (Ctrl+K for search)</li> <li>[ ] Onboarding Tour: First-time user tutorial</li> <li>[ ] Collaborative Features: Share links with filters, annotations</li> <li>[ ] Custom Dashboards: User-defined dashboard layouts</li> <li>[ ] Alert Configuration UI: UI for creating alerts (currently admin API only)</li> <li>[ ] Data Export: CSV, Excel, Parquet for bulk exports</li> <li>[ ] Saved Views: Bookmark specific filter/view combinations</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#developer-experience","title":"Developer Experience","text":"<ul> <li>[ ] API client SDK generation from OpenAPI</li> <li>[ ] GraphQL API consideration (for complex queries)</li> <li>[ ] WebSocket API for real-time streaming</li> <li>[ ] Mock API server for local development without backend</li> <li>[ ] Chrome DevTools extension for debugging</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#analytics-monitoring","title":"Analytics &amp; Monitoring","text":"<ul> <li>[ ] Usage analytics dashboard (admin only)</li> <li>[ ] Feature adoption tracking</li> <li>[ ] Error reporting dashboard (aggregate UI errors)</li> <li>[ ] User feedback mechanism (in-app surveys)</li> <li>[ ] A/B testing framework for new features</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#enterprise-features","title":"Enterprise Features","text":"<ul> <li>[ ] SSO/SAML integration</li> <li>[ ] Role-based access control (RBAC)</li> <li>[ ] Multi-tenancy support</li> <li>[ ] Audit logging</li> <li>[ ] Data retention policies UI</li> <li>[ ] Cost attribution by namespace/service</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#browser-compatibility-matrix","title":"Browser Compatibility Matrix","text":"<p>Target: Modern browsers with ES2020+ support only</p> Browser Minimum Version Support Level Chrome 90+ \u2705 Primary (Desktop + Mobile) Firefox 88+ \u2705 Primary (Desktop + Mobile) Safari 14+ \u2705 Primary (Desktop + Mobile) Edge 90+ \u2705 Primary (Desktop + Mobile) Samsung Internet 14+ \u2705 Supported (Mobile) <p>Explicitly Not Supported:</p> <ul> <li>IE11 (end of life)</li> <li>Opera Mini (no ES6 support)</li> <li>UC Browser (outdated engine)</li> <li>Legacy Android Browser</li> <li>Older Safari versions (&lt;14)</li> </ul> <p>Mobile-First Responsive Design:</p> <ul> <li>Touch-optimized interactions</li> <li>Mobile-friendly layouts (320px - 2560px)</li> <li>Breakpoints: xs (&lt; 576px), sm (\u2265 576px), md (\u2265 768px), lg (\u2265 992px), xl (\u2265 1200px), xxl (\u2265 1400px)</li> <li>Tested on iOS Safari and Chrome Mobile primarily</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#next-steps","title":"Next Steps","text":"<ol> <li>Review &amp; Approve Plan: Gather feedback on architecture and approach</li> <li>Phase 1 Kickoff: Create <code>apps/react-ui/</code> and setup infrastructure</li> <li>Parallel Development: Can work on API types while building UI</li> <li>Incremental Testing: Test each phase before moving to next</li> <li>Documentation: Update docs as features are completed</li> </ol>"},{"location":"plans/react-ui-implementation-plan/#decisions-made","title":"Decisions Made","text":""},{"location":"plans/react-ui-implementation-plan/#deployment-rollout","title":"Deployment &amp; Rollout","text":"<ul> <li>\u2705 Deployment: Parallel if easy (new at <code>/</code>, old at <code>/legacy</code>), otherwise full replacement</li> <li>\u2705 Rollout: Full switch, no gradual/feature-flag approach</li> <li>\u2705 Beta: 1 week internal testing, then full launch</li> <li>\u2705 Legacy Access: 2 weeks at <code>/legacy</code> post-launch, then remove</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#browser-platform-support","title":"Browser &amp; Platform Support","text":"<ul> <li>\u2705 Browsers: Modern only (ES2020+), no legacy support</li> <li>\u2705 Mobile: Full responsive support, mobile-first design</li> <li>\u2705 Target: Chrome/Firefox/Safari/Edge 90+</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#internationalization_2","title":"Internationalization","text":"<ul> <li>\u2705 Launch Languages: en-US (default), en-GB</li> <li>\u2705 Future Expansion: es, fr, de, ja (framework prepared)</li> <li>\u2705 Date Formats: US (MM/DD/YYYY) vs GB (DD/MM/YYYY)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#open-questions-remaining","title":"Open Questions (Remaining)","text":"<ol> <li>Browser Telemetry Consent: Show consent banner? GDPR compliance?</li> <li>Sampling Strategy: 100% errors, 10% success - adjust based on volume?</li> <li>Translation Management: Crowdin/Lokalise for future community translations?</li> <li>PWA Features: Is offline mode valuable for observability tool?</li> <li>Real-time Updates: WebSockets overhead worth it vs polling?</li> <li>Documentation Versioning: Version docs with releases or keep single latest?</li> <li>Nginx Routing: Serve both UIs from single container or separate deployments?</li> </ol>"},{"location":"plans/react-ui-implementation-plan/#implementation-progress","title":"Implementation Progress","text":""},{"location":"plans/react-ui-implementation-plan/#completed-work-2026-01-30","title":"Completed Work (2026-01-30)","text":""},{"location":"plans/react-ui-implementation-plan/#phase-9-auto-refresh-controls-completed","title":"Phase 9: Auto-Refresh &amp; Controls - COMPLETED \u2705","text":"<p>Implementation: Sliding time window with live monitoring mode Branch: <code>new-ui</code> Version: <code>0.0.1769795574</code></p>"},{"location":"plans/react-ui-implementation-plan/#sliding-time-window-system","title":"\u2705 Sliding Time Window System","text":"<p>Problem Solved: Logs/traces not appearing despite auto-refresh being enabled - time range was fixed to page load time.</p> <p>Solution: Implemented dynamic time window that slides forward on each auto-refresh when in \"LIVE\" mode.</p> <p>Implementation Details:</p> <ol> <li>QueryContext Enhancement (apps/web-ui/src/contexts/QueryContext.tsx):</li> </ol> <pre><code>export interface QueryState {\n  liveMode: boolean;           // Enable/disable sliding window\n  relativeMinutes: number | null; // e.g., 30 for \"last 30 minutes\"\n  timeRange: TimeRange;\n}\n\nconst refreshTimeWindow = () =&gt; {\n  // When in live mode, recalculate time range based on relative window\n  if (prev.liveMode &amp;&amp; prev.relativeMinutes) {\n    const end = new Date();\n    const start = new Date(end.getTime() - prev.relativeMinutes * 60 * 1000);\n    return {\n      ...prev,\n      timeRange: {\n        start_time: start.toISOString(),\n        end_time: end.toISOString()\n      }\n    };\n  }\n};\n</code></pre> <ol> <li>LIVE/PAUSED Toggle UI (apps/web-ui/src/components/query/EnhancedQueryBuilder.tsx):</li> <li>Green \"LIVE\" button with broadcast icon when active</li> <li>Gray \"PAUSED\" button with pause-circle icon when disabled</li> <li>Automatically disables live mode when user manually adjusts time range</li> <li> <p>Time range preset buttons (5/15/30/60 minutes) enable live mode and highlight when active</p> </li> <li> <p>Page Integration:</p> </li> <li>Updated all pages (LogsPage.tsx, TracesPage.tsx, SpansPage.tsx, MetricsPage.tsx)</li> <li>Auto-refresh now calls <code>refreshTimeWindow()</code> before <code>refetch()</code></li> <li>Ensures queries always use current time window in live mode</li> </ol>"},{"location":"plans/react-ui-implementation-plan/#timezone-display-enhancement","title":"\u2705 Timezone Display Enhancement","text":"<p>Problem Solved: Timestamps without timezone were ambiguous (UTC vs local time unclear).</p> <p>Solution: Modified <code>formatTimestamp()</code> to append timezone abbreviation.</p> <p>Implementation: apps/web-ui/src/utils/formatting.ts</p> <pre><code>export function formatTimestamp(isoString: string): string {\n  const date = parseISO(isoString);\n  const formatStr = 'MMM dd, yyyy HH:mm:ss.SSS';\n  return format(date, formatStr) + ' ' + format(date, 'zzz');\n  // Example output: \"Jan 30, 2026 17:33:47.510 UTC\"\n}\n</code></pre> <p>Impact: All timestamps throughout UI now clearly show timezone context.</p>"},{"location":"plans/react-ui-implementation-plan/#static-assets-fix","title":"\u2705 Static Assets Fix","text":"<p>Problem: 404 errors for <code>/logo.svg</code> and <code>/favicon.svg</code> when accessing deployed UI.</p> <p>Root Cause: Dockerfile missing <code>COPY public/ ./public/</code> step before Vite build.</p> <p>Solution: Added public directory copy to Dockerfile at line 21.</p> <p>Result: All static assets now serve correctly (HTTP 200).</p>"},{"location":"plans/react-ui-implementation-plan/#deployment-validation","title":"\u2705 Deployment &amp; Validation","text":"<ul> <li>Built and deployed version <code>0.0.1769795574</code> to KIND cluster</li> <li>All pods running successfully (api, otlp-receiver, webui, legacyui, db)</li> <li>ArgoCD application healthy</li> <li>Committed 19 commits to <code>new-ui</code> branch</li> <li>Pushed to GitHub: https://github.com/ryanfaircloth/ollyscale/tree/new-ui</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#behavior-validation","title":"Behavior Validation","text":"<p>Live Mode (Default):</p> <ol> <li>User opens Logs page \u2192 LIVE mode enabled by default</li> <li>Clicks \"30 minutes\" button \u2192 Time range set to \"last 30 minutes from now\"</li> <li>Auto-refresh triggers (every 5 seconds) \u2192 Time window slides forward</li> <li>New logs continuously appear as they're ingested</li> <li>LIVE button shows green with broadcast icon</li> </ol> <p>Paused Mode:</p> <ol> <li>User manually adjusts start/end time \u2192 LIVE mode auto-disables</li> <li>LIVE button turns gray \"PAUSED\" with pause-circle icon</li> <li>Auto-refresh triggers \u2192 Time range stays fixed</li> <li>User can click LIVE button \u2192 Resume sliding window</li> </ol> <p>Persistence:</p> <ul> <li>Live mode state persisted to localStorage</li> <li>Survives page reloads</li> <li>Independent per browser/device</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#current-status-summary-2026-01-31","title":"Current Status Summary (2026-01-31)","text":""},{"location":"plans/react-ui-implementation-plan/#whats-working","title":"\u2705 What's Working","text":"<ul> <li>Core UI framework (React 19, Vite, TypeScript, Bootstrap)</li> <li>All 9 pages exist (Dashboard, Traces, Spans, Logs, Metrics, Services, Service Map, AI Agents, Collector Config)</li> <li>Service Map fully functional with 5 services</li> <li>Query filtering (custom implementation)</li> <li>Auto-refresh with sliding time window</li> <li>Charts and visualizations</li> <li>Kubernetes deployment active</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#technical-debt","title":"\u26a0\ufe0f Technical Debt","text":"<ul> <li>react-querybuilder: Installed but NOT used (600KB wasted)</li> <li>Decision Required: Refactor to use library OR remove dependency</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#critical-missing-infrastructure","title":"\u274c Critical Missing Infrastructure","text":"<ol> <li>Testing (0% complete):</li> <li>No testing libraries installed</li> <li>0 test files exist</li> <li> <p>No test configuration</p> </li> <li> <p>Internationalization (0% complete):</p> </li> <li>No i18n libraries installed</li> <li>All strings hardcoded in English</li> <li> <p>No locale files</p> </li> <li> <p>~~Browser Telemetry~~ \u2705 (100% complete):</p> </li> <li>\u2705 OpenTelemetry browser SDK with auto-instrumentation</li> <li>\u2705 Error handlers (global, promise rejection, React boundary)</li> <li>\u2705 Custom span tracking for user actions</li> <li>\u2705 Tail sampling configuration (keep all non-receiver spans)</li> <li>\u26a0\ufe0f GDPR consent management not implemented (deferred)</li> </ol>"},{"location":"plans/react-ui-implementation-plan/#partially-complete","title":"\ud83d\udd04 Partially Complete","text":"<ul> <li>AI Agents page (structure exists, functionality missing)</li> <li>Collector Config page (structure exists, functionality missing)</li> <li>PWA setup (vite-plugin-pwa installed, not configured)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#next-steps-priority-order","title":"Next Steps (Priority Order)","text":""},{"location":"plans/react-ui-implementation-plan/#1-resolve-query-builder-technical-debt-1-2-days","title":"1. Resolve Query Builder Technical Debt (\u23f1\ufe0f 1-2 days)","text":"<p>Decision Required: Choose one:</p> <ul> <li>Option A: Refactor to use react-querybuilder properly (recommended for maintainability)</li> <li>Option B: Remove react-querybuilder dependency (saves 600KB, keeps custom code)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#2-install-testing-infrastructure-1-2-days","title":"2. Install Testing Infrastructure (\u23f1\ufe0f 1-2 days)","text":"<pre><code>cd apps/web-ui\nnpm install -D vitest @vitest/ui\nnpm install -D @testing-library/react @testing-library/jest-dom @testing-library/user-event\nnpm install -D msw happy-dom @playwright/test\n</code></pre> <ul> <li>Configure vitest.config.ts</li> <li>Write first test to validate setup</li> <li>Add to CI/CD</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#3-install-internationalization-completed-2026-02-01","title":"3. ~~Install Internationalization~~ \u2705 COMPLETED (2026-02-01)","text":"<pre><code>cd apps/web-ui\nnpm install react-i18next i18next i18next-browser-languagedetector\n</code></pre> <ul> <li>\u2705 Created i18n/config.ts configuration with language detection</li> <li>\u2705 Extracted hardcoded strings to translation files (en-US: 287 keys, en-GB with UK variants)</li> <li>\u2705 Added LanguageSelector component with flag dropdowns (\ud83c\uddfa\ud83c\uddf8/\ud83c\uddec\ud83c\udde7)</li> <li>\u2705 Updated all pages, sidebar, and common components with useTranslation() hook</li> <li>\u2705 Language persistence via localStorage</li> <li>\u2705 Deployed and tested in Kubernetes</li> </ul> <p>Commit: 1a166f2 - feat(web-ui): implement internationalization (i18n) support</p>"},{"location":"plans/react-ui-implementation-plan/#4-browser-telemetry-setup-complete-2026-02-02","title":"4. ~~Browser Telemetry Setup~~ \u2705 COMPLETE (2026-02-02)","text":"<p>All browser telemetry features implemented and tested:</p> <p>Completed Tasks:</p> <ul> <li>\u2705 Global error handler (<code>window.onerror</code>) capturing unhandled exceptions</li> <li>\u2705 Promise rejection handler (<code>window.onunhandledrejection</code>) for async errors</li> <li>\u2705 ErrorBoundary component catching React component errors</li> <li>\u2705 Custom events for user actions (custom_event, slow_operation, manual_error_test)</li> <li>\u2705 Tail sampling strategy: Keep ALL spans except 95% of successful receiver spans</li> <li>\u2705 End-to-end verification: All 6 test buttons working</li> </ul> <p>Files Modified:</p> <ul> <li>\u2705 <code>src/telemetry/config.ts</code> - Global error handlers with span creation</li> <li>\u2705 <code>src/components/ErrorBoundary.tsx</code> - React error boundary with telemetry</li> <li>\u2705 <code>src/App.tsx</code> - Wrapped with ErrorBoundary</li> <li>\u2705 <code>src/hooks/useTracing.ts</code> - Custom span creation methods</li> <li>\u2705 <code>charts/ollyscale/values.yaml</code> - Simplified tail_sampling configuration</li> </ul> <p>Verified Working Spans (from database):</p> <ol> <li><code>error.unhandled</code> - Synchronous errors</li> <li><code>error.unhandled_rejection</code> - Promise rejections</li> <li><code>error.react_boundary</code> - React component errors</li> <li><code>user.action.manual_error_test</code> - Manual error recording</li> <li><code>user.action.slow_operation</code> - Performance tracking</li> <li><code>user.action.custom_event</code> - Custom user events</li> </ol> <p>Root Cause Fixed: Gateway collector tail_sampling was dropping non-error web-ui spans. Simplified to keep all spans by default.</p> <p>Commit: 8dab0b4 - fix(collector): simplify tail_sampling to keep all non-receiver spans</p>"},{"location":"plans/react-ui-implementation-plan/#5-phase-104-quick-wins-critical-features-2-days-priority-1-in-progress","title":"5. Phase 10.4: Quick Wins + Critical Features (\u23f1\ufe0f 2 days) - PRIORITY 1 (IN PROGRESS)","text":"<p>Rationale: Implement high-impact, low-effort features before moving to testing phase. Focus on navigation/UX improvements and critical Service Catalog RED metrics.</p> <p>Tasks:</p>"},{"location":"plans/react-ui-implementation-plan/#51-service-catalog-navigation-buttons-3-hours-completed-2026-02-02","title":"5.1. Service Catalog Navigation Buttons (\u23f1\ufe0f 3 hours) - \u2705 COMPLETED (2026-02-02)","text":"<ul> <li>[x] Add \"View Spans\" button \u2192 Navigate to /spans with service_name filter</li> <li>[x] Add \"View Logs\" button \u2192 Navigate to /logs with service_name filter</li> <li>[x] Add \"View Metrics\" button \u2192 Navigate to /metrics with service_name filter</li> <li>[x] Update QueryContext to accept initial filters from navigation state</li> <li>[x] Test navigation flow from Service Catalog</li> </ul> <p>Files modified:</p> <ul> <li><code>apps/web-ui/src/pages/ServiceCatalogPage.tsx</code> - Added navigation buttons to service rows</li> <li><code>apps/web-ui/src/pages/LogsPage.tsx</code> - Added location.state handling for initial filters</li> <li><code>apps/web-ui/src/pages/SpansPage.tsx</code> - Added location.state handling for initial filters</li> <li><code>apps/web-ui/src/pages/MetricsPage.tsx</code> - Added location.state handling for initial filters</li> </ul> <p>Commit: f1a8a9a - feat(web-ui): add service catalog navigation buttons</p>"},{"location":"plans/react-ui-implementation-plan/#52-view-metrics-from-tracesspans-1-hour-completed-2026-02-02","title":"5.2. View Metrics from Traces/Spans (\u23f1\ufe0f 1 hour) - \u2705 COMPLETED (2026-02-02)","text":"<ul> <li>[x] Add \"View Metrics\" button in TraceModal \u2192 Navigate with service filter</li> <li>[x] Add \"View Metrics\" button in SpanDetail \u2192 Navigate with service filter</li> <li>[x] Test navigation from trace/span details</li> </ul> <p>Files modified:</p> <ul> <li><code>apps/web-ui/src/components/trace/TraceModal.tsx</code> - Added View Metrics button</li> <li><code>apps/web-ui/src/components/trace/SpanDetail.tsx</code> - Added View Metrics button</li> </ul> <p>Commit: f36cd34 - feat(web-ui): add view metrics buttons to trace and span modals</p>"},{"location":"plans/react-ui-implementation-plan/#53-separate-spans-tab-in-sidebar-2-hours-already-complete","title":"5.3. Separate Spans Tab in Sidebar (\u23f1\ufe0f 2 hours) - \u2705 ALREADY COMPLETE","text":"<ul> <li>[x] Add \"Spans\" tab to Sidebar.tsx (between Traces and Logs)</li> <li>[x] Ensure SpansPage is accessible at /spans route</li> <li>[x] Test navigation and active state highlighting</li> <li>[x] Update translations (en-US, en-GB) with \"Spans\" label</li> </ul> <p>Status: Already implemented in earlier phases. All requirements satisfied:</p> <ul> <li>Sidebar includes Spans nav item with icon 'layers' and labelKey 'nav.spans'</li> <li>Route configured in App.tsx at <code>/spans</code> with SpansPage component</li> <li>Translations exist: <code>nav.spans: \"Spans\"</code> in both en-US and en-GB</li> <li>Active state highlighting works via React Router NavLink</li> </ul> <p>No changes needed.</p>"},{"location":"plans/react-ui-implementation-plan/#54-service-catalog-red-metrics-1-2-days-completed-2026-02-02","title":"5.4. Service Catalog RED Metrics (\u23f1\ufe0f 1-2 days) - \u2705 COMPLETED (2026-02-02)","text":"<ul> <li>[x] Fetch RED metrics from backend API (already implemented)</li> <li>[x] Display Rate (requests/min) in table column with total count</li> <li>[x] Display Error rate (%) in table column with color coding</li> <li>[x] Display Duration (p50/p95/p99) in table columns</li> <li>[x] Format metrics with proper units and precision</li> <li>[x] Backend already provides loading states</li> <li>[x] Tested with PostgreSQL storage backend</li> </ul> <p>Files modified:</p> <ul> <li><code>apps/web-ui/src/pages/ServiceCatalogPage.tsx</code> - Enhanced RED metrics display</li> </ul> <p>Implementation details:</p> <ul> <li>Rate calculation: <code>requestCount / timeRangeDurationMinutes</code> with format \"45.2 (1234)\" showing req/min and total</li> <li>Error rate: Color-coded badges (green: 0%, yellow: &lt;1%, red: \u22651%)</li> <li>Latency: P50/P95/P99 displayed with formatDuration(), P95 color-coded by threshold (&lt;100ms green, &lt;500ms yellow, else red)</li> <li>P99 shown in red text to indicate worst-case latency</li> <li>Backend API returns complete ServiceMetrics: request_count, error_count, error_rate, p50/p95/p99_latency_ms</li> <li>Time range: Last 30 minutes (hardcoded in page state)</li> </ul> <p>Commit: 80b16b0 - feat(web-ui): enhance service catalog with complete RED metrics</p>"},{"location":"plans/react-ui-implementation-plan/#55-service-catalog-column-sorting-3-hours-completed-2026-02-02","title":"5.5. Service Catalog Column Sorting (\u23f1\ufe0f 3 hours) - \u2705 COMPLETED (2026-02-02)","text":"<ul> <li>[x] Add sort state management (column, direction) with useLocalStorage</li> <li>[x] Add sort icons to table headers (bi-arrow-up/down icons)</li> <li>[x] Implement client-side sorting for all columns (name, namespace, rate, error_rate, p50, p95, p99)</li> <li>[x] Persist sort preference to localStorage (service-catalog-sort key)</li> <li>[x] Test sorting with all columns</li> </ul> <p>Files modified:</p> <ul> <li><code>apps/web-ui/src/pages/ServiceCatalogPage.tsx</code> - Added complete sorting logic</li> </ul> <p>Implementation details:</p> <ul> <li>Sort state: <code>useLocalStorage&lt;{column: string, direction: 'asc'|'desc'}&gt;</code> with key 'service-catalog-sort'</li> <li>Default sort: service name ascending</li> <li>Sortable columns: name, namespace, rate (req/min), error_rate (%), p50/p95/p99 latencies (ms)</li> <li>Visual indicators: Bootstrap Icons (bi-arrow-up, bi-arrow-down) shown next to active column</li> <li>Click behavior: First click sorts ascending, second click sorts descending, clicking another column resets to ascending</li> <li>String sorting: Case-insensitive with localeCompare for name/namespace</li> <li>Numeric sorting: Type-safe comparison with fallback to 0 for undefined values</li> <li>Performance: useMemo for sorted array, only recomputes when data or sort config changes</li> </ul> <p>Commit: ada96e0 - feat(web-ui): add column sorting to service catalog</p>"},{"location":"plans/react-ui-implementation-plan/#phase-104-summary-completed-2026-02-02","title":"Phase 10.4 Summary - \u2705 COMPLETED (2026-02-02)","text":"<p>All 5 tasks completed successfully:</p> <ol> <li>\u2705 Service Catalog Navigation Buttons (f1a8a9a)</li> <li>\u2705 View Metrics from Traces/Spans (f36cd34)</li> <li>\u2705 Separate Spans Tab (already existed)</li> <li>\u2705 Service Catalog RED Metrics (80b16b0)</li> <li>\u2705 Column Sorting (ada96e0)</li> </ol> <p>Success Criteria Met:</p> <ul> <li>\u2705 All navigation buttons work correctly with filters applied</li> <li>\u2705 Spans tab visible in sidebar with proper routing</li> <li>\u2705 Service Catalog displays Rate, Error, Duration metrics</li> <li>\u2705 Table sorting works for all numeric and string columns</li> <li>\u2705 No TypeScript errors</li> <li>\u2705 All pre-commit hooks pass</li> </ul> <p>Deployment Ready: All features implemented, tested, and committed. Ready to proceed to Phase 10.1 (Write Comprehensive Tests).</p> <p>Deployment Plan:</p> <ol> <li>Implement features incrementally (commit after each task)</li> <li>Build and deploy to Kubernetes after all tasks complete</li> <li>Manual testing of navigation flows</li> <li>Verify RED metrics accuracy against backend data</li> <li>Commit with conventional commit message</li> </ol> <p>After Completion: Proceed to Phase 10.1 (Write Comprehensive Tests)</p>"},{"location":"plans/react-ui-implementation-plan/#6-write-comprehensive-tests-3-4-days-priority-2","title":"6. Write Comprehensive Tests (\u23f1\ufe0f 3-4 days) - PRIORITY 2","text":"<p>Testing infrastructure is installed, but only 1 test file exists.</p> <pre><code>cd apps/web-ui\nnpm install -D msw@latest  # Install MSW for API mocking\n</code></pre> <p>Priority tests to write:</p> <ul> <li>[ ] Hook tests: useAutoRefresh, useLocalStorage, useTracing, useQuery</li> <li>[ ] Utility tests: date formatting, validators, helpers</li> <li>[ ] Component tests: QueryBuilder, TraceWaterfall, ServiceGraph</li> <li>[ ] Page tests: basic rendering, loading states, error states</li> <li>[ ] API client tests with MSW mocks</li> <li>[ ] Integration tests: complete user flows</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#6-complete-ai-agents-page-2-3-days-priority-3","title":"6. Complete AI Agents Page (\u23f1\ufe0f 2-3 days) - PRIORITY 3","text":"<ul> <li>GenAI span visualization</li> <li>Token tracking display (input/output tokens)</li> <li>Prompt/response viewer</li> <li>Model filtering</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#6-complete-collector-config-page-2-3-days","title":"6. Complete Collector Config Page (\u23f1\ufe0f 2-3 days)","text":"<ul> <li>OpAMP status display</li> <li>Configuration viewer/editor</li> <li>Apply changes functionality</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#7-write-tests-ongoing","title":"7. Write Tests (\u23f1\ufe0f ongoing)","text":"<ul> <li>Unit tests for hooks and utils</li> <li>Component tests for pages</li> <li>Integration tests with MSW</li> <li>E2E tests with Playwright (optional)</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#8-performance-accessibility-1-week","title":"8. Performance &amp; Accessibility (\u23f1\ufe0f 1 week)","text":"<ul> <li>React.memo for expensive components</li> <li>Bundle size optimization</li> <li>Keyboard navigation</li> <li>ARIA labels</li> <li>Color contrast audit</li> </ul> <p>Total Estimated Work: 1-2 weeks for critical infrastructure + ongoing testing</p> <p>Last Updated: 2026-02-02 (Phase 10.4 planning complete) Current Status: Phases 1-6, 9, 10.2, 10.3 COMPLETE - Core UI with i18n and full browser telemetry deployed Next Phase: Phase 10.4 (Quick Wins + RED Metrics) - IN PROGRESS After 10.4: Phase 10.1 (Write Comprehensive Tests) Source of Truth: This plan is now the single source of truth (react-ui-decisions.md and react-ui-implementation-status.md removed)</p> <ul> <li>Survives page reloads</li> <li>Independent per browser/device</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#files-modified","title":"Files Modified","text":"<ul> <li>\u2705 apps/web-ui/src/contexts/QueryContext.tsx - Added liveMode, relativeMinutes, refreshTimeWindow()</li> <li>\u2705 apps/web-ui/src/utils/formatting.ts - Added timezone to formatTimestamp()</li> <li>\u2705 apps/web-ui/src/components/query/EnhancedQueryBuilder.tsx - Added LIVE/PAUSED toggle</li> <li>\u2705 apps/web-ui/src/pages/LogsPage.tsx - Integrated refreshTimeWindow()</li> <li>\u2705 apps/web-ui/src/pages/TracesPage.tsx - Integrated refreshTimeWindow()</li> <li>\u2705 apps/web-ui/src/pages/SpansPage.tsx - Integrated refreshTimeWindow()</li> <li>\u2705 apps/web-ui/src/pages/MetricsPage.tsx - Integrated refreshTimeWindow()</li> <li>\u2705 apps/web-ui/Dockerfile - Fixed static assets copy</li> </ul>"},{"location":"plans/react-ui-implementation-plan/#test-results","title":"Test Results","text":"<p>\u2705 TypeScript Compilation: Clean build with no errors \u2705 Pre-commit Hooks: All checks passed (ESLint, Prettier, Helm lint) \u2705 Static Assets: logo.svg, favicon.svg serving correctly (HTTP 200) \u2705 API Integration: Logs API returning data correctly with time ranges \u2705 Deployment: All pods running, ArgoCD healthy</p>"},{"location":"plans/react-ui-implementation-plan/#technical-debt-future-improvements","title":"Technical Debt &amp; Future Improvements","text":"<ul> <li>Consider adding visual indicator when time window slides (subtle animation)</li> <li>Add \"time window size\" badge showing current relative window (e.g., \"Last 30 min\")</li> <li>Consider keyboard shortcut to toggle live mode (e.g., 'L' key)</li> <li>Add \"sync to now\" button for quickly updating paused time ranges</li> <li>Consider per-page live mode preferences (e.g., always live for Logs, paused for Metrics)</li> </ul> <p>Plan Status: \u2705 75% Complete - Phases 1-6, 9, 10.2, 10.3 DONE | Next: Phase 10.4 (Quick Wins + RED Metrics) Last Updated: 2026-02-02 (Phase 10.4 planning complete) Owner: Ryan Faircloth Deployed: ollyscale-webui active on Kubernetes at ollyscale.ollyscale.test</p>"},{"location":"plans/v2-api-migration-plan/","title":"V2 api migration plan","text":"<p>Below is a revised single plan file with your corrections baked in:</p> <ul> <li>Assumes you create/manage the branch (no branch-creation steps in the plan).</li> <li>The new frontend app is v2; no <code>v2</code> prefixes/markings inside the code.</li> <li>Exposure is via Kubernetes Gateway API (not classic Ingress wording).[1][2][3]</li> <li>Markdown is structured so you can paste it directly into the repo as <code>docs/ollyscale-postgres-plan.md</code>.</li> </ul> <p>All OTEL / Postgres / operator references remain aligned with current practices.[4][5][6][7][8]</p>"},{"location":"plans/v2-api-migration-plan/#ollyscale-postgres-otel-migration-plan","title":"ollyScale Postgres &amp; OTEL Migration Plan","text":""},{"location":"plans/v2-api-migration-plan/#implementation-status","title":"Implementation Status","text":"<p>Branch: <code>storage-improvements</code> Progress: Phases 1-10 Complete (as of January 21, 2026)</p>"},{"location":"plans/v2-api-migration-plan/#completed-phases","title":"\u2705 Completed Phases","text":"Phase Status Commits Notes Phase 1: Frontend Skeleton \u2705 Complete a79d7fc FastAPI structure, StorageBackend, OTEL models Phase 2: PostgreSQL Infrastructure \u2705 Complete 1968d7f Zalando Operator, Postgresql CR (2 replicas + PgBouncer) Phase 3: Alembic OTEL Schema \u2705 Complete 96ee885, 0143588 Async Alembic, partitioned fact tables, dimension tables Phase 4: Partition Management \u2705 Complete d773d6b create_partitions(), drop_old_partitions(), daily CronJob Phase 5: PostgresStorage Backend \u2705 Complete 4a62d83 Database session manager, full StorageBackend implementation Phase 6: Query API \u2705 Complete e289095 Dependency injection, all query endpoints implemented Phase 7: Ingestion API \u2705 Complete af670d3 Ingest endpoints with validation, error handling Phase 8: Migration Job \u2705 Complete 0143588 Helm pre-upgrade Job runs Alembic migrations Phase 9: Testing \u2705 Complete a89e9de, 19e55ef 22 unit tests passing, 6 integration tests (require live DB) Phase 10: Documentation \u2705 Complete 1327624, 19e55ef Status table, testing strategy documented"},{"location":"plans/v2-api-migration-plan/#refactoring-complete","title":"\ud83d\udd27 Refactoring Complete","text":"<ul> <li>InMemoryStorage Removal | a89e9de | Removed dual-mode operation, PostgresStorage required in production</li> <li>Bug Fixes | 19e55ef | Fixed TimeRange attribute names (start_time/end_time), fixed _upsert methods</li> </ul>"},{"location":"plans/v2-api-migration-plan/#remaining-phases","title":"\ud83d\udccb Remaining Phases","text":"<ul> <li>Phase 11: Integration Testing - API contract tests with FastAPI TestClient (see section 11 below)</li> <li>Phase 12: Performance Benchmarking - Load test ingestion/queries, optimize indexes</li> <li>Phase 13: Observability - Add metrics for storage operations, partition status</li> <li>Phase 14: Deployment &amp; Rollback - Deploy to test environment, verify migration</li> </ul>"},{"location":"plans/v2-api-migration-plan/#phase-11-status-update-january-21-2026","title":"Phase 11 Status Update (January 21, 2026)","text":"<p>Integration Testing Framework Added:</p> <ul> <li>Test Fixtures (<code>tests/fixtures.py</code>): Reusable OTLP data generators for ResourceSpans, ResourceLogs, ResourceMetrics</li> <li>Ingestion Tests (<code>tests/test_api_ingest.py</code>): 17 tests covering POST /api/traces, /api/logs, /api/metrics - ALL PASSING \u2705</li> <li>Query Tests (<code>tests/test_api_query.py</code>): 21 tests for search endpoints, pagination, filters (mock data structure fixes needed)</li> <li>Error Tests (<code>tests/test_api_errors.py</code>): 26 tests for error handling, large payloads, concurrent requests</li> <li>Health Tests (<code>tests/test_health.py</code>): 18 comprehensive health endpoint tests - ALL PASSING \u2705</li> </ul> <p>Testing Philosophy:</p> <ul> <li>Unit Tests: Mock database completely, test business logic and error handling</li> <li>Integration Tests: Use FastAPI TestClient with mocked StorageBackend to test API contracts</li> <li>Dependency Override Pattern: <code>app.dependency_overrides[get_storage] = lambda: mock_storage</code></li> <li>No Live DB Required: All tests use AsyncMock for storage, fast execution (~0.5s for 108 tests)</li> </ul> <p>Current Status:</p> <ul> <li>86 tests passing, 22 tests need mock data structure fixes to match Pydantic models</li> <li>Deprecation warning fixed: <code>HTTP_422_UNPROCESSABLE_ENTITY</code> \u2192 <code>HTTP_422_UNPROCESSABLE_CONTENT</code></li> <li>Removed obsolete <code>test_storage.py</code> (tested removed InMemoryStorage)</li> </ul> <p>Next Steps:</p> <ul> <li>Fix mock data structures in query/error tests to match actual Service, Metric, ServiceMapNode models</li> <li>Add test coverage for edge cases (time range validation, pagination cursors)</li> <li>Consider adding property-based testing with Hypothesis for OTLP data validation</li> </ul>"},{"location":"plans/v2-api-migration-plan/#key-technical-decisions","title":"Key Technical Decisions","text":"<p>Storage Architecture:</p> <ul> <li>Single-mode operation: PostgresStorage required (DATABASE_HOST must be set)</li> <li>InMemoryStorage removed for production safety (was not in original plan)</li> <li>Dependency injection pattern with <code>get_storage()</code> for clean separation</li> <li>PostgreSQL 18 with native partitioning (daily intervals on <code>time_unix_nano</code>)</li> </ul> <p>Schema Design:</p> <ul> <li>Partitioned fact tables: <code>spans_fact</code>, <code>logs_fact</code>, <code>metrics_fact</code></li> <li>Dimension tables: <code>service_dim</code>, <code>operation_dim</code>, <code>resource_dim</code></li> <li>JSONB attributes with GIN indexes for flexible querying</li> <li>Foreign keys with indexes for fast joins</li> </ul> <p>Partition Management:</p> <ul> <li>Automated creation of future partitions (7-day lookahead)</li> <li>Automated cleanup of old partitions (30-day retention)</li> <li>CronJob running daily at 2 AM with comprehensive error handling</li> </ul> <p>Testing:</p> <ul> <li>25 unit tests passing (InMemoryStorage)</li> <li>6 integration tests require live PostgreSQL (validated in Kubernetes)</li> <li>Pre-commit hooks ensure code quality (ruff, pytest, yamlfmt, hadolint)</li> </ul> <p>Dependencies:</p> <ul> <li>FastAPI 0.115+, Pydantic 2.10+, SQLAlchemy[asyncio] 2.0.36+</li> <li>asyncpg 0.30+ for high-performance async Postgres</li> <li>Alembic 1.14+ for schema migrations</li> </ul> <p>Goal: Introduce an OTEL-aligned, Postgres-backed version of the ollyScale frontend app (replacing Redis-based storage) using the Zalando Postgres Operator, exposed via Kubernetes Gateway API.[2][5][6][1][4]</p> <p>Constraints:</p> <ul> <li>The new frontend app is the \u201cv2\u201d; no <code>v2</code> prefixes in module names, URLs, or directories inside that app.</li> <li>All new work happens under:</li> <li><code>apps/frontend/app</code></li> <li><code>apps/frontend/tests</code></li> <li><code>apps/ollyscale/</code> is effectively frozen:</li> <li>Only minimal bug/operational fixes are allowed.</li> <li>No new \u201cv2\u201d logic, models, or storage added there.</li> <li>No legacy data migration/ETL is required; all deployments are clean installs.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#0-scope-guardrails","title":"0. Scope &amp; Guardrails","text":"<ul> <li>Replace Redis-backed storage for traces, logs, and metrics with Postgres in the new frontend application, while keeping the legacy ollyscale app intact for this phase.[5][6][9]</li> <li>The new frontend app:</li> <li>Implements OTEL-aligned ingest and query APIs.</li> <li>Is exposed to clients via Gateway API HTTPRoutes.</li> <li>A follow-up phase will:</li> <li>Remove unused Redis and legacy code.</li> <li>Finalize cut-over and decommission Redis.</li> </ul> <p>Guardrail rules for implementation:</p> <ul> <li>Do not rename internal modules to include <code>v2</code> (e.g., avoid <code>routers/v2/*</code>); the whole app is the new version.</li> <li>Before every commit:</li> <li>Verify that <code>apps/ollyscale/</code> has no unintended changes.</li> <li>Ensure all new code is under <code>apps/frontend/</code> paths.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#1-project-setup-docs-structure-only","title":"1. Project Setup (Docs &amp; Structure Only)","text":"<ul> <li>Add plan and architecture docs:</li> <li><code>docs/ollyscale-postgres-plan.md</code> (this file).</li> <li>Optionally <code>docs/ollyscale-postgres-architecture.md</code> for diagrams and schema.</li> <li>Under <code>apps/frontend/app</code>:</li> <li>Ensure there is a clear app entrypoint (e.g., <code>main.py</code>) and standard FastAPI layout.[8][10]</li> <li>Add top-level packages:<ul> <li><code>routers/</code> for HTTP endpoints.</li> <li><code>models/</code> for Pydantic request/response models.</li> <li><code>storage/</code> for storage abstraction and implementations.</li> <li><code>db/</code> for DB session/connection utilities (if needed).</li> </ul> </li> </ul> <p>(Branch creation is assumed to be handled manually by the developer, not by this plan.)</p>"},{"location":"plans/v2-api-migration-plan/#2-postgres-infrastructure-zalando-operator-via-terraform","title":"2. Postgres Infrastructure (Zalando Operator via Terraform)","text":"<ul> <li>Use Terraform to deploy Zalando Postgres Operator and a Postgres cluster:[11][12][13][4]</li> <li>Operator:<ul> <li>Install in namespace like <code>postgres-operator</code>.</li> <li>Ensure required CRDs and RBAC are applied.</li> </ul> </li> <li>Cluster:<ul> <li>Create an <code>acid.zalan.do/v1</code> <code>postgresql</code> manifest for a single-node internal cluster.</li> <li>Parameterize storage size and class (e.g., 30GB default; overridable).</li> <li>Restrict network access so only the frontend app namespace(s) and migration Jobs can reach it.</li> </ul> </li> <li>Credentials and connectivity:</li> <li>Use the operator-managed Secret for DB credentials.</li> <li>Mount credentials into:<ul> <li>Frontend app Deployment/Pod.</li> <li>Alembic migration Job.</li> </ul> </li> <li>Document:<ul> <li>Secret names.</li> <li>Connection URI format.</li> <li>How credentials are mapped into environment variables.</li> </ul> </li> </ul>"},{"location":"plans/v2-api-migration-plan/#3-otel-aligned-data-model-schema","title":"3. OTEL-Aligned Data Model &amp; Schema","text":"<ul> <li>Design schema aligned with OpenTelemetry\u2019s data model and semantic conventions for logs, metrics, and traces:[6][7][14][15][5]</li> <li>Signals:<ul> <li>Traces (spans).</li> <li>Logs.</li> <li>Metrics (time-series points).</li> </ul> </li> <li>Fact tables (examples to adjust as needed):</li> <li><code>spans_fact</code>:<ul> <li>Keys: <code>tenant_id</code>, <code>connection_id</code>, <code>trace_id</code>, <code>span_id</code>, <code>parent_span_id</code>, <code>service_id</code>, <code>operation_id</code>.</li> <li>Time: <code>start_time_unix_nano</code>, <code>end_time_unix_nano</code>, <code>duration</code>.</li> <li>Fields: <code>status_code</code>, <code>kind</code>, <code>resource_id</code>, <code>attributes JSONB</code>, <code>events JSONB</code>, <code>links JSONB</code>.</li> </ul> </li> <li><code>logs_fact</code>:<ul> <li>Keys: <code>id</code>, <code>tenant_id</code>, <code>connection_id</code>.</li> <li>Time: <code>time_unix_nano</code>, <code>observed_time_unix_nano</code>.</li> <li>OTEL: <code>trace_id</code>, <code>span_id</code>, <code>severity_number</code>, <code>severity_text</code>, <code>body JSONB</code>, <code>attributes JSONB</code>, <code>resource JSONB</code>, <code>flags</code>, <code>dropped_attributes_count</code>.</li> </ul> </li> <li><code>metrics_fact</code>:<ul> <li>Keys: <code>id</code>, <code>tenant_id</code>, <code>connection_id</code>.</li> <li>OTEL: <code>resource JSONB</code>, <code>scope JSONB</code>, <code>metric_name</code>, <code>metric_type</code>, <code>unit</code>, <code>description</code>, <code>data_points JSONB</code>, <code>attributes JSONB</code>, <code>time_unix_nano</code>, <code>start_time_unix_nano</code>.[16][5]</li> </ul> </li> <li>Dimensions:</li> <li><code>service_dim</code>, <code>operation_dim</code>, <code>resource_dim</code>, optional <code>time_dim</code>.</li> <li>Conventions:</li> <li>Snake_case for all identifiers.</li> <li>JSONB for flexible attributes with planned GIN indexes for common keys (e.g., service name, environment).[7]</li> <li>Time-based partitioning on fact tables (details next section).</li> <li>Implement via Alembic migrations under <code>apps/frontend/migrations/</code>.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#4-retention-partitioning","title":"4. Retention &amp; Partitioning","text":"<ul> <li>Retention configuration:</li> <li>Create <code>retention_policy</code> table with:<ul> <li>Tenant identifier.</li> <li>Signal type (trace/log/metric).</li> <li>Retention period (e.g., days).</li> </ul> </li> <li>Provide a simple API/CLI path for reading/updating retention policies.</li> <li>Partitioning:</li> <li>Use native Postgres partitioning on time columns (<code>time_unix_nano</code> or truncated timestamp).</li> <li>Choose an initial interval (daily or weekly) and document why.</li> <li>Enforcement:</li> <li>Implement either:<ul> <li><code>pg_cron</code> jobs within Postgres, or</li> <li>K8s CronJobs calling a management script.</li> </ul> </li> <li>Logic:<ul> <li>Drop expired partitions or run <code>DELETE</code> on old rows (for tables not yet partitioned).</li> <li>Log actions for audit.</li> </ul> </li> <li>Document future-proofing and volume assumptions in <code>docs/ollyscale-postgres-architecture.md</code>.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#5-frontend-app-api-design-new-v2-app","title":"5. Frontend App API Design (New \u201cv2\u201d App)","text":"<p>(In this plan, \u201cv2\u201d refers to the entire new frontend app; internal names remain clean.)</p> <ul> <li>Endpoints:</li> <li>Ingest:<ul> <li><code>/api/traces</code></li> <li><code>/api/logs</code></li> <li><code>/api/metrics</code></li> </ul> </li> <li>Query:<ul> <li><code>/api/traces/search</code></li> <li><code>/api/logs/search</code></li> <li><code>/api/metrics/search</code></li> <li><code>/api/service-map</code></li> </ul> </li> <li>Models:</li> <li>Create Pydantic models in <code>apps/frontend/app/models/</code> that:<ul> <li>Are compatible with OTEL structures but simplified for HTTP JSON.</li> <li>Represent ingest payloads and query responses clearly.</li> </ul> </li> <li>Decoupling:</li> <li>The frontend app must not import code from <code>apps/ollyscale/</code>.</li> <li>The legacy app remains separate in deployment and routing.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#6-storage-layer-abstraction","title":"6. Storage Layer Abstraction","text":"<ul> <li>Define a storage abstraction in <code>apps/frontend/app/storage/</code>:</li> <li>Interfaces:<ul> <li><code>store_traces(payload)</code></li> <li><code>store_logs(payload)</code></li> <li><code>store_metrics(payload)</code></li> <li><code>search_traces(query)</code></li> <li><code>search_logs(query)</code></li> <li><code>search_metrics(query)</code></li> <li><code>get_service_map(params)</code></li> </ul> </li> <li>Implementation phases:</li> <li>Phase A (stub):<ul> <li>Implement an in-memory or no-op backend for early unit testing.</li> </ul> </li> <li>Phase B (Postgres):<ul> <li>Implement Postgres-backed storage using an async driver (e.g., async SQLAlchemy or asyncpg) and a pooled connection.[10][17][8]</li> <li>Encapsulate all SQL and query-building logic inside this layer.</li> </ul> </li> </ul>"},{"location":"plans/v2-api-migration-plan/#7-query-semantics-time-filtering-pagination","title":"7. Query Semantics: Time, Filtering, Pagination","text":"<ul> <li>Time:</li> <li>All search endpoints require <code>start_time</code> and <code>end_time</code> parameters.</li> <li>Limits:</li> <li><code>limit</code> parameter with default (e.g., 50\u2013100) and hard maximum.</li> <li>Pagination:</li> <li>Prefer cursor-based pagination (opaque cursor capturing time and id).</li> <li>Accept offset/limit as a fallback if needed, but design for cursor-first.</li> <li>Filtering:</li> <li>Accept structured filters (field, operator, value).</li> <li>Validate filters and construct safe SQL WHERE clauses in the storage layer.</li> <li>Support common fields such as: tenant, service, operation, severity, status, trace_id, environment.</li> <li>Response signals:</li> <li>Include <code>has_more</code> or <code>next_cursor</code> when additional results are available.</li> <li>Enforce the hard cap on rows per query server-side.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#8-exposure-via-kubernetes-gateway-api","title":"8. Exposure via Kubernetes Gateway API","text":"<ul> <li>Use Gateway API to expose the new frontend app:[3][18][1][2]</li> <li>Create a <code>Gateway</code> object (or use an existing one) for HTTP traffic.</li> <li>Create <code>HTTPRoute</code> objects that:<ul> <li>Match hostnames/paths for the new app (e.g., <code>api.ziggiz.ai</code> with <code>/olly</code> prefix, adjust as needed).</li> <li>Forward traffic to the Service backing the new frontend Deployment.</li> </ul> </li> <li>Routing rules:</li> <li>Treat the new frontend app as the authoritative \u201cv2\u201d API for new clients.</li> <li>Keep legacy routes pointing at the existing ollyscale app until cut-over.</li> <li>Document:</li> <li>Which hostnames/paths route to the new frontend app.</li> <li>Any header-based routing or canary/A/B patterns if used.[19][20]</li> </ul>"},{"location":"plans/v2-api-migration-plan/#9-migrations-deployment-integration","title":"9. Migrations &amp; Deployment Integration","text":"<ul> <li>Alembic:</li> <li>Configure Alembic (and SQLAlchemy if used) for Postgres migrations.[8][10]</li> <li>Store migration scripts in <code>apps/frontend/migrations/</code>.</li> <li>Migration Job:</li> <li>Add a dedicated K8s Job that:<ul> <li>Runs <code>alembic upgrade head</code> on deploy/upgrade.</li> <li>Uses DB credentials from the operator Secret.</li> <li>Is idempotent and fails fast on errors.</li> </ul> </li> <li>App readiness:</li> <li>Implement readiness checks so the frontend app:<ul> <li>Verifies DB connectivity.</li> <li>Confirms required migrations are applied (via Alembic version table).</li> </ul> </li> <li>Health endpoints:</li> <li><code>/health</code> and <code>/health/db</code>:<ul> <li>Return 200 when the app is ready and DB is healthy.</li> <li>Return 503 (with structured body) when DB is down or migrations are running.</li> </ul> </li> </ul>"},{"location":"plans/v2-api-migration-plan/#10-unit-testing","title":"10. Unit Testing","text":"<ul> <li>Add unit tests in <code>apps/frontend/tests/</code> for:</li> <li>Pydantic models: validation, defaults, required fields.</li> <li>Routers: status codes, error handling, payload shapes.</li> <li>Storage abstraction:<ul> <li>Stub behavior.</li> <li>Filter parsing and SQL generation (where possible without hitting real DB).</li> </ul> </li> <li>Retention logic (computations and selection of partitions to drop).</li> <li>Ensure the unit test suite can run without a live Postgres instance (stubs/mocks).[21]</li> </ul>"},{"location":"plans/v2-api-migration-plan/#11-integration-testing-final-testing-layer","title":"11. Integration Testing (Final Testing Layer)","text":"<ul> <li>API integration tests:</li> <li>Use FastAPI <code>TestClient</code> with a test Postgres instance (e.g., Dockerized DB) and migrations applied.</li> <li>Cover:<ul> <li>Ingest flows for traces/logs/metrics.</li> <li>Query flows with time range, filters, and pagination.</li> <li>Behavior when DB is unavailable or migrations are incomplete.</li> </ul> </li> <li>UI integration/E2E:</li> <li>Exercise:<ul> <li>Query builder behavior.</li> <li>Pagination/infinite scroll.</li> <li>Error and maintenance banners when <code>/health</code> or <code>/health/db</code> indicate problems.</li> </ul> </li> <li>Integration tests must be run after unit tests are passing and are treated as the last verification layer before commit/merge.[22]</li> </ul>"},{"location":"plans/v2-api-migration-plan/#12-observability-performance-indexing","title":"12. Observability, Performance &amp; Indexing","text":"<ul> <li>Observability:</li> <li>Emit telemetry for the new frontend app using OTEL (traces, metrics, logs) with appropriate sampling.[9][14][23]</li> <li>Monitor:<ul> <li>DB health and resource usage.</li> <li>Migration Job success/failure.</li> <li>API latency, error rates, and throughput.</li> </ul> </li> <li>Indexing:</li> <li>Add indexes on:<ul> <li>Time columns for partition pruning.</li> <li><code>trace_id</code>, <code>span_id</code>.</li> <li>Foreign keys such as <code>service_id</code>, <code>operation_id</code>.</li> <li>JSONB attributes used frequently in filters (GIN indexes).[7]</li> </ul> </li> <li>Performance:</li> <li>Capture slow queries and iteratively tune indexes and query patterns.</li> <li>Adjust partitioning strategy if needed based on actual load.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#13-documentation-follow-up-cleanup-phase","title":"13. Documentation &amp; Follow-Up (Cleanup Phase)","text":"<ul> <li>Documentation:</li> <li>Keep <code>docs/ollyscale-postgres-plan.md</code> and architecture docs up to date as implementation details change.</li> <li>Include:<ul> <li>Schema diagrams, table descriptions.</li> <li>Retention and partitioning details.</li> <li>Deployment &amp; migration steps.</li> <li>Troubleshooting guides.</li> </ul> </li> <li>Future cleanup phase (out of scope for this plan):</li> <li>Identify and remove unused Redis and legacy ollyscale code paths.</li> <li>Plan and execute final cut-over from legacy to new frontend app as the single source of truth.</li> <li>Decommission Redis and any unused infrastructure.</li> </ul>"},{"location":"plans/v2-api-migration-plan/#14-copilot-automation-rules","title":"14. Copilot / Automation Rules","text":"<p>For each incremental change within these phases:</p> <ol> <li>Implement the minimal set of changes needed for that step.</li> <li>Run the full test suite (unit + integration + UI tests if configured).</li> <li>If any tests fail:</li> <li>Fix the issues.</li> <li>Re-run tests until green.</li> <li>Before committing:</li> <li>Ensure no new v2 logic has been added under <code>apps/ollyscale/</code>.</li> <li>Confirm all changes are under <code>apps/frontend/</code> (plus allowed infra/docs tweaks).</li> <li>Only when all tests pass and guardrails are satisfied:</li> <li>Format code as needed.</li> <li>Commit with a descriptive message referencing the phase/step.</li> <li>Continue autonomously to the next step in the plan, maintaining the same discipline.[24][25][22]</li> </ol> <p>Sources [1] Kubernetes Gateway API: Introduction https://gateway-api.sigs.k8s.io [2] Gateway API - Kubernetes https://kubernetes.io/docs/concepts/services-networking/gateway/ [3] What Is the Kubernetes Gateway API? - Tetrate https://tetrate.io/learn/what-is-kubernetes-gateway-api [4] Zalando Postgres operator - The Blue Book https://lyz-code.github.io/blue-book/zalando_postgres_operator/ [5] Metrics Data Model | OpenTelemetry https://opentelemetry.io/docs/specs/otel/metrics/data-model/ [6] Logs Data Model | OpenTelemetry https://opentelemetry.io/docs/specs/otel/logs/data-model/ [7] OpenTelemetry Logging Explained: Concepts and Data Model \u00b7 Dash0 https://www.dash0.com/knowledge/opentelemetry-logging-explained [8] FastAPI with Async SQLAlchemy, SQLModel, and Alembic https://testdriven.io/blog/fastapi-sqlmodel/ [9] OpenTelemetry Signals Overview: Logs vs Metrics vs Traces - Dash0 https://www.dash0.com/knowledge/logs-metrics-and-traces-observability [10] Adding a production-grade database to your FastAPI project https://python.plainenglish.io/adding-a-production-grade-database-to-your-fastapi-project-local-setup-50107b10d539 [11] zalando/postgres-operator - GitHub https://github.com/zalando/postgres-operator [12] Zalando's Postgres Operator https://opensource.zalando.com/postgres-operator/docs/quickstart.html [13] Postgres Operator - Read the Docs https://postgres-operator.readthedocs.io [14] OpenTelemetry Logging https://opentelemetry.io/docs/specs/otel/logs/ [15] Inside OpenTelemetry: Understanding Its Data Model - LinkedIn https://www.linkedin.com/pulse/opentelemetry-series-6-deep-dive-opentelemetrys-data-model-kulkarni-rzmmf [16] Understanding OpenTelemetry Metrics: Types, Model, Collection ... https://edgedelta.com/company/blog/understanding-opentelemetry-metrics [17] FastAPI SQLAlchemy 2, Alembic and PostgreSQL Setup Tutorial 2025 https://www.youtube.com/watch?v=gg7AX1iRnmg [18] API Overview - Kubernetes Gateway API https://gateway-api.sigs.k8s.io/concepts/api-overview/ [19] Understanding Kubernetes Gateway API: A Modern Approach to ... https://www.cncf.io/blog/2025/05/02/understanding-kubernetes-gateway-api-a-modern-approach-to-traffic-management/ [20] Kubernetes Gateway API in action | Containers - AWS https://aws.amazon.com/blogs/containers/kubernetes-gateway-api-in-action/ [21] How to use PostgreSQL test database in async FastAPI tests? https://stackoverflow.com/questions/70752806/how-to-use-postgresql-test-database-in-async-fastapi-tests [22] Automation Pipeline and CI/CD: A Guide to Testing Best Practices https://www.browserstack.com/guide/automation-pipeline [23] What is OpenTelemetry? An open-source standard for logs, metrics ... https://www.dynatrace.com/news/blog/what-is-opentelemetry/ [24] Run Tests Before Commit - JetBrains Guide https://www.jetbrains.com/guide/go/tips/vcs-run-tests-before-commit/ [25] pre-commit vs. CI - Sebastian Witowski https://switowski.com/blog/pre-commit-vs-ci/ [26] Kubernetes Gateway API: What Is It And Why Do You Need It? https://traefik.io/glossary/kubernetes-gateway-api [27] Getting started with Gateway API https://gateway-api.sigs.k8s.io/guides/ [28] Collect logs, metrics, and traces with OpenTelemetry - Open Liberty https://openliberty.io/docs/latest/microprofile-telemetry.html [29] Postgres operator doesn't place the user secrets in the defined ... https://github.com/zalando/postgres-operator/issues/1827</p>"}]}